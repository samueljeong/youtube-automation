<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shorts Prompt Generator - TubeLens</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%23FF0000' width='32' height='32' rx='6'/><text x='16' y='22' font-size='16' fill='white' text-anchor='middle' font-weight='bold'>T</text></svg>">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 32px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .header-left h1 {
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-badge {
      font-size: 0.7rem;
      color: #fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
    }

    .header-right {
      display: flex;
      gap: 10px;
    }

    .header-btn {
      padding: 10px 20px;
      background: #f5f7fa;
      color: #333;
      text-decoration: none;
      border-radius: 10px;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s;
    }

    .header-btn:hover {
      background: #e1e5eb;
      transform: translateY(-1px);
    }

    .header-btn.home {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    .header-btn.home:hover {
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    /* Main Container */
    .main-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      margin-bottom: 40px;
      color: #fff;
    }

    .hero h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .hero p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Tab Container */
    .tab-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: #f5f7fa;
      border-bottom: 1px solid #e1e5eb;
    }

    .tab {
      flex: 1;
      padding: 20px;
      font-size: 1rem;
      font-weight: 600;
      color: #666;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .tab:hover {
      color: #333;
      background: rgba(255, 255, 255, 0.5);
    }

    .tab.active {
      color: #667eea;
      background: #fff;
      position: relative;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .tab-icon {
      font-size: 1.4rem;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      padding: 32px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Upload Zone */
    .upload-zone {
      border: 2px dashed #d1d5db;
      border-radius: 16px;
      padding: 50px 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      position: relative;
      overflow: hidden;
    }

    .upload-zone::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .upload-zone:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.15);
    }

    .upload-zone:hover::before {
      opacity: 1;
    }

    .upload-zone.dragover {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      transform: scale(1.01);
    }

    .upload-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .upload-text h3 {
      font-size: 1.2rem;
      color: #333;
      margin-bottom: 8px;
    }

    .upload-text p {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .upload-text .formats {
      color: #999;
      font-size: 0.8rem;
    }

    .upload-zone input[type="file"] {
      display: none;
    }

    /* Preview Container */
    .preview-container {
      display: none;
      padding: 20px;
    }

    .preview-container.active {
      display: block;
    }

    .preview-video, .preview-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .file-info {
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .file-name {
      color: #333;
      font-weight: 500;
    }

    .btn-change {
      padding: 8px 16px;
      background: #f1f5f9;
      color: #666;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-change:hover {
      background: #e2e8f0;
    }

    /* Options Section */
    .options-section {
      margin-top: 28px;
    }

    .options-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .option-card {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      transition: all 0.2s;
    }

    .option-card:hover {
      border-color: #667eea;
    }

    .option-card label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      color: #64748b;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .option-card select {
      width: 100%;
      padding: 10px 12px;
      font-size: 0.95rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: #fff;
      color: #333;
      cursor: pointer;
      transition: all 0.2s;
    }

    .option-card select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Checkbox Option */
    .checkbox-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, #f0f7ff 0%, #f5f3ff 100%);
      border: 2px solid #e0e7ff;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checkbox-option:hover {
      border-color: #667eea;
    }

    .checkbox-option input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #667eea;
      cursor: pointer;
    }

    .checkbox-option .option-label {
      flex: 1;
    }

    .checkbox-option .option-label strong {
      display: block;
      font-size: 0.95rem;
      color: #333;
      margin-bottom: 2px;
    }

    .checkbox-option .option-label span {
      font-size: 0.8rem;
      color: #666;
    }

    /* Analyze Button */
    .btn-analyze {
      width: 100%;
      padding: 18px 32px;
      margin-top: 28px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-analyze:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-analyze:disabled {
      background: #cbd5e1;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: none;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress Panel */
    .progress-panel {
      background: #fff;
      border-radius: 16px;
      padding: 32px;
      margin-top: 24px;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .progress-panel.active {
      display: block;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      position: relative;
    }

    .progress-step::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 50%;
      width: 100%;
      height: 2px;
      background: #e2e8f0;
    }

    .progress-step:last-child::before {
      display: none;
    }

    .progress-step .step-icon {
      width: 32px;
      height: 32px;
      background: #e2e8f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
      transition: all 0.3s;
    }

    .progress-step.active .step-icon {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      animation: pulse 1.5s infinite;
    }

    .progress-step.completed .step-icon {
      background: #10b981;
      color: #fff;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
    }

    .progress-step .step-label {
      font-size: 0.75rem;
      color: #64748b;
      margin-top: 8px;
      text-align: center;
    }

    .progress-bar-wrap {
      background: #e2e8f0;
      border-radius: 10px;
      height: 8px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      width: 0%;
      transition: width 0.5s ease;
    }

    .progress-text {
      font-size: 0.9rem;
      color: #64748b;
      text-align: center;
      margin-top: 12px;
    }

    /* Results Panel */
    .results-panel {
      background: #fff;
      border-radius: 20px;
      padding: 32px;
      margin-top: 24px;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .results-panel.active {
      display: block;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e2e8f0;
    }

    .results-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .results-title h3 {
      font-size: 1.3rem;
      color: #1e293b;
    }

    .results-meta {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .results-meta span {
      font-size: 0.85rem;
      color: #64748b;
      background: #f1f5f9;
      padding: 6px 12px;
      border-radius: 8px;
    }

    .btn-copy-all {
      padding: 12px 24px;
      background: #1e293b;
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-copy-all:hover {
      background: #334155;
      transform: translateY(-1px);
    }

    /* Prompt Cards */
    .prompt-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .prompt-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 20px;
      transition: all 0.2s;
    }

    .prompt-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
    }

    .prompt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .prompt-time {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .time-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .time-label {
      color: #64748b;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .btn-copy {
      padding: 8px 16px;
      background: #e2e8f0;
      color: #475569;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-copy:hover {
      background: #cbd5e1;
    }

    .btn-copy.copied {
      background: #10b981;
      color: #fff;
    }

    .prompt-text {
      font-size: 0.95rem;
      line-height: 1.7;
      color: #334155;
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Error Panel */
    .error-panel {
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      border: 1px solid #fca5a5;
      border-radius: 12px;
      padding: 16px 20px;
      margin-top: 20px;
      color: #b91c1c;
      display: none;
      align-items: center;
      gap: 12px;
    }

    .error-panel.active {
      display: flex;
    }

    .error-icon {
      font-size: 1.2rem;
    }

    /* Analysis Cards */
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .analysis-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 18px;
      transition: all 0.2s;
    }

    .analysis-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }

    .analysis-card h4 {
      font-size: 0.9rem;
      color: #667eea;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .analysis-card p {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #334155;
    }

    .analysis-card.full-width {
      grid-column: 1 / -1;
    }

    /* Generated Prompts Section */
    .generated-prompts {
      margin-top: 28px;
      padding-top: 24px;
      border-top: 1px solid #e2e8f0;
    }

    .generated-prompts h4 {
      font-size: 1.1rem;
      color: #1e293b;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .prompt-lang-badge {
      background: #1e293b;
    }

    .prompt-lang-badge.ko {
      background: #475569;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-container {
        padding: 20px 16px;
      }

      .hero h2 {
        font-size: 1.5rem;
      }

      .tab-content {
        padding: 24px 20px;
      }

      .upload-zone {
        padding: 40px 20px;
      }

      .options-grid {
        grid-template-columns: 1fr;
      }

      .results-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .btn-copy-all {
        width: 100%;
        justify-content: center;
      }

      .progress-steps {
        flex-wrap: wrap;
        gap: 12px;
      }

      .progress-step {
        flex: none;
        width: calc(50% - 6px);
      }

      .progress-step::before {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <div class="logo-icon">ğŸ¬</div>
        <h1>Shorts Prompt Generator</h1>
      </div>
      <span class="header-badge">AI Powered</span>
    </div>
    <div class="header-right">
      <a href="/tubelens" class="header-btn">TubeLens</a>
      <a href="/" class="header-btn home">Home</a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-container">
    <!-- Hero Section -->
    <section class="hero">
      <h2>AIë¡œ ì˜ìƒ/ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ì¶”ì¶œ</h2>
      <p>Shorts ì˜ìƒì´ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ AIê°€ ìƒì„¸í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
    </section>

    <!-- Tab Container -->
    <div class="tab-container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="video">
          <span class="tab-icon">ğŸ¥</span>
          ì˜ìƒ ë¶„ì„
        </button>
        <button class="tab" data-tab="image">
          <span class="tab-icon">ğŸ–¼ï¸</span>
          ì´ë¯¸ì§€ ë¶„ì„
        </button>
      </div>

      <!-- Video Tab Content -->
      <div class="tab-content active" id="video-tab">
        <!-- Upload Zone -->
        <div class="upload-zone" id="video-drop-zone">
          <input type="file" id="video-upload" accept="video/mp4,video/webm,video/quicktime,video/*">
          <div id="video-upload-content">
            <div class="upload-icon">ğŸ¥</div>
            <div class="upload-text">
              <h3>ì˜ìƒ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
              <p>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
              <p class="formats">MP4, WebM, MOV Â· ìµœëŒ€ 100MB</p>
            </div>
          </div>
          <div class="preview-container" id="video-preview-container">
            <video id="preview-video" class="preview-video" controls></video>
            <div class="file-info">
              <span class="file-name" id="video-file-name"></span>
              <button class="btn-change" id="btn-change-video">ë³€ê²½</button>
            </div>
          </div>
        </div>

        <!-- Options -->
        <div class="options-section">
          <div class="options-title">
            <span>âš™ï¸</span>
            ë¶„ì„ ì˜µì…˜
          </div>
          <div class="options-grid">
            <div class="option-card">
              <label for="mode">ë¶„ì„ ëª¨ë“œ</label>
              <select id="mode">
                <option value="scene" selected>ì”¬ ê¸°ë°˜ (ê¶Œì¥)</option>
                <option value="interval">ì‹œê°„ ê¸°ë°˜</option>
              </select>
            </div>
            <div class="option-card" id="threshold-group">
              <label for="threshold">ì”¬ ê°ì§€ ë¯¼ê°ë„</label>
              <select id="threshold">
                <option value="0.2">ë†’ìŒ (0.2)</option>
                <option value="0.3" selected>ë³´í†µ (0.3)</option>
                <option value="0.4">ë‚®ìŒ (0.4)</option>
              </select>
            </div>
            <div class="option-card" id="interval-group" style="display: none;">
              <label for="interval">í”„ë ˆì„ ê°„ê²©</label>
              <select id="interval">
                <option value="2">2ì´ˆ</option>
                <option value="3">3ì´ˆ</option>
                <option value="5" selected>5ì´ˆ</option>
                <option value="10">10ì´ˆ</option>
              </select>
            </div>
          </div>
          <label class="checkbox-option" style="margin-top: 16px;">
            <input type="checkbox" id="refine">
            <div class="option-label">
              <strong>GPTë¡œ í”„ë¡¬í”„íŠ¸ ì •ì œ</strong>
              <span>ë” ì •êµí•œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ (ì‹œê°„ ì¶”ê°€ ì†Œìš”)</span>
            </div>
          </label>
        </div>

        <!-- Analyze Button -->
        <button id="btn-analyze" class="btn-analyze" disabled>
          <span class="spinner" id="video-spinner"></span>
          <span id="btn-analyze-text">ë¶„ì„ ì‹œì‘</span>
        </button>
      </div>

      <!-- Image Tab Content -->
      <div class="tab-content" id="image-tab">
        <!-- Upload Zone -->
        <div class="upload-zone" id="image-drop-zone">
          <input type="file" id="image-upload" accept="image/*">
          <div id="image-upload-content">
            <div class="upload-icon">ğŸ–¼ï¸</div>
            <div class="upload-text">
              <h3>ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
              <p>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
              <p class="formats">PNG, JPG, WebP ë“± ëª¨ë“  ì´ë¯¸ì§€ í˜•ì‹</p>
            </div>
          </div>
          <div class="preview-container" id="image-preview-container">
            <img id="preview-image" class="preview-image">
            <div class="file-info">
              <span class="file-name" id="image-file-name"></span>
              <button class="btn-change" id="btn-change-image">ë³€ê²½</button>
            </div>
          </div>
        </div>

        <p style="margin-top: 20px; color: #64748b; font-size: 0.9rem; line-height: 1.6;">
          ğŸ’¡ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ <strong>ì¡°ëª…, ì¹´ë©”ë¼ ì•µê¸€, ìƒ‰ê°, ë¶„ìœ„ê¸°</strong> ë“±ì„ AIê°€ ì„¸ë°€í•˜ê²Œ ë¶„ì„í•˜ì—¬ ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸ë¥¼ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.
        </p>

        <!-- Analyze Button -->
        <button id="btn-analyze-image" class="btn-analyze" disabled>
          <span class="spinner" id="image-spinner"></span>
          <span id="btn-analyze-image-text">ì´ë¯¸ì§€ ë¶„ì„</span>
        </button>
      </div>
    </div>

    <!-- Error Panel -->
    <div id="error-panel" class="error-panel">
      <span class="error-icon">âš ï¸</span>
      <span id="error-text"></span>
    </div>

    <!-- Progress Panel (Video) -->
    <section id="progress-panel" class="progress-panel">
      <div class="progress-steps">
        <div class="progress-step" data-step="1">
          <div class="step-icon">ğŸ“¤</div>
          <span class="step-label">ì—…ë¡œë“œ</span>
        </div>
        <div class="progress-step" data-step="2">
          <div class="step-icon">ğŸ”</div>
          <span class="step-label">ì”¬ ê°ì§€</span>
        </div>
        <div class="progress-step" data-step="3">
          <div class="step-icon">ğŸ¤–</div>
          <span class="step-label">AI ë¶„ì„</span>
        </div>
        <div class="progress-step" data-step="4">
          <div class="step-icon">âœ¨</div>
          <span class="step-label">ì™„ë£Œ</span>
        </div>
      </div>
      <div class="progress-bar-wrap">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
      <div id="progress-text" class="progress-text">ì˜ìƒ ì—…ë¡œë“œ ì¤‘...</div>
    </section>

    <!-- Video Results Panel -->
    <section id="results-panel" class="results-panel">
      <div class="results-header">
        <div class="results-title">
          <span style="font-size: 1.5rem;">âœ…</span>
          <div>
            <h3>ë¶„ì„ ì™„ë£Œ</h3>
            <div class="results-meta">
              <span id="video-duration">ì˜ìƒ ê¸¸ì´: -</span>
              <span id="frame-count">í”„ë ˆì„: -</span>
            </div>
          </div>
        </div>
        <div style="display: flex; gap: 10px;">
          <button id="btn-copy-all" class="btn-copy-all">
            <span>ğŸ“‹</span>
            ì „ì²´ ë³µì‚¬
          </button>
          <button id="btn-generate-shorts" class="btn-copy-all" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <span>ğŸ¬</span>
            ì‡¼ì¸  ì˜ìƒ ìƒì„±
          </button>
        </div>
      </div>
      <div id="prompt-list" class="prompt-list"></div>

      <!-- Generated Images Section (hidden initially) -->
      <div id="generated-images-section" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e2e8f0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h4 style="font-size: 1.1rem; color: #1e293b; display: flex; align-items: center; gap: 8px;">
            <span>ğŸ–¼ï¸</span> ìƒì„±ëœ ì´ë¯¸ì§€
          </h4>
          <span id="image-gen-status" style="font-size: 0.85rem; color: #64748b;"></span>
        </div>
        <div id="generated-images-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;"></div>
      </div>

      <!-- Final Video Section (hidden initially) -->
      <div id="final-video-section" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e2e8f0;">
        <h4 style="font-size: 1.1rem; color: #1e293b; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>ğŸ¥</span> ìƒì„±ëœ ì‡¼ì¸  ì˜ìƒ
        </h4>
        <div style="text-align: center;">
          <video id="final-shorts-video" controls style="max-width: 300px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);"></video>
          <div style="margin-top: 16px;">
            <a id="download-shorts-link" href="#" download class="btn-copy-all" style="display: inline-flex; background: #10b981; text-decoration: none;">
              <span>â¬‡ï¸</span>
              ì˜ìƒ ë‹¤ìš´ë¡œë“œ
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Shorts Generation Progress Panel -->
    <section id="shorts-progress-panel" class="progress-panel">
      <div class="progress-steps">
        <div class="progress-step shorts-step" data-step="1">
          <div class="step-icon">ğŸ¨</div>
          <span class="step-label">ì´ë¯¸ì§€ ìƒì„±</span>
        </div>
        <div class="progress-step shorts-step" data-step="2">
          <div class="step-icon">ğŸ”Š</div>
          <span class="step-label">ì˜¤ë””ì˜¤ ì¤€ë¹„</span>
        </div>
        <div class="progress-step shorts-step" data-step="3">
          <div class="step-icon">ğŸ¬</div>
          <span class="step-label">ì˜ìƒ í•©ì„±</span>
        </div>
        <div class="progress-step shorts-step" data-step="4">
          <div class="step-icon">âœ¨</div>
          <span class="step-label">ì™„ë£Œ</span>
        </div>
      </div>
      <div class="progress-bar-wrap">
        <div id="shorts-progress-bar" class="progress-bar"></div>
      </div>
      <div id="shorts-progress-text" class="progress-text">ì´ë¯¸ì§€ ìƒì„± ì¤€ë¹„ ì¤‘...</div>
    </section>

    <!-- Image Results Panel -->
    <section id="image-result-panel" class="results-panel">
      <div class="results-header">
        <div class="results-title">
          <span style="font-size: 1.5rem;">âœ…</span>
          <h3>ì´ë¯¸ì§€ ë¶„ì„ ì™„ë£Œ</h3>
        </div>
        <button id="btn-copy-image-prompt" class="btn-copy-all">
          <span>ğŸ“‹</span>
          ì „ì²´ ë³µì‚¬
        </button>
      </div>

      <!-- Analysis Grid -->
      <div class="analysis-grid" id="analysis-grid">
        <div class="analysis-card">
          <h4>ğŸ“¸ í”¼ì‚¬ì²´</h4>
          <p id="analysis-subject">-</p>
        </div>
        <div class="analysis-card">
          <h4>ğŸï¸ ë°°ê²½</h4>
          <p id="analysis-background">-</p>
        </div>
        <div class="analysis-card">
          <h4>ğŸ’¡ ì¡°ëª…</h4>
          <p id="analysis-lighting">-</p>
        </div>
        <div class="analysis-card">
          <h4>ğŸ¥ ì¹´ë©”ë¼/êµ¬ë„</h4>
          <p id="analysis-camera">-</p>
        </div>
        <div class="analysis-card">
          <h4>ğŸ¨ ìƒ‰ê°</h4>
          <p id="analysis-color">-</p>
        </div>
        <div class="analysis-card">
          <h4>âœ¨ ë¶„ìœ„ê¸°</h4>
          <p id="analysis-mood">-</p>
        </div>
        <div class="analysis-card full-width">
          <h4>ğŸ¬ ìŠ¤íƒ€ì¼</h4>
          <p id="analysis-style">-</p>
        </div>
      </div>

      <!-- Generated Prompts -->
      <div class="generated-prompts">
        <h4><span>ğŸ“</span> ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</h4>
        <div class="prompt-card" style="margin-bottom: 12px;">
          <div class="prompt-header">
            <span class="time-badge prompt-lang-badge">English</span>
            <button class="btn-copy" id="btn-copy-en">ë³µì‚¬</button>
          </div>
          <div class="prompt-text" id="prompt-en">-</div>
        </div>
        <div class="prompt-card">
          <div class="prompt-header">
            <span class="time-badge prompt-lang-badge ko">í•œêµ­ì–´</span>
            <button class="btn-copy" id="btn-copy-ko">ë³µì‚¬</button>
          </div>
          <div class="prompt-text" id="prompt-ko">-</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');

        hideError();
      });
    });

    // ========== Video Upload ==========
    const videoDropZone = document.getElementById('video-drop-zone');
    const videoUpload = document.getElementById('video-upload');
    const videoUploadContent = document.getElementById('video-upload-content');
    const videoPreviewContainer = document.getElementById('video-preview-container');
    const previewVideo = document.getElementById('preview-video');
    const videoFileName = document.getElementById('video-file-name');
    const btnChangeVideo = document.getElementById('btn-change-video');
    const modeSelect = document.getElementById('mode');
    const intervalGroup = document.getElementById('interval-group');
    const thresholdGroup = document.getElementById('threshold-group');
    const btnAnalyze = document.getElementById('btn-analyze');
    const btnAnalyzeText = document.getElementById('btn-analyze-text');
    const videoSpinner = document.getElementById('video-spinner');
    const progressPanel = document.getElementById('progress-panel');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const resultsPanel = document.getElementById('results-panel');
    const promptList = document.getElementById('prompt-list');
    const btnCopyAll = document.getElementById('btn-copy-all');

    let selectedVideoFile = null;
    let analysisResults = null;

    // Video drop zone events
    videoDropZone.addEventListener('click', (e) => {
      if (e.target !== btnChangeVideo && !e.target.closest('.preview-container')) {
        videoUpload.click();
      }
    });

    videoDropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      videoDropZone.classList.add('dragover');
    });

    videoDropZone.addEventListener('dragleave', () => {
      videoDropZone.classList.remove('dragover');
    });

    videoDropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      videoDropZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('video/')) {
        handleVideoSelect(files[0]);
      } else {
        showError('ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
      }
    });

    videoUpload.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleVideoSelect(e.target.files[0]);
      }
    });

    btnChangeVideo.addEventListener('click', (e) => {
      e.stopPropagation();
      videoUpload.click();
    });

    function handleVideoSelect(file) {
      if (file.size > 100 * 1024 * 1024) {
        showError('íŒŒì¼ í¬ê¸°ëŠ” 100MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤');
        return;
      }

      selectedVideoFile = file;
      const videoURL = URL.createObjectURL(file);
      previewVideo.src = videoURL;
      videoFileName.textContent = file.name + ' (' + (file.size / 1024 / 1024).toFixed(1) + 'MB)';
      videoUploadContent.style.display = 'none';
      videoPreviewContainer.classList.add('active');
      btnAnalyze.disabled = false;
      hideError();
    }

    // Mode change
    modeSelect.addEventListener('change', () => {
      if (modeSelect.value === 'interval') {
        intervalGroup.style.display = 'block';
        thresholdGroup.style.display = 'none';
      } else {
        intervalGroup.style.display = 'none';
        thresholdGroup.style.display = 'block';
      }
    });

    // Video analysis
    btnAnalyze.addEventListener('click', async () => {
      if (!selectedVideoFile) {
        showError('ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        return;
      }

      hideError();
      resultsPanel.classList.remove('active');
      progressPanel.classList.add('active');
      btnAnalyze.disabled = true;
      videoSpinner.style.display = 'block';
      btnAnalyzeText.textContent = 'ë¶„ì„ ì¤‘...';

      // Reset progress steps
      document.querySelectorAll('.progress-step').forEach(step => {
        step.classList.remove('active', 'completed');
      });

      const mode = modeSelect.value;
      const steps = [
        { step: 1, percent: 15, text: 'ì˜ìƒ ì—…ë¡œë“œ ì¤‘...' },
        { step: 2, percent: 40, text: mode === 'scene' ? 'ì”¬ ë³€í™” ê°ì§€ ì¤‘...' : 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...' },
        { step: 3, percent: 70, text: 'AI ë¶„ì„ ì¤‘...' },
        { step: 4, percent: 90, text: 'í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘...' }
      ];

      let stepIndex = 0;
      const progressInterval = setInterval(() => {
        if (stepIndex < steps.length) {
          const currentStep = steps[stepIndex];
          progressBar.style.width = currentStep.percent + '%';
          progressText.textContent = currentStep.text;

          document.querySelectorAll('.progress-step').forEach((step, idx) => {
            if (idx < stepIndex) {
              step.classList.remove('active');
              step.classList.add('completed');
            } else if (idx === stepIndex) {
              step.classList.add('active');
            }
          });

          stepIndex++;
        }
      }, 2500);

      try {
        const formData = new FormData();
        formData.append('video', selectedVideoFile);
        formData.append('mode', modeSelect.value);
        formData.append('interval', document.getElementById('interval').value);
        formData.append('threshold', document.getElementById('threshold').value);
        formData.append('refine', document.getElementById('refine').checked);

        const response = await fetch('/api/tubelens/video-to-prompts', {
          method: 'POST',
          body: formData
        });

        clearInterval(progressInterval);

        const data = await response.json();

        if (data.success) {
          analysisResults = data;
          progressBar.style.width = '100%';
          progressText.textContent = 'ì™„ë£Œ!';

          document.querySelectorAll('.progress-step').forEach(step => {
            step.classList.remove('active');
            step.classList.add('completed');
          });

          setTimeout(() => {
            progressPanel.classList.remove('active');
            displayResults(data);
          }, 800);
        } else {
          progressPanel.classList.remove('active');
          showError(data.message || 'ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (error) {
        clearInterval(progressInterval);
        progressPanel.classList.remove('active');
        showError('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
      } finally {
        btnAnalyze.disabled = false;
        videoSpinner.style.display = 'none';
        btnAnalyzeText.textContent = 'ë¶„ì„ ì‹œì‘';
      }
    });

    function displayResults(data) {
      document.getElementById('video-duration').textContent = `ì˜ìƒ ê¸¸ì´: ${data.duration}ì´ˆ`;
      document.getElementById('frame-count').textContent = `í”„ë ˆì„: ${data.frameCount}ê°œ`;

      promptList.innerHTML = '';
      data.prompts.forEach((prompt, index) => {
        const card = document.createElement('div');
        card.className = 'prompt-card';
        card.innerHTML = `
          <div class="prompt-header">
            <div class="prompt-time">
              <span class="time-badge">${prompt.time}ì´ˆ</span>
              <span class="time-label">Scene ${index + 1}</span>
            </div>
            <button class="btn-copy" data-prompt="${encodeURIComponent(prompt.prompt)}">ë³µì‚¬</button>
          </div>
          <div class="prompt-text">${escapeHtml(prompt.prompt)}</div>
        `;
        promptList.appendChild(card);
      });

      document.querySelectorAll('#prompt-list .btn-copy').forEach(btn => {
        btn.addEventListener('click', () => {
          const promptText = decodeURIComponent(btn.dataset.prompt);
          copyToClipboard(promptText, btn);
        });
      });

      resultsPanel.classList.add('active');
    }

    btnCopyAll.addEventListener('click', () => {
      if (!analysisResults) return;

      const allPrompts = analysisResults.prompts.map((p, i) =>
        `[${p.time}ì´ˆ] Scene ${i + 1}:\n${p.prompt}`
      ).join('\n\n---\n\n');

      copyToClipboard(allPrompts, btnCopyAll, 'ì „ì²´ ë³µì‚¬');
    });

    // ========== Shorts Video Generation ==========
    const btnGenerateShorts = document.getElementById('btn-generate-shorts');
    const shortsProgressPanel = document.getElementById('shorts-progress-panel');
    const shortsProgressBar = document.getElementById('shorts-progress-bar');
    const shortsProgressText = document.getElementById('shorts-progress-text');
    const generatedImagesSection = document.getElementById('generated-images-section');
    const generatedImagesGrid = document.getElementById('generated-images-grid');
    const imageGenStatus = document.getElementById('image-gen-status');
    const finalVideoSection = document.getElementById('final-video-section');
    const finalShortsVideo = document.getElementById('final-shorts-video');
    const downloadShortsLink = document.getElementById('download-shorts-link');

    let generatedImages = [];

    btnGenerateShorts.addEventListener('click', async () => {
      if (!analysisResults || !analysisResults.prompts || analysisResults.prompts.length === 0) {
        showError('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì˜ìƒì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
        return;
      }

      // Reset UI
      hideError();
      generatedImages = [];
      generatedImagesGrid.innerHTML = '';
      generatedImagesSection.style.display = 'none';
      finalVideoSection.style.display = 'none';
      shortsProgressPanel.classList.add('active');
      btnGenerateShorts.disabled = true;

      // Reset progress steps
      document.querySelectorAll('.shorts-step').forEach(step => {
        step.classList.remove('active', 'completed');
      });

      try {
        // Step 1: Generate images from prompts
        updateShortsProgress(1, 10, 'ì´ë¯¸ì§€ ìƒì„± ì¤‘...');

        const prompts = analysisResults.prompts;
        const totalImages = prompts.length;

        generatedImagesSection.style.display = 'block';

        for (let i = 0; i < totalImages; i++) {
          const prompt = prompts[i].prompt;
          imageGenStatus.textContent = `${i + 1} / ${totalImages} ìƒì„± ì¤‘...`;

          try {
            // Generate image using existing API
            const imgResponse = await fetch('/api/drama/generate-image', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                prompt: prompt + ', vertical format, 9:16 aspect ratio, high quality',
                size: '1080x1920',
                imageProvider: 'gemini'
              })
            });

            const imgData = await imgResponse.json();

            if ((imgData.success || imgData.ok) && imgData.imageUrl) {
              generatedImages.push(imgData.imageUrl);

              // Add image to grid
              const imgCard = document.createElement('div');
              imgCard.style.cssText = 'position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 9/16; background: #f1f5f9;';
              imgCard.innerHTML = `
                <img src="${imgData.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;" alt="Scene ${i + 1}">
                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 8px; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: white; font-size: 0.75rem;">
                  Scene ${i + 1}
                </div>
              `;
              generatedImagesGrid.appendChild(imgCard);
            } else {
              console.warn(`Image ${i + 1} failed:`, imgData);
              // Add placeholder for failed image
              const placeholder = document.createElement('div');
              placeholder.style.cssText = 'display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; aspect-ratio: 9/16; background: #fee2e2; color: #b91c1c; font-size: 0.7rem; padding: 8px; text-align: center;';
              placeholder.innerHTML = `<strong>Scene ${i + 1} ì‹¤íŒ¨</strong><br><span style="font-size: 0.6rem; margin-top: 4px;">${imgData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</span>`;
              generatedImagesGrid.appendChild(placeholder);
            }

            // Update progress
            const progress = 10 + (40 * (i + 1) / totalImages);
            shortsProgressBar.style.width = progress + '%';
          } catch (imgError) {
            console.error(`Image ${i + 1} error:`, imgError);
          }
        }

        imageGenStatus.textContent = `${generatedImages.length} / ${totalImages} ì™„ë£Œ`;
        document.querySelector('.shorts-step[data-step="1"]').classList.remove('active');
        document.querySelector('.shorts-step[data-step="1"]').classList.add('completed');

        if (generatedImages.length === 0) {
          throw new Error('ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // Step 2: Generate simple background music or use silence
        updateShortsProgress(2, 50, 'BGM ì¤€ë¹„ ì¤‘...');

        // Generate simple TTS or use a placeholder audio
        let audioUrl = null;

        // Create a simple narration combining scene descriptions
        const narrationText = prompts.slice(0, 3).map((p, i) => `Scene ${i + 1}.`).join(' ');

        try {
          const ttsResponse = await fetch('/api/tts/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              text: narrationText || 'Shorts video generated by AI.',
              language: 'ko',
              voice: 'ko-KR-Wavenet-A'
            })
          });

          const ttsData = await ttsResponse.json();
          if (ttsData.success && ttsData.audioUrl) {
            audioUrl = ttsData.audioUrl;
          }
        } catch (ttsError) {
          console.warn('TTS failed, using default audio:', ttsError);
        }

        document.querySelector('.shorts-step[data-step="2"]').classList.remove('active');
        document.querySelector('.shorts-step[data-step="2"]').classList.add('completed');

        // Step 3: Generate video
        updateShortsProgress(3, 70, 'ì˜ìƒ í•©ì„± ì¤‘...');

        // If no audio, try to generate video with a simple slideshow
        if (!audioUrl) {
          // Generate placeholder audio
          try {
            const placeholderTTS = await fetch('/api/tts/generate', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                text: 'ì´ ì˜ìƒì€ AIê°€ ìƒì„±í•œ ì‡¼ì¸ ì…ë‹ˆë‹¤.',
                language: 'ko'
              })
            });
            const placeholderData = await placeholderTTS.json();
            if (placeholderData.success) {
              audioUrl = placeholderData.audioUrl;
            }
          } catch (e) {
            console.warn('Placeholder TTS also failed');
          }
        }

        // Call shorts video generation API
        const videoResponse = await fetch('/api/shorts/generate-video', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            images: generatedImages,
            audioUrl: audioUrl || '',
            effect: 'kenburns',
            imageDuration: 3
          })
        });

        const videoData = await videoResponse.json();

        document.querySelector('.shorts-step[data-step="3"]').classList.remove('active');
        document.querySelector('.shorts-step[data-step="3"]').classList.add('completed');

        if (videoData.ok && videoData.videoUrl) {
          // Step 4: Complete
          updateShortsProgress(4, 100, 'ì™„ë£Œ!');

          document.querySelector('.shorts-step[data-step="4"]').classList.add('completed');

          setTimeout(() => {
            shortsProgressPanel.classList.remove('active');

            // Show final video
            finalVideoSection.style.display = 'block';
            finalShortsVideo.src = videoData.videoUrl;
            downloadShortsLink.href = videoData.videoUrl;
            downloadShortsLink.download = 'shorts_' + Date.now() + '.mp4';

            // Scroll to video
            finalVideoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 800);
        } else {
          throw new Error(videoData.error || 'ì˜ìƒ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }

      } catch (error) {
        console.error('Shorts generation error:', error);
        shortsProgressPanel.classList.remove('active');
        showError('ì‡¼ì¸  ìƒì„± ì‹¤íŒ¨: ' + error.message);
      } finally {
        btnGenerateShorts.disabled = false;
      }
    });

    function updateShortsProgress(step, percent, text) {
      shortsProgressBar.style.width = percent + '%';
      shortsProgressText.textContent = text;

      document.querySelectorAll('.shorts-step').forEach((stepEl, idx) => {
        if (idx < step - 1) {
          stepEl.classList.remove('active');
          stepEl.classList.add('completed');
        } else if (idx === step - 1) {
          stepEl.classList.add('active');
        }
      });
    }

    // ========== Image Upload ==========
    const imageDropZone = document.getElementById('image-drop-zone');
    const imageUpload = document.getElementById('image-upload');
    const imageUploadContent = document.getElementById('image-upload-content');
    const imagePreviewContainer = document.getElementById('image-preview-container');
    const previewImage = document.getElementById('preview-image');
    const imageFileName = document.getElementById('image-file-name');
    const btnChangeImage = document.getElementById('btn-change-image');
    const btnAnalyzeImage = document.getElementById('btn-analyze-image');
    const btnAnalyzeImageText = document.getElementById('btn-analyze-image-text');
    const imageSpinner = document.getElementById('image-spinner');
    const imageResultPanel = document.getElementById('image-result-panel');

    let selectedImageFile = null;

    // Image drop zone events
    imageDropZone.addEventListener('click', (e) => {
      if (e.target !== btnChangeImage && !e.target.closest('.preview-container')) {
        imageUpload.click();
      }
    });

    imageDropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      imageDropZone.classList.add('dragover');
    });

    imageDropZone.addEventListener('dragleave', () => {
      imageDropZone.classList.remove('dragover');
    });

    imageDropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      imageDropZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('image/')) {
        handleImageSelect(files[0]);
      } else {
        showError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
      }
    });

    imageUpload.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleImageSelect(e.target.files[0]);
      }
    });

    btnChangeImage.addEventListener('click', (e) => {
      e.stopPropagation();
      imageUpload.click();
    });

    function handleImageSelect(file) {
      selectedImageFile = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        imageFileName.textContent = file.name + ' (' + (file.size / 1024).toFixed(0) + 'KB)';
        imageUploadContent.style.display = 'none';
        imagePreviewContainer.classList.add('active');
        btnAnalyzeImage.disabled = false;
        hideError();
      };
      reader.readAsDataURL(file);
    }

    // Image analysis
    btnAnalyzeImage.addEventListener('click', async () => {
      if (!selectedImageFile) {
        showError('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
        return;
      }

      hideError();
      btnAnalyzeImage.disabled = true;
      imageSpinner.style.display = 'block';
      btnAnalyzeImageText.textContent = 'ë¶„ì„ ì¤‘...';
      imageResultPanel.classList.remove('active');

      try {
        const formData = new FormData();
        formData.append('image', selectedImageFile);

        const response = await fetch('/api/tubelens/image-to-prompt', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.success) {
          displayImageAnalysis(data);
        } else {
          showError(data.message || 'ì´ë¯¸ì§€ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (error) {
        showError('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
      } finally {
        btnAnalyzeImage.disabled = false;
        imageSpinner.style.display = 'none';
        btnAnalyzeImageText.textContent = 'ì´ë¯¸ì§€ ë¶„ì„';
      }
    });

    function displayImageAnalysis(data) {
      if (data.analysis) {
        document.getElementById('analysis-subject').textContent = data.analysis.subject || '-';
        document.getElementById('analysis-background').textContent = data.analysis.background || '-';
        document.getElementById('analysis-lighting').textContent = data.analysis.lighting || '-';
        document.getElementById('analysis-camera').textContent = data.analysis.camera || '-';
        document.getElementById('analysis-color').textContent = data.analysis.color || '-';
        document.getElementById('analysis-mood').textContent = data.analysis.mood || '-';
        document.getElementById('analysis-style').textContent = data.analysis.style || '-';
      }

      document.getElementById('prompt-en').textContent = data.prompt || '-';
      document.getElementById('prompt-ko').textContent = data.prompt_ko || '-';

      imageResultPanel.classList.add('active');

      document.getElementById('btn-copy-en').onclick = () => {
        copyToClipboard(data.prompt, document.getElementById('btn-copy-en'));
      };
      document.getElementById('btn-copy-ko').onclick = () => {
        copyToClipboard(data.prompt_ko, document.getElementById('btn-copy-ko'));
      };
      document.getElementById('btn-copy-image-prompt').onclick = () => {
        const fullText = `[English]\n${data.prompt}\n\n[í•œêµ­ì–´]\n${data.prompt_ko}`;
        copyToClipboard(fullText, document.getElementById('btn-copy-image-prompt'), 'ì „ì²´ ë³µì‚¬');
      };
    }

    // ========== Utilities ==========
    const errorPanel = document.getElementById('error-panel');
    const errorText = document.getElementById('error-text');

    function showError(message) {
      errorText.textContent = message;
      errorPanel.classList.add('active');
    }

    function hideError() {
      errorPanel.classList.remove('active');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function copyToClipboard(text, btn, originalText = 'ë³µì‚¬') {
      navigator.clipboard.writeText(text).then(() => {
        const prevText = btn.innerHTML;
        btn.innerHTML = 'âœ“ ë³µì‚¬ë¨';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.innerHTML = prevText.includes('ì „ì²´') ? '<span>ğŸ“‹</span> ì „ì²´ ë³µì‚¬' : originalText;
          btn.classList.remove('copied');
        }, 2000);
      });
    }
  </script>
</body>
</html>
