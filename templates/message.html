<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬µìƒ ë©”ì‹œì§€ ìƒì„±ê¸°</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
      background: #0f172a;
      color: #e2e8f0;
    }
    .page-wrap { 
      display: flex; 
      gap: 1rem; 
      padding: 1rem; 
      min-height: 100vh;
    }
    .left-col { 
      width: 360px; 
      display: flex; 
      flex-direction: column; 
      gap: .75rem; 
    }
    .right-col { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      gap: .75rem; 
      min-width: 0; 
    }
    .box { 
      background: #1e293b; 
      border: 1px solid #334155; 
      border-radius: 12px; 
      padding: 1rem; 
    }
    .label { 
      font-weight: 600; 
      margin-bottom: .5rem; 
      display: block;
      color: #f1f5f9;
    }
    input[type="text"], input[type="number"], select { 
      width: 100%; 
      padding: .5rem; 
      background: #0f172a; 
      border: 1px solid #475569; 
      border-radius: 8px; 
      color: #e2e8f0;
      font-size: 0.95rem;
    }
    textarea { 
      width: 100%; 
      min-height: 80px; 
      resize: vertical; 
      box-sizing: border-box; 
      font-family: inherit; 
      line-height: 1.6; 
      padding: .75rem;
      background: #0f172a; 
      border: 1px solid #475569; 
      border-radius: 8px; 
      color: #e2e8f0;
      font-size: 0.95rem;
    }
    textarea.autosize { overflow: hidden; }
    
    .date-input {
      display: flex;
      align-items: center;
      gap: .5rem;
    }
    .date-input input {
      width: 70px;
      text-align: center;
    }
    .date-input span {
      color: #94a3b8;
    }
    
    .btn-row { 
      display: flex; 
      gap: .5rem; 
      flex-wrap: wrap; 
    }
    button { 
      padding: .6rem 1rem; 
      border: 1px solid #3b82f6; 
      background: #2563eb; 
      border-radius: 8px; 
      cursor: pointer; 
      color: white;
      font-weight: 500;
      transition: all 0.2s;
    }
    button:hover { 
      background: #1d4ed8; 
      transform: translateY(-1px);
    }
    button.secondary {
      background: #475569;
      border-color: #64748b;
    }
    button.secondary:hover {
      background: #334155;
    }
    
    .toggle-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: .75rem;
    }
    .copy-btn { 
      font-size: .85rem; 
      padding: .35rem .7rem; 
      background: #0f172a; 
      border: 1px solid #475569;
    }
    .status-bar { 
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      background: #1e293b; 
      border: 1px solid #3b82f6; 
      border-radius: 8px; 
      padding: .75rem 1.25rem; 
      font-size: .9rem; 
      box-shadow: 0 4px 12px rgba(0,0,0,.3); 
      display: none;
      color: #60a5fa;
    }
    .guide-tabs {
      display: flex;
      gap: .5rem;
      margin-bottom: .75rem;
    }
    .guide-tab {
      padding: .5rem 1rem;
      background: #0f172a;
      border: 1px solid #475569;
      border-radius: 8px;
      cursor: pointer;
      font-size: .9rem;
      transition: all 0.2s;
    }
    .guide-tab.active {
      background: #2563eb;
      border-color: #3b82f6;
      color: white;
    }
    .guide-content {
      display: none;
    }
    .guide-content.active {
      display: block;
    }
    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: .75rem;
    }
    .message-actions {
      display: flex;
      gap: .5rem;
    }
    .split-boxes {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    @media (max-width: 1200px) {
      .split-boxes {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <!-- ì™¼ìª½ -->
    <div class="left-col">
      <!-- ë‚ ì§œ -->
      <div class="box">
        <label class="label">ë‚ ì§œ</label>
        <div class="date-input">
          <input type="number" id="month" min="1" max="12" value="11">
          <span>ì›”</span>
          <input type="number" id="day" min="1" max="31" value="12">
          <span>ì¼ (<span id="day-of-week">ìˆ˜</span>)</span>
        </div>
      </div>

      <!-- ë³¸ë¬¸ -->
      <div class="box">
        <label class="label">ë³¸ë¬¸</label>
        <input type="text" id="bible-ref" placeholder="ì˜ˆ: ë ˆìœ„ê¸° 26:13">
      </div>

      <!-- ë³¸ë¬¸ ë‚´ìš© -->
      <div class="box">
        <label class="label">ë³¸ë¬¸ ë‚´ìš©</label>
        <textarea id="bible-text" class="autosize" placeholder="ì„±ê²½ êµ¬ì ˆ ì „ì²´ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
      </div>

      <!-- ë©”ì‹œì§€ ìƒì„± ë²„íŠ¼ -->
      <div class="box">
        <div class="btn-row">
          <button id="btn-morning">â˜€ï¸ ì˜¤ì „ ë©”ì‹œì§€</button>
          <button id="btn-evening">ğŸŒ™ ì €ë… ë©”ì‹œì§€</button>
        </div>
      </div>

      <!-- ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ë²„íŠ¼ -->
      <div class="box">
        <div class="btn-row">
          <button id="btn-morning-img" class="secondary">ğŸ–¼ï¸ ì˜¤ì „ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</button>
          <button id="btn-evening-img" class="secondary">ğŸ–¼ï¸ ì €ë… ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</button>
        </div>
      </div>

      <!-- ìƒì„± ìƒíƒœ -->
      <div id="status-indicator" style="text-align: center; color: #60a5fa; display: none;">
        â³ GPT ìƒì„± ì¤‘...
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ -->
    <div class="right-col">
      <!-- ì§€ì¹¨ ì˜ì—­ -->
      <div class="box" id="guide-box">
        <div class="toggle-header">
          <span class="label">ì§€ì¹¨ ì˜ì—­</span>
          <button id="toggle-guides" class="secondary">ë‹«ê¸°</button>
        </div>
        <div id="guide-inner">
          <div class="guide-tabs">
            <button class="guide-tab active" data-tab="morning">ì˜¤ì „ ì§€ì¹¨</button>
            <button class="guide-tab" data-tab="evening">ì €ë… ì§€ì¹¨</button>
            <button class="guide-tab" data-tab="image">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ì§€ì¹¨</button>
            <button class="guide-tab" data-tab="translate">ë²ˆì—­ ì§€ì¹¨</button>
          </div>
          <div class="guide-content active" data-content="morning">
            <textarea id="guide-morning" class="autosize" placeholder="ì˜¤ì „ ë©”ì‹œì§€ ìƒì„± ì§€ì¹¨ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
          </div>
          <div class="guide-content" data-content="evening">
            <textarea id="guide-evening" class="autosize" placeholder="ì €ë… ë©”ì‹œì§€ ìƒì„± ì§€ì¹¨ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
          </div>
          <div class="guide-content" data-content="image">
            <textarea id="guide-image" class="autosize" placeholder="ì´ë¯¸ì§€ëŠ” ë§‘ìŒ ëª©ìƒ ë©”ì‹œì§€ ë°°ê²½ìœ¼ë¡œ ì‚¬ìš©í• ê±°ì•¼. ì‚¬ì›ì´ë‚˜ ì ˆ, ì´ìŠ¬ëŒ ë“± ê¸°ë…êµê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì¢…êµì  ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤."></textarea>
          </div>
          <div class="guide-content" data-content="translate">
            <textarea id="guide-translate" class="autosize" placeholder="ë²ˆì—­ ì§€ì¹¨ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
          </div>
          <button id="save-guide" style="margin-top: .75rem;">ğŸ’¾ ì§€ì¹¨ ì €ì¥</button>
        </div>
      </div>

      <!-- ë©”ì‹œì§€ ì¶œë ¥ -->
      <div class="split-boxes">
        <div class="box">
          <div class="message-header">
            <label class="label">ì˜¤ì „ ë©”ì‹œì§€</label>
            <div class="message-actions">
              <button class="copy-btn" data-copy="morning-message">ğŸ“‹ ë³µì‚¬</button>
              <button class="copy-btn" data-translate="morning" data-lang="en">ğŸŒ ì˜ì–´</button>
              <button class="copy-btn" data-translate="morning" data-lang="ja">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´</button>
            </div>
          </div>
          <textarea id="morning-message" class="autosize" placeholder="ì˜¤ì „ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤." readonly></textarea>
        </div>

        <div class="box">
          <div class="message-header">
            <label class="label">ì €ë… ë©”ì‹œì§€</label>
            <div class="message-actions">
              <button class="copy-btn" data-copy="evening-message">ğŸ“‹ ë³µì‚¬</button>
              <button class="copy-btn" data-translate="evening" data-lang="en">ğŸŒ ì˜ì–´</button>
              <button class="copy-btn" data-translate="evening" data-lang="ja">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´</button>
            </div>
          </div>
          <textarea id="evening-message" class="autosize" placeholder="ì €ë… ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤." readonly></textarea>
        </div>
      </div>

      <!-- ë²ˆì—­ -->
      <div class="box">
        <div class="toggle-header">
          <label class="label">ë²ˆì—­</label>
          <button class="copy-btn" data-copy="translation">ğŸ“‹ ë³µì‚¬</button>
        </div>
        <textarea id="translation" class="autosize" placeholder="ë²ˆì—­ëœ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤." readonly></textarea>
      </div>

<!-- ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ -->
<div class="split-boxes">
  <div class="box">
    <label class="label" style="margin-bottom: 1rem;">ì˜¤ì „ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</label>
    
    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 1</span>
        <button class="copy-btn" data-copy="morning-img-1">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="morning-img-1" class="autosize" style="min-height: 60px;" placeholder="Image prompt 1" readonly></textarea>
    </div>

    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 2</span>
        <button class="copy-btn" data-copy="morning-img-2">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="morning-img-2" class="autosize" style="min-height: 60px;" placeholder="Image prompt 2" readonly></textarea>
    </div>

    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 3</span>
        <button class="copy-btn" data-copy="morning-img-3">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="morning-img-3" class="autosize" style="min-height: 60px;" placeholder="Image prompt 3" readonly></textarea>
    </div>

    <div>
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Music Prompt</span>
        <button class="copy-btn" data-copy="morning-music">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="morning-music" class="autosize" style="min-height: 60px;" placeholder="Music prompt" readonly></textarea>
    </div>
  </div>

  <div class="box">
    <label class="label" style="margin-bottom: 1rem;">ì €ë… ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</label>
    
    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 1</span>
        <button class="copy-btn" data-copy="evening-img-1">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="evening-img-1" class="autosize" style="min-height: 60px;" placeholder="Image prompt 1" readonly></textarea>
    </div>

    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 2</span>
        <button class="copy-btn" data-copy="evening-img-2">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="evening-img-2" class="autosize" style="min-height: 60px;" placeholder="Image prompt 2" readonly></textarea>
    </div>

    <div style="margin-bottom: 1rem;">
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Image Prompt 3</span>
        <button class="copy-btn" data-copy="evening-img-3">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="evening-img-3" class="autosize" style="min-height: 60px;" placeholder="Image prompt 3" readonly></textarea>
    </div>

    <div>
      <div class="toggle-header" style="margin-bottom: .5rem;">
        <span style="font-size: .9rem; color: #94a3b8;">Music Prompt</span>
        <button class="copy-btn" data-copy="evening-music">ğŸ“‹ ë³µì‚¬</button>
      </div>
      <textarea id="evening-music" class="autosize" style="min-height: 60px;" placeholder="Music prompt" readonly></textarea>
    </div>
  </div>
</div>
  <!-- ì§„í–‰ ìƒíƒœ -->
  <div id="status-bar" class="status-bar">ì‘ì—… ì¤‘...</div>

  <script>
  // ìë™ ë†’ì´ ì¡°ì ˆ
  function autoResize(el) {
    if (!el) return;
    el.style.height = 'auto';
    el.style.height = el.scrollHeight + 'px';
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ autosize ì ìš©
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('textarea.autosize').forEach(t => {
      autoResize(t);
      t.addEventListener('input', () => autoResize(t));
    });
    
    // ì´ˆê¸° ì§€ì¹¨ ë¡œë“œ
    loadAllGuides();
    
    // ë‚ ì§œ ë³€ê²½ ì‹œ ìš”ì¼ ì—…ë°ì´íŠ¸
    document.getElementById('month').addEventListener('change', updateDayOfWeek);
    document.getElementById('day').addEventListener('change', updateDayOfWeek);
    updateDayOfWeek();
  });

  // ìš”ì¼ ê³„ì‚° (ì„œìš¸ ê¸°ì¤€)
  function updateDayOfWeek() {
    const month = parseInt(document.getElementById('month').value);
    const day = parseInt(document.getElementById('day').value);
    const year = new Date().getFullYear();
    const date = new Date(year, month - 1, day);
    const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    document.getElementById('day-of-week').textContent = days[date.getDay()];
  }

  // ìƒíƒœ í‘œì‹œ
  const statusBar = document.getElementById('status-bar');
  const statusIndicator = document.getElementById('status-indicator');
  function showStatus(msg) {
    statusBar.textContent = msg;
    statusBar.style.display = 'block';
    statusIndicator.style.display = 'block';
  }
  function hideStatus() {
    statusBar.style.display = 'none';
    statusIndicator.style.display = 'none';
  }

  // ì§€ì¹¨ íƒ­ ì „í™˜
  document.querySelectorAll('.guide-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.dataset.tab;
      
      // íƒ­ í™œì„±í™”
      document.querySelectorAll('.guide-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // ì½˜í…ì¸  í‘œì‹œ
      document.querySelectorAll('.guide-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`[data-content="${tabName}"]`).classList.add('active');
    });
  });

  // ì§€ì¹¨ ì—´ê¸°/ë‹«ê¸°
  document.getElementById('toggle-guides').addEventListener('click', () => {
    const inner = document.getElementById('guide-inner');
    const btn = document.getElementById('toggle-guides');
    if (inner.style.display === 'none') {
      inner.style.display = 'block';
      btn.textContent = 'ë‹«ê¸°';
    } else {
      inner.style.display = 'none';
      btn.textContent = 'ì—´ê¸°';
    }
  });

  // ì§€ì¹¨ ì €ì¥
  document.getElementById('save-guide').addEventListener('click', () => {
    localStorage.setItem('guide-morning', document.getElementById('guide-morning').value);
    localStorage.setItem('guide-evening', document.getElementById('guide-evening').value);
    localStorage.setItem('guide-image', document.getElementById('guide-image').value);
    localStorage.setItem('guide-translate', document.getElementById('guide-translate').value);
    showStatus('ì§€ì¹¨ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    setTimeout(hideStatus, 1500);
  });

  // ì§€ì¹¨ ë¡œë“œ
  function loadAllGuides() {
    document.getElementById('guide-morning').value = localStorage.getItem('guide-morning') || '';
    document.getElementById('guide-evening').value = localStorage.getItem('guide-evening') || '';
    document.getElementById('guide-image').value = localStorage.getItem('guide-image') || '';
    document.getElementById('guide-translate').value = localStorage.getItem('guide-translate') || '';
    
    document.querySelectorAll('textarea.autosize').forEach(autoResize);
  }

  // ë³µì‚¬ ë²„íŠ¼
  document.querySelectorAll('[data-copy]').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.copy;
      const el = document.getElementById(targetId);
      navigator.clipboard.writeText(el.value || "").then(() => {
        showStatus("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        setTimeout(hideStatus, 1500);
      });
    });
  });

  // ê³µí†µ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  function getCommonData() {
    const month = document.getElementById('month').value;
    const day = document.getElementById('day').value;
    const dayOfWeek = document.getElementById('day-of-week').textContent;
    return {
      date: `${month}ì›” ${day}ì¼ (${dayOfWeek})`,
      ref: document.getElementById('bible-ref').value,
      text: document.getElementById('bible-text').value
    };
  }

  // ì˜¤ì „ ë©”ì‹œì§€ ìƒì„±
  document.getElementById('btn-morning').addEventListener('click', () => {
    showStatus("ì˜¤ì „ ë©”ì‹œì§€ ìƒì„± ì¤‘...");
    const common = getCommonData();
    const guide = document.getElementById('guide-morning').value;

    fetch("/api/message/morning", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ guide, ...common })
    })
    .then(res => res.json())
    .then(data => {
      const box = document.getElementById('morning-message');
      if (data.result) {
        box.value = data.result;
      } else if (data.error) {
        box.value = "ì˜¤ë¥˜: " + data.error;
      }
      autoResize(box);
    })
    .catch(err => {
      document.getElementById('morning-message').value = "ì˜¤ë¥˜ ë°œìƒ: " + err.message;
    })
    .finally(hideStatus);
  });

  // ì €ë… ë©”ì‹œì§€ ìƒì„±
  document.getElementById('btn-evening').addEventListener('click', () => {
    showStatus("ì €ë… ë©”ì‹œì§€ ìƒì„± ì¤‘...");
    const common = getCommonData();
    const guide = document.getElementById('guide-evening').value;

    fetch("/api/message/evening", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ guide, ...common })
    })
    .then(res => res.json())
    .then(data => {
      const box = document.getElementById('evening-message');
      if (data.result) {
        box.value = data.result;
      } else if (data.error) {
        box.value = "ì˜¤ë¥˜: " + data.error;
      }
      autoResize(box);
    })
    .catch(err => {
      document.getElementById('evening-message').value = "ì˜¤ë¥˜ ë°œìƒ: " + err.message;
    })
    .finally(hideStatus);
  });

  // ë²ˆì—­
  document.querySelectorAll('[data-translate]').forEach(btn => {
    btn.addEventListener('click', () => {
      const source = btn.dataset.translate;
      const lang = btn.dataset.lang;
      const sourceBox = document.getElementById(source + '-message');
      const text = sourceBox.value;
      
      if (!text) {
        alert('ë²ˆì—­í•  ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const langName = lang === 'en' ? 'ì˜ì–´' : 'ì¼ë³¸ì–´';
      showStatus(`${langName} ë²ˆì—­ ì¤‘...`);
      
      const guide = document.getElementById('guide-translate').value;

      fetch("/api/message/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ guide, text, lang })
      })
      .then(res => res.json())
      .then(data => {
        const box = document.getElementById('translation');
        if (data.result) {
          box.value = data.result;
        } else if (data.error) {
          box.value = "ì˜¤ë¥˜: " + data.error;
        }
        autoResize(box);
      })
      .catch(err => {
        document.getElementById('translation').value = "ì˜¤ë¥˜ ë°œìƒ: " + err.message;
      })
      .finally(hideStatus);
    });
  });

// ì˜¤ì „ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸
document.getElementById('btn-morning-img').addEventListener('click', () => {
  const message = document.getElementById('morning-message').value;
  if (!message) {
    alert('ë¨¼ì € ì˜¤ì „ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
    return;
  }

  showStatus("ì˜¤ì „ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘...");
  const guide = document.getElementById('guide-image').value;

  fetch("/api/message/image-prompt", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ guide, message, time: 'morning' })
  })
  .then(res => res.json())
  .then(data => {
    if (data.result) {
      // ì‘ë‹µì„ íŒŒì‹±í•´ì„œ ê° í”„ë¡¬í”„íŠ¸ë¡œ ë¶„ë¦¬
      const result = data.result;
      const sections = result.split('###').filter(s => s.trim());
      
      sections.forEach(section => {
        const lines = section.trim().split('\n');
        const title = lines[0].trim().toLowerCase();
        const content = lines.slice(1).join('\n').trim();
        
        if (title.includes('image prompt 1') || title.includes('image 1')) {
          document.getElementById('morning-img-1').value = content;
        } else if (title.includes('image prompt 2') || title.includes('image 2')) {
          document.getElementById('morning-img-2').value = content;
        } else if (title.includes('image prompt 3') || title.includes('image 3')) {
          document.getElementById('morning-img-3').value = content;
        } else if (title.includes('music')) {
          document.getElementById('morning-music').value = content;
        }
      });
      
      // ëª¨ë“  textarea ë†’ì´ ì¬ì¡°ì •
      ['morning-img-1', 'morning-img-2', 'morning-img-3', 'morning-music'].forEach(id => {
        autoResize(document.getElementById(id));
      });
    } else if (data.error) {
      alert("ì˜¤ë¥˜: " + data.error);
    }
  })
  .catch(err => {
    alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
  })
  .finally(hideStatus);
});

// ì €ë… ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸
document.getElementById('btn-evening-img').addEventListener('click', () => {
  const message = document.getElementById('evening-message').value;
  if (!message) {
    alert('ë¨¼ì € ì €ë… ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
    return;
  }

  showStatus("ì €ë… ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘...");
  const guide = document.getElementById('guide-image').value;

  fetch("/api/message/image-prompt", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ guide, message, time: 'evening' })
  })
  .then(res => res.json())
  .then(data => {
    if (data.result) {
      // ì‘ë‹µì„ íŒŒì‹±í•´ì„œ ê° í”„ë¡¬í”„íŠ¸ë¡œ ë¶„ë¦¬
      const result = data.result;
      const sections = result.split('###').filter(s => s.trim());
      
      sections.forEach(section => {
        const lines = section.trim().split('\n');
        const title = lines[0].trim().toLowerCase();
        const content = lines.slice(1).join('\n').trim();
        
        if (title.includes('image prompt 1') || title.includes('image 1')) {
          document.getElementById('evening-img-1').value = content;
        } else if (title.includes('image prompt 2') || title.includes('image 2')) {
          document.getElementById('evening-img-2').value = content;
        } else if (title.includes('image prompt 3') || title.includes('image 3')) {
          document.getElementById('evening-img-3').value = content;
        } else if (title.includes('music')) {
          document.getElementById('evening-music').value = content;
        }
      });
      
      // ëª¨ë“  textarea ë†’ì´ ì¬ì¡°ì •
      ['evening-img-1', 'evening-img-2', 'evening-img-3', 'evening-music'].forEach(id => {
        autoResize(document.getElementById(id));
      });
    } else if (data.error) {
      alert("ì˜¤ë¥˜: " + data.error);
    }
  })
  .catch(err => {
    alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
  })
  .finally(hideStatus);
});
  </script>
</body>
</html>