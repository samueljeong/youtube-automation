<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>DRAMA LAB</title>
  <!-- 외부 CSS 파일 -->
  <link rel="stylesheet" href="/static/css/drama.css">
</head>
<body>
  <!-- 중앙 로딩 인디케이터 -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">AI 작업 중</div>
      <div class="loading-subtext">잠시만 기다려주세요...</div>
    </div>
  </div>

  <!-- 지침 보기 모달 -->
  <div id="guidelines-modal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>📋 대본 작성 지침</span>
        <button onclick="closeGuidelinesModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
      </div>
      <div id="guidelines-modal-content" style="padding: 1rem 0; white-space: pre-wrap; font-size: 0.9rem; line-height: 1.8;"></div>
      <div class="modal-buttons">
        <button onclick="closeGuidelinesModal()" class="primary">닫기</button>
      </div>
    </div>
  </div>

  <!-- JSON 뷰어 모달 -->
  <div id="json-viewer-modal" class="modal">
    <div class="modal-content" style="max-width: 95vw; max-height: 95vh; overflow: hidden; display: flex; flex-direction: column;">
      <div class="modal-title" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
        <span>🔍 현재 적용 중인 JSON 데이터</span>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <button onclick="refreshJsonViewer()" style="padding: 0.3rem 0.8rem; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">🔄 새로고침</button>
          <button onclick="closeJsonViewerModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
      </div>
      <div style="display: flex; gap: 0.5rem; margin: 0.5rem 0; flex-shrink: 0;">
        <button onclick="showJsonTab('session')" id="json-tab-session" class="json-tab active" style="flex: 1; padding: 0.5rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">📦 세션 데이터</button>
        <button onclick="showJsonTab('guidelines')" id="json-tab-guidelines" class="json-tab" style="flex: 1; padding: 0.5rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">📋 지침 (style_guide)</button>
        <button onclick="showJsonTab('structure')" id="json-tab-structure" class="json-tab" style="flex: 1; padding: 0.5rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">🏗️ 대본 구조</button>
      </div>
      <div id="json-viewer-content" style="flex: 1; overflow-y: auto; background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.85rem; white-space: pre-wrap;"></div>
      <div class="modal-buttons" style="flex-shrink: 0; margin-top: 0.5rem;">
        <button onclick="copyJsonContent()" style="flex: 1; background: #2196F3;">📋 복사</button>
        <button onclick="closeJsonViewerModal()" class="primary" style="flex: 1;">닫기</button>
      </div>
    </div>
  </div>

  <!-- 카테고리 프롬프트 지침 모달 -->
  <div id="category-prompts-modal" class="modal">
    <div class="modal-content" style="max-width: 95vw; width: 1200px; max-height: 95vh; overflow: hidden; display: flex; flex-direction: column;">
      <div class="modal-title" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
        <span>📚 <span id="category-prompts-title">카테고리 프롬프트 지침</span></span>
        <button onclick="closeCategoryPromptsModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
      </div>

      <!-- Step 탭 버튼들 -->
      <div id="category-step-tabs" style="display: flex; gap: 0.5rem; margin: 0.5rem 0; flex-shrink: 0; flex-wrap: wrap;">
        <button onclick="showCategoryPromptStep('step1_1_meta')" class="category-step-tab active" data-step="step1_1_meta" style="padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">Step 1.1 메타 기획</button>
        <button onclick="showCategoryPromptStep('step1_2_planning')" class="category-step-tab" data-step="step1_2_planning" style="padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; background: #e5e7eb; color: #374151;">Step 1.2 기획</button>
        <button onclick="showCategoryPromptStep('step1_3_structure')" class="category-step-tab" data-step="step1_3_structure" style="padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; background: #e5e7eb; color: #374151;">Step 1.3 구조</button>
        <button onclick="showCategoryPromptStep('step1_4_script')" class="category-step-tab" data-step="step1_4_script" style="padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; background: #e5e7eb; color: #374151;">Step 1.4 대본</button>
      </div>

      <!-- 프롬프트 정보 표시 영역 -->
      <div style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem;">
        <!-- 프롬프트 메타 정보 -->
        <div id="category-prompt-meta" style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #3b82f6;">
          <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div><strong>이름:</strong> <span id="prompt-meta-name">-</span></div>
            <div><strong>모델:</strong> <span id="prompt-meta-model">-</span></div>
            <div><strong>입력:</strong> <span id="prompt-meta-input">-</span></div>
          </div>
          <div style="margin-top: 0.5rem; color: #64748b;"><strong>설명:</strong> <span id="prompt-meta-description">-</span></div>
        </div>

        <!-- 시스템 프롬프트 -->
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="font-weight: 600; margin-bottom: 0.5rem; color: #374151;">📝 시스템 프롬프트</div>
          <div id="category-prompt-content" style="flex: 1; overflow-y: auto; background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.85rem; white-space: pre-wrap; min-height: 300px;"></div>
        </div>

        <!-- 출력 스키마 -->
        <div>
          <div style="font-weight: 600; margin-bottom: 0.5rem; color: #374151;">📦 출력 스키마</div>
          <div id="category-prompt-schema" style="background: #f8fafc; padding: 1rem; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.85rem; overflow-x: auto;"></div>
        </div>
      </div>

      <div class="modal-buttons" style="flex-shrink: 0; margin-top: 0.5rem;">
        <button onclick="copyCategoryPrompt()" style="flex: 1; background: #2196F3;">📋 프롬프트 복사</button>
        <button onclick="closeCategoryPromptsModal()" class="primary" style="flex: 1;">닫기</button>
      </div>
    </div>
  </div>

  <!-- Auth Header -->
  <div class="auth-header">
    <h1>🎭 드라마 스크립트 작성 도구</h1>
    <div class="auth-links">
      <a href="/" class="btn-home">홈</a>
      {% if session.user_id %}
        <span class="user-info">{{ session.user_name }}님</span>
        <a href="/logout" class="btn-logout">로그아웃</a>
      {% else %}
        <a href="/login" class="btn-login">로그인</a>
        <a href="/signup" class="btn-signup">회원가입</a>
      {% endif %}
    </div>
  </div>

  <div class="page-wrap">
    <!-- 왼쪽 -->
    <div class="left-col">
      <!-- 💰 비용 계산 UI -->
      <div id="cost-tracker" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: .75rem; margin-bottom: .5rem;">
        <div style="color: white; font-weight: 700; font-size: .95rem; margin-bottom: .5rem; text-align: center;">💰 영상 제작 비용</div>
        <div style="background: rgba(255,255,255,0.95); border-radius: 8px; padding: .6rem;">
          <div id="total-cost-display" style="text-align: center; font-size: 1.4rem; font-weight: 700; color: #e91e63; margin-bottom: .4rem;">₩0</div>
          <div style="display: flex; flex-direction: column; gap: .25rem; font-size: .7rem; color: #666;">
            <div style="display: flex; justify-content: space-between;"><span>Step1 대본 (GPT+Claude):</span><span id="cost-step1">₩0</span></div>
            <div style="display: flex; justify-content: space-between;"><span>Step1.5 분석 (GPT-4o-mini):</span><span id="cost-step1-5">₩0</span></div>
            <div style="display: flex; justify-content: space-between;"><span>Step2 이미지 (Gemini/FLUX):</span><span id="cost-step2">₩0</span></div>
            <div style="display: flex; justify-content: space-between;"><span>Step3 TTS (Google/Naver):</span><span id="cost-step3">₩0</span></div>
            <div style="display: flex; justify-content: space-between;"><span>Step4 영상 (Creatomate):</span><span id="cost-step4">₩0</span></div>
          </div>
        </div>
      </div>

      <!-- 진행 상황 트래커 -->
      <div id="workflow-progress-sidebar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: .75rem; margin-bottom: .5rem;">
        <div style="color: white; font-weight: 700; font-size: .9rem; margin-bottom: .75rem; text-align: center;">📊 진행 현황</div>

        <div style="display: flex; flex-direction: column; gap: .35rem;">
          <!-- Step 1 -->
          <div class="progress-step-sidebar" data-step="step1">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">1</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">대본 생성</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 1.5 - GPT 프롬프트 분석 -->
          <div class="progress-step-sidebar" data-step="step1_5">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .6rem; font-weight: 700; color: white;">1.5</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">프롬프트 분석</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 2 -->
          <div class="progress-step-sidebar" data-step="step2">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">2</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">대사+지문</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 3 -->
          <div class="progress-step-sidebar" data-step="step3">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">3</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">대본 완성</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 4 -->
          <div class="progress-step-sidebar" data-step="step4">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">4</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">이미지 생성</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 5 -->
          <div class="progress-step-sidebar" data-step="step5">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">5</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">음성+자막</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 6 -->
          <div class="progress-step-sidebar" data-step="step6">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">6</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">영상 제작</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>

          <!-- Step 7 -->
          <div class="progress-step-sidebar" data-step="step7">
            <div style="display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid rgba(255,255,255,0.3);">
              <div class="step-indicator" style="min-width: 20px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; font-weight: 700; color: white;">7</div>
              <div style="flex: 1;">
                <div style="font-size: .75rem; font-weight: 600; color: white;">YouTube 업로드</div>
                <div class="step-substatus" style="font-size: .65rem; color: rgba(255,255,255,0.7);">대기</div>
              </div>
              <div class="step-status-icon" style="font-size: .8rem;">○</div>
            </div>
          </div>
        </div>

        <!-- 전체 상태 메시지 -->
        <div id="progress-status" style="margin-top: .75rem; padding: .4rem .5rem; background: rgba(255,255,255,0.15); border-radius: 6px; text-align: center;">
          <div style="color: rgba(255,255,255,0.95); font-size: .7rem; font-weight: 600;">Step1부터 시작하세요</div>
        </div>
      </div>

      <!-- 대본 작성 / 작업지침 / 데이터 축적 버튼 (진행현황 아래) -->
      <div class="quick-nav-mini" style="display: flex; flex-direction: column; gap: .4rem;">
        <button class="nav-btn active" data-panel-target="workflow-panel" style="padding: .5rem .75rem; border-radius: 8px; background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%); color: white; border: none; cursor: pointer; font-weight: 600; font-size: .85rem; text-align: left; display: flex; align-items: center; gap: .5rem;">
          <span>🎬</span>
          <span>대본 작성</span>
        </button>
        <button class="nav-btn" data-panel-target="guide-panel" style="padding: .5rem .75rem; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; cursor: pointer; font-weight: 600; font-size: .85rem; text-align: left; display: flex; align-items: center; gap: .5rem;">
          <span>🧭</span>
          <span>작업지침</span>
        </button>
        <button class="nav-btn" data-panel-target="data-panel" style="padding: .5rem .75rem; border-radius: 8px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; cursor: pointer; font-weight: 600; font-size: .85rem; text-align: left; display: flex; align-items: center; gap: .5rem;">
          <span>📚</span>
          <span>데이터 축적</span>
        </button>
      </div>

      <div class="legacy-left-content" style="display: none;">
      <!-- Step 네비게이션 -->
      <div class="step-nav" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 12px; padding: .75rem; margin-bottom: .5rem;">
        <div style="color: white; font-weight: 700; font-size: .9rem; margin-bottom: .75rem; text-align: center;">📍 워크플로우</div>
        <div class="step-nav-items" style="display: flex; flex-direction: column; gap: .4rem;">
          <button class="step-nav-btn active" data-step="step1" onclick="scrollToStep('step1-container')">
            <span class="step-num">1</span>
            <span class="step-name">주제 선정</span>
            <span class="step-status">●</span>
          </button>
          <button class="step-nav-btn" data-step="step2" onclick="scrollToStep('step2-container')">
            <span class="step-num">2</span>
            <span class="step-name">자료 조사</span>
            <span class="step-status">○</span>
          </button>
          <button class="step-nav-btn" data-step="step3" onclick="scrollToStep('step3-container')">
            <span class="step-num">3</span>
            <span class="step-name">대본 작성</span>
            <span class="step-status">○</span>
          </button>
          <button class="step-nav-btn" data-step="step4" onclick="scrollToStep('step4-container')">
            <span class="step-num">4</span>
            <span class="step-name">이미지 생성</span>
            <span class="step-status">○</span>
          </button>
          <button class="step-nav-btn" data-step="step5" onclick="scrollToStep('step5-container')">
            <span class="step-num">5</span>
            <span class="step-name">음성 합성</span>
            <span class="step-status">○</span>
          </button>
          <button class="step-nav-btn" data-step="step6" onclick="scrollToStep('step6-container')">
            <span class="step-num">6</span>
            <span class="step-name">영상 제작</span>
            <span class="step-status">○</span>
          </button>
          <!-- Step7 업로드 비활성화됨
          <button class="step-nav-btn" data-step="step7" onclick="scrollToStep('step7-container')">
            <span class="step-num">7</span>
            <span class="step-name">업로드</span>
            <span class="step-status">○</span>
          </button>
          -->
        </div>
      </div>

      <!-- 날짜 + 영상 시간 + 콘텐츠 유형 -->
      <div class="box" style="padding: .5rem .75rem;">
        <div style="display: flex; gap: .5rem; align-items: center;">
          <div style="flex: 1;">
            <label class="label" style="font-size: .8rem; margin-bottom: .2rem; display: block;">날짜</label>
            <input type="date" id="drama-date" style="padding: .25rem .4rem; font-size: .85rem;">
          </div>
          <div style="flex: 1;">
            <label class="label" style="font-size: .8rem; margin-bottom: .2rem; display: block;">영상 시간</label>
            <select id="drama-category" style="padding: .25rem .4rem; font-size: .85rem;"></select>
          </div>
          <div style="flex: 1;">
            <label class="label" style="font-size: .8rem; margin-bottom: .2rem; display: block;">콘텐츠 유형</label>
            <select id="content-type" style="padding: .25rem .4rem; font-size: .85rem;">
              <option value="testimony">간증</option>
              <option value="drama">드라마</option>
            </select>
          </div>
        </div>
        <!-- 프롬프트 미리보기 토글 -->
        <div style="margin-top: .5rem;">
          <button id="btn-toggle-prompt-preview" style="width: 100%; padding: .3rem; font-size: .75rem; background: #f8f9fa; color: #666; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
            📝 Step3 프롬프트 미리보기 ▼
          </button>
          <div id="prompt-preview-container" style="display: none; margin-top: .4rem; padding: .5rem; background: #f8f9fa; border-radius: 6px; max-height: 200px; overflow-y: auto;">
            <div style="font-size: .7rem; color: #333; white-space: pre-wrap; line-height: 1.4;" id="prompt-preview-content">
              콘텐츠 유형을 선택하면 해당 프롬프트가 표시됩니다.
            </div>
          </div>
        </div>
      </div>

      <!-- 주인공 선택 -->
      <div class="box" style="padding: .5rem .75rem;">
        <label class="label" style="font-size: .8rem; margin-bottom: .3rem; display: block;">주인공 (선택사항)</label>
        <!-- 성별 선택 -->
        <div style="display: flex; gap: 1rem; margin-bottom: .4rem;">
          <label style="display: flex; align-items: center; gap: .3rem; cursor: pointer; font-size: .85rem;">
            <input type="radio" name="protagonist-gender" id="gender-male" value="male" style="cursor: pointer;">
            <span>👨 남성</span>
          </label>
          <label style="display: flex; align-items: center; gap: .3rem; cursor: pointer; font-size: .85rem;">
            <input type="radio" name="protagonist-gender" id="gender-female" value="female" style="cursor: pointer;">
            <span>👩 여성</span>
          </label>
          <span style="font-size: .7rem; color: #999; align-self: center;">(TTS 나레이션 목소리 자동 설정)</span>
        </div>
        <div style="display: flex; gap: .4rem; align-items: center;">
          <input type="text" id="main-character" placeholder="예: 60대 은퇴 목사, 70대 할머니 등" style="flex: 1; font-size: .85rem; padding: .3rem .4rem;">
          <button id="btn-random-character" style="padding: .3rem .6rem; font-size: .75rem; background: #9b59b6; color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;">🎲 랜덤</button>
        </div>
        <div style="font-size: .7rem; color: #666; margin-top: .3rem;">
          비워두면 AI가 자동으로 적절한 주인공을 설정합니다.
        </div>
      </div>

      <!-- 벤치마킹 대본 (축소) -->
      <div class="box">
        <label class="label" style="font-size: .9rem;">벤치마킹 대본</label>
        <textarea id="benchmark-script" placeholder="참고할 대본이나 스크립트를 여기에 붙여넣으세요." style="height: 80px; resize: none; font-size: .85rem;"></textarea>
      </div>

      <!-- AI 대본 분석 -->
      <div class="box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: .5rem;">
        <div style="color: white; font-weight: 600; font-size: .85rem; margin-bottom: .4rem;">📊 AI 대본 분석</div>
        <div style="background: white; border-radius: 6px; padding: .4rem; margin-bottom: .4rem;">
          <div style="display: flex; gap: .3rem; margin-bottom: .3rem;">
            <input type="text" id="benchmark-upload-date" placeholder="날짜" style="flex: 1; font-size: .7rem; padding: .25rem;">
            <input type="text" id="benchmark-view-count" placeholder="조회수" style="flex: 1; font-size: .7rem; padding: .25rem;">
          </div>
          <label style="display: flex; align-items: center; gap: .2rem; margin-bottom: .3rem; cursor: pointer;">
            <input type="checkbox" id="check-duplicates" style="cursor: pointer;">
            <span style="font-size: .7rem; color: #666;">중복 자료</span>
          </label>
          <button id="btn-analyze-benchmark" class="primary" style="width: 100%; font-size: .75rem; padding: .3rem;">분석</button>
        </div>
        <div style="background: white; border-radius: 6px; padding: .4rem; max-height: 60px; overflow-y: auto;">
          <div id="analysis-result" style="font-size: .7rem; color: #333; line-height: 1.3;">
            <p style="color: #999; text-align: center; font-size: .65rem;">
              분석 결과가 여기에 표시됩니다.
            </p>
          </div>
        </div>
        <button id="btn-view-accumulated-guide" style="width: 100%; margin-top: .4rem; background: white; color: #667eea; font-weight: 600; font-size: .7rem; padding: .3rem; border-radius: 6px; border: none; cursor: pointer;">📚 가이드 보기</button>
      </div>

      <!-- 저장 공간 -->
      <div class="box">
        <label class="label" style="font-size: .9rem;">저장된 드라마 자료</label>
        <button id="btn-save" style="width: 100%; margin-bottom: .5rem; font-size: .85rem; padding: .4rem;">현재 내용 저장</button>
        <div id="saved-list"></div>
      </div>

      <!-- Q&A 대화 -->
      <div class="box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
          <label class="label" style="color: white; font-size: .9rem;">💬 AI 대화</label>
          <button onclick="DramaSession.clearHistory()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: .2rem .5rem; border-radius: 4px; font-size: .7rem; cursor: pointer;">기록 삭제</button>
        </div>
        <div id="qa-history" class="qa-history" style="background: white; border-radius: 8px; max-height: 200px; overflow-y: auto; margin-bottom: .5rem;">
          <div class="qa-empty-state">아직 대화가 없습니다.<br>대본이나 작업에 대해 궁금한 점을 물어보세요.</div>
        </div>
        <div class="qa-input-container" style="display: flex; gap: .3rem;">
          <input type="text" id="qa-input" placeholder="질문을 입력하세요..." style="flex: 1; padding: .4rem .5rem; border: none; border-radius: 6px; font-size: .8rem;" onkeypress="if(event.key==='Enter') DramaSession.sendQuestion()">
          <button onclick="DramaSession.sendQuestion()" style="background: white; color: #667eea; border: none; padding: .4rem .6rem; border-radius: 6px; font-weight: 600; font-size: .8rem; cursor: pointer;">전송</button>
        </div>
      </div>
      </div>
    </div>



    <div id="guide-panel" class="panel guide-panel">
      <div class="box">
        <div class="label" style="font-size: 1rem;">🧭 작업 지침</div>
        <p style="margin: .4rem 0; color: #555;">왼쪽 버튼을 눌러 단계별 내용을 오른쪽 패널에서 바로 확인하세요. 새 창을 열지 않고도 모든 정보를 한 눈에 볼 수 있도록 정리했습니다.</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: .75rem;">
          <div class="box" style="background: #fef3c7; border: none;">
            <div class="label">워크플로우</div>
            <ul style="margin: .4rem 0; padding-left: 1rem; color: #92400e; font-size: .9rem; line-height: 1.6;">
              <li>Step1 대본 생성: 상황·캐릭터·구조를 정리하고 대본을 빌드</li>
              <li>Step2 이미지 생성: 씬별 프롬프트와 비주얼 톤 설계</li>
              <li>Step3 음성 합성: 화자 선택, 속도·피치·볼륨 조정</li>
              <li>Step4 영상 제작: 컷보드, 타임라인, 자막/효과 배치</li>
              <li>Step5 업로드: 제목·태그·썸네일·설명 최종 확정</li>
            </ul>
          </div>
          <div class="box" style="background: #eef2ff; border: none;">
            <div class="label">품질 체크</div>
            <ul style="margin: .4rem 0; padding-left: 1rem; color: #312e81; font-size: .9rem; line-height: 1.6;">
              <li>스토리 흐름: 갈등 → 고조 → 해결 순서를 유지</li>
              <li>감정선: 인물 감정 변화를 장면마다 명시</li>
              <li>시각화: 씬마다 구도/배경/조명을 적어 이미지와 연결</li>
              <li>톤 앤 매너: 채널 톤, 말투, 속도를 일관되게 유지</li>
              <li>리뷰: 업로드 전 체크리스트로 어조·오탈자 점검</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="box" style="background: linear-gradient(135deg, #f97316 0%, #ef4444 100%); color: white;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: .5rem;">
          <div class="label" style="color: white;">📚 축적된 작업 지침</div>
          <div style="display: flex; gap: .4rem; align-items: center;">
            <button id="btn-refresh-guide" style="background: rgba(255,255,255,0.15); color: white; border: none; padding: .45rem .75rem; border-radius: 8px; font-weight: 700; cursor: pointer;">가이드 불러오기</button>
            <button id="btn-open-guide-modal-panel" style="background: white; color: #ef4444; border: none; padding: .45rem .75rem; border-radius: 8px; font-weight: 700; cursor: pointer;">지침 관리</button>
          </div>
        </div>
        <div id="guide-panel-content" style="margin-top: .75rem; background: rgba(255,255,255,0.12); padding: .75rem; border-radius: 8px; min-height: 160px; white-space: pre-wrap; line-height: 1.6;">왼쪽의 "가이드 불러오기" 버튼을 눌러 축적된 작업 지침을 오른쪽에서 바로 확인하세요.</div>
      </div>
    </div>

    <div id="data-panel" class="panel data-panel">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
        <div class="box">
          <div class="label" style="font-size: 1rem;">📄 대본 작성 데이터 (텍스트)</div>
          <p style="margin: .35rem 0; color: #555;">현재 세션의 대본을 텍스트로 확인합니다. Step3 결과가 있을 경우 자동으로 불러옵니다.</p>
          <textarea id="data-text-view" style="min-height: 200px;">아직 불러온 대본이 없습니다. "데이터 새로고침" 버튼을 눌러 Step3 완성본을 가져오세요.</textarea>
          <div style="display: flex; gap: .5rem; margin-top: .5rem;">
            <button id="btn-refresh-dataset" class="primary" style="flex: 1;">데이터 새로고침</button>
            <button id="btn-copy-text-view" style="flex: 1;">텍스트 복사</button>
          </div>
        </div>
        <div class="box">
          <div class="label" style="font-size: 1rem;">🧾 대본 메타데이터 (JSON)</div>
          <p style="margin: .35rem 0; color: #555;">장면, 캐릭터, 톤 정보를 JSON 형태로 함께 확인하세요.</p>
          <pre id="data-json-view" style="background: #0f172a; color: #e2e8f0; padding: .75rem; border-radius: 10px; min-height: 200px; white-space: pre-wrap; overflow: auto;">{
  "title": "",
  "scenes": [],
  "tone": "",
  "voices": []
}</pre>
          <div style="display: flex; gap: .5rem; margin-top: .5rem;">
            <button id="btn-copy-json" style="flex: 1;">JSON 복사</button>
            <button id="btn-open-json" style="flex: 1;" data-panel-target="workflow-panel" data-scroll-target="step3-container">워크플로우로 이동</button>
          </div>
        </div>
      </div>

      <div class="box">
        <div class="label" style="font-size: 1rem;">🔎 벤치마킹 대본 분석</div>
        <p style="margin: .35rem 0; color: #555;">벤치마킹할 대본을 입력하면 길이·키워드·감정 톤을 간단히 요약해줍니다.</p>
        <textarea id="benchmark-analysis-input" placeholder="벤치마킹 대본을 붙여 넣으세요." style="min-height: 120px;"></textarea>
        <div style="display: flex; gap: .5rem; margin-top: .5rem; align-items: center;">
          <input type="text" id="benchmark-tag" placeholder="분석 태그 (예: 감동, 코믹)" style="flex: 1; padding: .45rem .6rem;">
          <button id="btn-run-benchmark-analysis" class="primary" style="flex-shrink: 0;">분석하기</button>
        </div>
        <div id="benchmark-analysis-output" style="margin-top: .6rem; background: #f8fafc; border-radius: 10px; padding: .75rem; min-height: 80px; border: 1px dashed #cbd5e1; color: #0f172a;"></div>
      </div>
    </div>

    <!-- 가운데 - 워크플로우 영역 -->
    <div id="workflow-panel" class="panel workflow-panel active">
    <div class="content-area">
      <!-- Step1 앵커 및 컨트롤 -->
      <div id="step1-container"></div>

      <!-- Step2 앵커 및 컨트롤 -->
      <div id="step2-container"></div>

      <!-- Step3 앵커 및 전체 순차실행 -->
      <div id="step3-container"></div>

      <!-- Step1 상단 고정 헤더 (카테고리/시간/지침 + 대본 작성 버튼) -->
      <div class="step1-sticky-header">
        <!-- 워크플로우 박스들이 동적으로 추가되는 영역 (카테고리/시간/지침 입력) -->
        <div id="workflow-boxes-container"></div>

        <!-- Step3 실행: Sonnet 4.5 대본 작성 -->
        <div class="box" style="padding: .6rem .75rem;">
          <button id="btn-execute-step3" class="primary" style="width: 100%; font-size: .9rem; padding: .65rem;">
            🎬 Claude Sonnet 4.5로 대본 작성
          </button>
          <div style="font-size: .75rem; color: #555; margin-top: .35rem; text-align: center;">
            OpenRouter의 Claude Sonnet 4.5 기본 프롬프트로 최종 대본을 생성합니다.
          </div>
        </div>
      </div>

      <!-- 상태 표시 -->
      <div id="status-bar" class="status-bar">작업 중...</div>

      <!-- Step3 결과 박스 -->
      <div id="step3-result-container" class="step3-result-box" style="display: none;">
        <div class="step-header">
          <div class="label">🎬 Step1: OpenRouter 대본 완성 결과</div>
          <div style="display: flex; gap: .5rem;">
            <button id="btn-toggle-script-view" style="padding: .4rem .8rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: .85rem;">📖 대본 보기</button>
            <button id="btn-copy-step3-result" style="padding: .4rem .8rem; background: white; color: #f39c12; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: .85rem;">📋 복사</button>
            <button id="btn-clear-step3-result" style="padding: .4rem .8rem; background: rgba(255,255,255,0.3); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: .85rem;">🗑️ 지우기</button>
          </div>
        </div>
        <div id="step3-token-info" style="font-size: .75rem; color: rgba(255,255,255,0.9); margin-bottom: .5rem; display: none;">
          📥 <span id="step3-input-tokens">0</span> (입력) / 📤 <span id="step3-output-tokens">0</span> (출력) | 💰 <span id="step3-cost">₩0</span>
        </div>
        <!-- JSON 원본 뷰 -->
        <textarea id="step3-result" readonly style="width: 100%; font-size: .9rem; line-height: 1.6; resize: vertical;" placeholder="Step3 결과가 여기에 표시됩니다..."></textarea>
        <!-- 대본 텍스트 뷰 -->
        <div id="step3-script-viewer" style="display: none; background: white; border-radius: 8px; padding: 1rem; max-height: 600px; overflow-y: auto;">
          <div id="step3-script-content" style="font-size: .95rem; line-height: 1.8; color: #333;"></div>
        </div>
      </div>

      <!-- Step4: 이미지 생성 -->
      <div id="step4-container" class="step4-container" style="display: none;">
        <div class="step-header">
          <div class="label">🎨 Step2: 장면 이미지 생성</div>
          <div style="display: flex; gap: .5rem;">
            <button id="btn-generate-all-auto" class="step4-btn" style="background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: white; font-weight: 700; padding: .5rem 1rem;">🚀 전체 생성</button>
            <button id="btn-clear-step4" class="step4-btn" style="background: rgba(255,255,255,0.3); color: white;">🗑️ 초기화</button>
          </div>
        </div>

        <!-- 전체 자동 생성 진행 상황 -->
        <div id="auto-generate-progress" style="display: none; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; padding: 1rem; margin-bottom: .75rem; color: white;">
          <div style="font-weight: 600; margin-bottom: .5rem;">🤖 전체 자동 생성 진행 중...</div>
          <div id="auto-generate-status" style="font-size: .85rem; margin-bottom: .5rem;">준비 중...</div>
          <div style="background: rgba(255,255,255,0.3); border-radius: 4px; height: 8px; overflow: hidden;">
            <div id="auto-generate-progress-bar" style="background: white; height: 100%; width: 0%; transition: width 0.3s ease;"></div>
          </div>
          <div id="auto-generate-details" style="font-size: .75rem; margin-top: .5rem; opacity: 0.9;"></div>
        </div>

        <!-- 1단계: 인물 분석 -->
        <div class="step4-prompt-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
            <div class="prompt-label">👥 1단계: 등장인물 분석</div>
            <button id="btn-analyze-characters" class="step4-btn" style="padding: .4rem .8rem; font-size: .85rem;">🔍 대본에서 인물 추출</button>
          </div>
          <div id="step4-characters-list" style="background: rgba(255,255,255,0.95); border-radius: 8px; padding: .75rem; min-height: 60px;">
            <div style="color: #999; text-align: center; font-size: .85rem;">대본을 분석하면 등장인물이 여기에 표시됩니다</div>
          </div>
        </div>

        <!-- 2단계: 인물 이미지 생성 -->
        <div class="step4-prompt-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
            <div class="prompt-label">👤 2단계: 인물 이미지 생성</div>
            <div style="display: flex; gap: .5rem; align-items: center;">
              <select id="step4-character-select" style="padding: .4rem; border-radius: 6px; border: 1px solid #ddd; font-size: .85rem; min-width: 120px;">
                <option value="">-- 인물 선택 --</option>
              </select>
              <button id="btn-generate-character-image" class="step4-btn" style="padding: .4rem .8rem; font-size: .85rem;">🖼️ 인물 이미지 생성</button>
            </div>
          </div>
          <textarea id="step4-character-prompt" placeholder="선택한 인물의 이미지 프롬프트가 여기에 표시됩니다. 직접 수정도 가능합니다."></textarea>
          <div id="step4-character-images" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: .5rem; margin-top: .5rem;"></div>
        </div>

        <!-- 3단계: 씬 이미지 생성 -->
        <div class="step4-prompt-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
            <div class="prompt-label">🎬 3단계: 씬 이미지 생성</div>
            <div style="display: flex; gap: .5rem; align-items: center; flex-wrap: wrap;">
              <select id="step4-scene-select" style="padding: .4rem; border-radius: 6px; border: 1px solid #ddd; font-size: .85rem; min-width: 120px;">
                <option value="">-- 씬 선택 --</option>
              </select>
              <button id="btn-generate-scene-prompt" class="step4-btn" style="padding: .4rem .8rem; font-size: .85rem;">📝 프롬프트만</button>
              <button id="btn-generate-scene-all" class="step4-btn" style="padding: .4rem .8rem; font-size: .85rem; background: linear-gradient(135deg, #10b981, #059669); font-weight: 700;">🎬 프롬프트+이미지</button>
            </div>
          </div>

          <div style="margin-bottom: .5rem;">
            <div style="font-size: .8rem; color: rgba(255,255,255,0.9); margin-bottom: .25rem;">🏞️ 배경 프롬프트</div>
            <textarea id="step4-background-prompt" placeholder="씬의 배경 프롬프트가 여기에 표시됩니다."></textarea>
          </div>

          <div style="margin-bottom: .5rem;">
            <div style="font-size: .8rem; color: rgba(255,255,255,0.9); margin-bottom: .25rem;">👥 등장 인물 (씬에 포함될 인물 선택)</div>
            <div id="step4-scene-characters" style="display: flex; flex-wrap: wrap; gap: .5rem; background: rgba(255,255,255,0.1); padding: .5rem; border-radius: 6px; min-height: 40px;">
              <span style="color: rgba(255,255,255,0.6); font-size: .85rem;">인물 분석 후 선택 가능</span>
            </div>
          </div>

          <div>
            <div style="font-size: .8rem; color: rgba(255,255,255,0.9); margin-bottom: .25rem;">🎭 통합 씬 프롬프트 (인물 + 배경)</div>
            <textarea id="step4-combined-prompt" placeholder="인물들이 배경에 자연스럽게 어울리는 통합 장면 프롬프트입니다."></textarea>
          </div>
        </div>

        <!-- 이미지 모델 선택 -->
        <div style="display: flex; gap: .5rem; margin-bottom: .5rem; flex-wrap: wrap;">
          <button class="step4-image-provider selected" data-provider="gemini" style="flex: 1; min-width: 100px; padding: .5rem; border: 2px solid #10b981; border-radius: 8px; background: rgba(16,185,129,0.2); cursor: pointer; font-weight: 600; font-size: .85rem;">
            ✨ Gemini<br><span style="font-size: .7rem; font-weight: normal; color: #666;">$0.039/장 (빠름)</span>
          </button>
          <button class="step4-image-provider" data-provider="flux" style="flex: 1; min-width: 100px; padding: .5rem; border: 2px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-weight: 600; font-size: .85rem;">
            ⚡ FLUX.1 Pro<br><span style="font-size: .7rem; font-weight: normal; color: #666;">$0.055/장 (고품질)</span>
          </button>
          <button class="step4-image-provider" data-provider="dalle" style="flex: 1; min-width: 100px; padding: .5rem; border: 2px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-weight: 600; font-size: .85rem;">
            🎨 DALL-E 3<br><span style="font-size: .7rem; font-weight: normal; color: #666;">$0.08/장 (창의적)</span>
          </button>
        </div>

        <!-- 이미지 생성 버튼 영역 -->
        <div style="display: flex; gap: .5rem; margin-bottom: .75rem;">
          <button id="btn-generate-image" class="step4-btn" style="flex: 1; padding: .75rem; font-size: .95rem; font-weight: 700;">
            🖼️ 씬 이미지 생성 (Gemini)
          </button>
          <select id="step4-image-size" style="padding: .5rem; border-radius: 6px; border: 1px solid #ddd; font-size: .85rem;">
            <option value="1024x1024">1024x1024 (정사각형)</option>
            <option value="1792x1024" selected>1792x1024 (가로형)</option>
            <option value="1024x1792">1024x1792 (세로형)</option>
          </select>
        </div>

        <!-- 유튜브 썸네일 자동 생성 -->
        <div style="background: white; border-radius: 8px; padding: .75rem; margin-bottom: .75rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
            <div>
              <div style="font-weight: 700; font-size: .95rem; color: #333;">🎬 유튜브 썸네일 (자동 생성)</div>
              <div style="font-size: .75rem; color: #666; margin-top: .25rem;">AI가 대본을 분석하여 클릭을 유도하는 썸네일을 만듭니다</div>
            </div>
            <button id="btn-generate-thumbnail" class="step4-btn" style="padding: .5rem 1rem; font-size: .85rem; background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">
              📸 썸네일 생성
            </button>
          </div>

          <div id="step4-thumbnail-preview" style="display: none; margin-top: .75rem;">
            <div style="display: flex; gap: .75rem; align-items: flex-start; padding: .75rem; background: #f8f9fa; border-radius: 6px;">
              <div style="position: relative;">
                <img id="step4-thumbnail-image" style="width: 240px; height: 135px; border-radius: 6px; border: 2px solid #ff6b6b; object-fit: cover;" />
                <div id="step4-thumbnail-text-overlay" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: .5rem; border-radius: 4px; font-weight: 700; font-size: .9rem; text-align: center;">
                  썸네일 텍스트
                </div>
              </div>
              <div style="flex: 1;">
                <div style="font-size: .85rem; color: #333; line-height: 1.6;">
                  <p style="margin: 0 0 .5rem 0; font-weight: 600; color: #ff6b6b;">✅ 유튜브 썸네일</p>
                  <p style="margin: 0 0 .5rem 0; font-size: .8rem; color: #666;">이 이미지가 유튜브 업로드 시 썸네일로 사용됩니다</p>
                  <div style="margin-top: .75rem; padding: .5rem; background: white; border-radius: 4px; font-size: .75rem; color: #666;">
                    <strong>프롬프트:</strong> <span id="step4-thumbnail-prompt">-</span>
                  </div>
                  <button id="btn-regenerate-thumbnail" style="margin-top: .5rem; padding: .4rem .8rem; font-size: .8rem; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    🔄 다시 생성
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 생성된 이미지 표시 영역 -->
        <div id="step4-image-result" style="background: white; border-radius: 8px; padding: .75rem; min-height: 100px;">
          <div id="step4-image-placeholder" style="text-align: center; color: #999; padding: 2rem;">
            <div style="font-size: 2rem; margin-bottom: .5rem;">🖼️</div>
            <p>이미지를 생성하면 여기에 표시됩니다</p>
          </div>
          <div id="step4-image-grid" class="step4-image-grid" style="display: none;"></div>
        </div>

        <!-- 토큰/비용 정보 -->
        <div id="step4-cost-info" style="font-size: .75rem; color: rgba(255,255,255,0.9); margin-top: .5rem; display: none;">
          🖼️ 이미지 생성 비용: <span id="step4-image-cost">₩0</span>
        </div>
      </div>

      <!-- Step5: TTS 음성 합성 및 자막 생성 -->
      <div id="step5-container" class="step5-container" style="display: none;">
        <div class="step-header">
          <div class="label">🎙️ Step3: 음성 합성 (TTS) & 자막</div>
          <div style="display: flex; gap: .5rem;">
            <button id="btn-clear-step5" class="step5-btn" style="background: rgba(255,255,255,0.3); color: white;">🗑️ 초기화</button>
          </div>
        </div>

        <!-- TTS 제공자 선택 -->
        <div class="step5-section">
          <div class="section-label">🔊 TTS 제공자</div>
          <div style="display: flex; gap: .5rem; margin-bottom: .75rem;">
            <button class="step5-tts-provider selected" data-provider="google" style="flex: 1; padding: .5rem; border: 2px solid #10b981; border-radius: 8px; background: rgba(16,185,129,0.2); cursor: pointer; font-weight: 600;">
              🌐 Google Cloud<br><span style="font-size: .7rem; font-weight: normal; color: #666;">₩16/3000자 (저렴)</span>
            </button>
            <button class="step5-tts-provider" data-provider="naver" style="flex: 1; padding: .5rem; border: 2px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-weight: 600;">
              🇰🇷 네이버 클로바<br><span style="font-size: .7rem; font-weight: normal; color: #666;">₩12,000/3000자 (고품질)</span>
            </button>
          </div>
        </div>

        <!-- 음성 선택 영역 -->
        <div class="step5-section">
          <div class="section-label" id="step5-voice-label">🎤 음성 선택 (Google Cloud) <span style="font-size: .75rem; font-weight: normal; color: rgba(255,255,255,0.7);">- 클릭하여 미리듣기</span></div>

          <!-- Google TTS 음성 -->
          <div id="step5-voice-google" class="step5-voice-select">
            <div class="step5-voice-option selected" data-voice="ko-KR-Wavenet-A" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">여성 A</div>
                  <div style="font-size: .7rem; color: #666;">Wavenet (자연스러움)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Wavenet-A', 'google')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="ko-KR-Wavenet-B" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">여성 B</div>
                  <div style="font-size: .7rem; color: #666;">Wavenet</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Wavenet-B', 'google')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="ko-KR-Wavenet-C" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">남성 A</div>
                  <div style="font-size: .7rem; color: #666;">Wavenet</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Wavenet-C', 'google')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="ko-KR-Wavenet-D" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">남성 B</div>
                  <div style="font-size: .7rem; color: #666;">Wavenet</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Wavenet-D', 'google')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="ko-KR-Neural2-A" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">여성 (Neural)</div>
                  <div style="font-size: .7rem; color: #666;">Neural2 (최고품질)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Neural2-A', 'google')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="ko-KR-Neural2-C" data-provider="google">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">남성 (Neural)</div>
                  <div style="font-size: .7rem; color: #666;">Neural2 (최고품질)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('ko-KR-Neural2-C', 'google')">▶️</button>
              </div>
            </div>
          </div>

          <!-- 네이버 TTS 음성 (숨김) -->
          <div id="step5-voice-naver" class="step5-voice-select" style="display: none;">
            <div class="step5-voice-option" data-voice="nara" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">나라</div>
                  <div style="font-size: .7rem; color: #666;">여성 (기본)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('nara', 'naver')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="nara_call" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">나라 (밝음)</div>
                  <div style="font-size: .7rem; color: #666;">여성 (경쾌)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('nara_call', 'naver')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="nminsang" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">민상</div>
                  <div style="font-size: .7rem; color: #666;">남성</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('nminsang', 'naver')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="njiyun" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">지윤</div>
                  <div style="font-size: .7rem; color: #666;">여성 (밝음)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('njiyun', 'naver')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="nsujin" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">수진</div>
                  <div style="font-size: .7rem; color: #666;">여성 (차분)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('nsujin', 'naver')">▶️</button>
              </div>
            </div>
            <div class="step5-voice-option" data-voice="jinho" data-provider="naver">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">진호</div>
                  <div style="font-size: .7rem; color: #666;">남성 (차분)</div>
                </div>
                <button class="voice-preview-btn" onclick="event.stopPropagation(); previewVoice('jinho', 'naver')">▶️</button>
              </div>
            </div>
          </div>
        </div>

        <!-- TTS 설정 -->
        <div class="step5-section">
          <div class="section-label">⚙️ 음성 설정</div>
          <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 100px;">
              <label style="font-size: .8rem; color: #666;">속도</label>
              <input type="range" id="step5-speed" min="-5" max="5" value="-1" style="width: 100%;">
              <div style="display: flex; justify-content: space-between; font-size: .7rem; color: #999;">
                <span>느림</span><span>보통</span><span>빠름</span>
              </div>
            </div>
            <div style="flex: 1; min-width: 100px;">
              <label style="font-size: .8rem; color: #666;">음높이</label>
              <input type="range" id="step5-pitch" min="-5" max="5" value="0" style="width: 100%;">
              <div style="display: flex; justify-content: space-between; font-size: .7rem; color: #999;">
                <span>낮음</span><span>보통</span><span>높음</span>
              </div>
            </div>
            <div style="flex: 1; min-width: 100px;">
              <label style="font-size: .8rem; color: #666;">볼륨</label>
              <input type="range" id="step5-volume" min="-5" max="5" value="0" style="width: 100%;">
              <div style="display: flex; justify-content: space-between; font-size: .7rem; color: #999;">
                <span>작음</span><span>보통</span><span>큼</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 대본 텍스트 (TTS용) -->
        <div class="step5-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .4rem;">
            <div class="section-label">📜 TTS용 대본 텍스트</div>
            <button id="btn-extract-narration" class="step5-btn" style="padding: .3rem .6rem; font-size: .75rem;">📝 지문만 추출</button>
          </div>
          <textarea id="step5-script-text" style="width: 100%; min-height: 120px; border: 1px solid #ddd; border-radius: 6px; padding: .5rem; font-size: .85rem; resize: vertical;" placeholder="Step3 대본에서 TTS로 읽을 텍스트를 입력하세요. '지문만 추출' 버튼으로 나레이션 부분만 추출할 수 있습니다."></textarea>
        </div>

        <!-- TTS 생성 버튼 -->
        <div style="display: flex; gap: .5rem; margin-bottom: .75rem;">
          <button id="btn-generate-tts" class="step5-btn" style="flex: 1; padding: .75rem; font-size: .95rem; font-weight: 700;">
            🎙️ 음성 생성 (TTS)
          </button>
          <button id="btn-generate-subtitle" class="step5-btn" style="flex: 1; padding: .75rem; font-size: .95rem; font-weight: 700;">
            📝 자막 생성 (SRT)
          </button>
        </div>

        <!-- 오디오 플레이어 -->
        <div class="step5-section" id="step5-audio-section" style="display: none;">
          <div class="section-label">🔊 생성된 음성</div>
          <audio id="step5-audio-player" class="step5-audio-player" controls></audio>
          <div style="display: flex; gap: .5rem; margin-top: .5rem;">
            <button id="btn-download-audio" class="step5-btn" style="flex: 1; padding: .4rem;">💾 음성 다운로드 (MP3)</button>
          </div>
        </div>

        <!-- 자막 미리보기 -->
        <div class="step5-section" id="step5-subtitle-section" style="display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .4rem;">
            <div class="section-label">📝 자막 미리보기</div>
            <div style="display: flex; gap: .5rem;">
              <button id="btn-download-srt" class="step5-btn" style="padding: .3rem .6rem; font-size: .75rem;">💾 SRT 다운로드</button>
              <button id="btn-download-vtt" class="step5-btn" style="padding: .3rem .6rem; font-size: .75rem;">💾 VTT 다운로드</button>
            </div>
          </div>
          <div id="step5-subtitle-preview" class="step5-subtitle-preview">
            자막이 여기에 표시됩니다...
          </div>
        </div>

        <!-- 비용 정보 -->
        <div id="step5-cost-info" style="font-size: .75rem; color: rgba(255,255,255,0.9); margin-top: .5rem; display: none;">
          🎙️ TTS 생성 비용: <span id="step5-tts-cost">₩0</span> | 글자 수: <span id="step5-char-count">0</span>자
        </div>
      </div>

      <!-- Step6: 영상 제작 -->
      <div id="step6-container" class="step6-container">
        <div class="step-header">
          <div class="label">🎬 Step4: 영상 제작</div>
          <div style="display: flex; gap: .5rem;">
            <button id="btn-clear-step6" class="step6-btn" style="background: rgba(255,255,255,0.3); color: white;">🗑️ 초기화</button>
          </div>
        </div>

        <!-- 이미지 선택 영역 -->
        <div class="step6-section">
          <div class="section-label">🖼️ 사용할 이미지 선택 (Step2에서 생성)</div>
          <div id="step6-image-grid" class="step6-preview-grid">
            <div style="color: #999; text-align: center; padding: 1rem; grid-column: 1/-1;">
              Step2에서 이미지를 생성하면 여기에 표시됩니다
            </div>
          </div>
        </div>

        <!-- 오디오 선택 영역 -->
        <div class="step6-section">
          <div class="section-label">🎙️ 사용할 음성 (Step3에서 생성)</div>
          <div id="step6-audio-status" style="padding: .5rem; background: #f8f9fa; border-radius: 6px; font-size: .85rem; color: #666;">
            Step3에서 음성을 생성하면 자동으로 연결됩니다
          </div>
          <audio id="step6-audio-preview" style="width: 100%; margin-top: .5rem; display: none;" controls></audio>
        </div>

        <!-- 자막 옵션 -->
        <div class="step6-section">
          <div class="section-label">📝 자막 옵션</div>
          <div style="display: flex; gap: 1rem; align-items: center;">
            <label style="display: flex; align-items: center; gap: .3rem; cursor: pointer;">
              <input type="checkbox" id="step6-include-subtitle" checked>
              <span style="font-size: .85rem;">자막 포함</span>
            </label>
            <label style="display: flex; align-items: center; gap: .3rem; cursor: pointer;">
              <input type="checkbox" id="step6-burn-subtitle" checked>
              <span style="font-size: .85rem;">자막 하드코딩 (영상에 굽기)</span>
            </label>
          </div>
        </div>

        <!-- 영상 설정 -->
        <div class="step6-section">
          <div class="section-label">⚙️ 영상 설정</div>
          <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 120px;">
              <label style="font-size: .8rem; color: #666;">해상도</label>
              <select id="step6-resolution" style="width: 100%; padding: .4rem; border-radius: 6px; border: 1px solid #ddd;">
                <option value="1920x1080">1920x1080 (FHD)</option>
                <option value="1280x720">1280x720 (HD)</option>
                <option value="1080x1920">1080x1920 (세로형)</option>
                <option value="1080x1080">1080x1080 (정사각형)</option>
              </select>
            </div>
            <div style="flex: 1; min-width: 120px;">
              <label style="font-size: .8rem; color: #666;">FPS</label>
              <select id="step6-fps" style="width: 100%; padding: .4rem; border-radius: 6px; border: 1px solid #ddd;">
                <option value="24">24 fps (영화)</option>
                <option value="30" selected>30 fps (표준)</option>
                <option value="60">60 fps (부드러움)</option>
              </select>
            </div>
            <div style="flex: 1; min-width: 120px;">
              <label style="font-size: .8rem; color: #666;">이미지 전환 효과</label>
              <select id="step6-transition" style="width: 100%; padding: .4rem; border-radius: 6px; border: 1px solid #ddd;">
                <option value="none">없음</option>
                <option value="fade" selected>페이드</option>
                <option value="crossfade">크로스페이드</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 영상 생성 버튼 -->
        <div style="display: flex; gap: .5rem; margin-bottom: .75rem;">
          <button id="btn-generate-video" class="step6-btn" style="flex: 1; padding: .75rem; font-size: .95rem; font-weight: 700;">
            🎬 영상 생성
          </button>
        </div>

        <!-- 영상 미리보기 -->
        <div class="step6-section" id="step6-video-section" style="display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .4rem;">
            <div class="section-label">🎥 생성된 영상</div>
            <button id="btn-download-video" class="step6-btn" style="padding: .3rem .6rem; font-size: .75rem;">💾 다운로드 (MP4)</button>
          </div>
          <div class="step6-video-preview">
            <video id="step6-video-player" controls></video>
          </div>
        </div>

        <!-- 진행 상태 -->
        <div id="step6-progress" style="display: none;">
          <div style="background: white; border-radius: 8px; padding: .75rem;">
            <div style="font-size: .85rem; color: #333; margin-bottom: .5rem;">
              <span id="step6-progress-text">영상 생성 중...</span>
            </div>
            <div style="background: #e0e0e0; border-radius: 4px; height: 8px; overflow: hidden;">
              <div id="step6-progress-bar" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step7: 유튜브 업로드 - 비활성화됨 -->
      <div id="step7-container" class="step7-container" style="display: none !important;">
        <div class="step-header">
          <div class="label">📺 Step5: 유튜브 업로드</div>
          <div style="display: flex; gap: .5rem;">
            <button id="btn-youtube-auth" class="step7-btn">🔑 YouTube 연결</button>
          </div>
        </div>

        <!-- 인증 상태 -->
        <div class="step7-section">
          <div id="youtube-auth-status" style="padding: .5rem; background: #fff3cd; border-radius: 6px; font-size: .85rem; color: #856404;">
            ⚠️ YouTube 계정을 연결해주세요
          </div>
        </div>

        <!-- 채널 선택 -->
        <div class="step7-section" id="youtube-channel-section" style="display: none; background: linear-gradient(135deg, #e8f5e9, #fff); border: 2px solid #4caf50; box-shadow: 0 0 10px rgba(76,175,80,0.3);">
          <div class="section-label" style="color: #2e7d32;">📺 업로드 채널 선택 (필수)</div>
          <select id="step7-channel-select" class="step7-input" style="cursor: pointer; border: 2px solid #4caf50;">
            <option value="">채널을 선택하세요</option>
          </select>
          <div style="margin-top: 0.5rem; font-size: 0.85rem; color: #2e7d32;">
            ✅ 채널이 로드되었습니다. 위에서 업로드할 채널을 선택해주세요.
          </div>
        </div>

        <!-- 영상 정보 입력 -->
        <div class="step7-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem;">
            <div class="section-label" style="margin-bottom: 0;">📝 영상 정보</div>
            <button id="btn-auto-metadata" class="step7-btn" style="padding: .4rem .8rem; font-size: .8rem;">🤖 대본 기반 자동 입력</button>
          </div>
          <input type="text" id="step7-title" class="step7-input" placeholder="영상 제목" maxlength="100">
          <textarea id="step7-description" class="step7-input" style="min-height: 80px; resize: vertical;" placeholder="영상 설명&#10;&#10;해시태그, 링크 등을 포함할 수 있습니다." maxlength="5000"></textarea>
          <input type="text" id="step7-tags" class="step7-input" placeholder="태그 (쉼표로 구분: 드라마, 단편영화, 감동)" maxlength="500">
        </div>

        <!-- 공개 설정 -->
        <div class="step7-section">
          <div class="section-label">🔒 공개 설정</div>
          <div id="step7-privacy-options">
            <label class="step7-privacy-option" data-privacy="private">
              <input type="radio" name="step7-privacy" value="private" style="display: none;">
              🔒 비공개
            </label>
            <label class="step7-privacy-option" data-privacy="unlisted">
              <input type="radio" name="step7-privacy" value="unlisted" style="display: none;">
              🔗 일부공개
            </label>
            <label class="step7-privacy-option" data-privacy="public">
              <input type="radio" name="step7-privacy" value="public" style="display: none;">
              🌍 공개
            </label>
            <label class="step7-privacy-option selected" data-privacy="scheduled">
              <input type="radio" name="step7-privacy" value="scheduled" checked style="display: none;">
              📅 예약 (30분 후 공개)
            </label>
          </div>
        </div>

        <!-- 카테고리 -->
        <div class="step7-section">
          <div class="section-label">📁 카테고리</div>
          <select id="step7-category" class="step7-input" style="margin-bottom: 0;">
            <option value="22">사람 및 블로그</option>
            <option value="24">엔터테인먼트</option>
            <option value="1">영화 및 애니메이션</option>
            <option value="10">음악</option>
            <option value="23">코미디</option>
            <option value="27">교육</option>
            <option value="25">뉴스 및 정치</option>
            <option value="26">노하우 및 스타일</option>
          </select>
        </div>

        <!-- 업로드 버튼 -->
        <div style="display: flex; gap: .5rem; margin-bottom: .5rem;">
          <button id="btn-upload-youtube" class="step7-btn" style="flex: 1; padding: .75rem; font-size: .95rem; font-weight: 700;" disabled>
            📺 YouTube에 업로드
          </button>
        </div>

        <!-- 업로드 상태 메시지 -->
        <div id="step7-upload-status" style="padding: .4rem .6rem; background: #fff3cd; border-radius: 6px; font-size: .8rem; color: #856404; margin-bottom: .75rem;">
          Step4에서 영상을 먼저 생성해주세요
        </div>

        <!-- 업로드 진행 상태 -->
        <div id="step7-progress" style="display: none;">
          <div style="background: white; border-radius: 8px; padding: .75rem;">
            <div style="font-size: .85rem; color: #333; margin-bottom: .5rem;">
              <span id="step7-progress-text">업로드 준비 중...</span>
            </div>
            <div style="background: #e0e0e0; border-radius: 4px; height: 8px; overflow: hidden;">
              <div id="step7-progress-bar" style="background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
            </div>
          </div>
        </div>

        <!-- 업로드 결과 -->
        <div class="step7-section" id="step7-result" style="display: none;">
          <div class="section-label">✅ 업로드 완료</div>
          <div style="padding: .5rem; background: #d4edda; border-radius: 6px;">
            <a id="step7-video-link" href="#" target="_blank" style="color: #155724; font-weight: 600; text-decoration: none;">
              🎬 업로드된 영상 보기
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- 패스워드 모달 -->
  <div id="modal-password" class="modal">
    <div class="modal-content">
      <div class="modal-title">🔒 지침 영역 잠금</div>
      <p style="color: #666; font-size: .9rem; margin-bottom: 1rem;">지침 영역에 접근하려면 패스워드를 입력하세요.</p>
      <input type="password" id="password-input" placeholder="패스워드 입력" style="margin-bottom: .5rem;">
      <div class="modal-buttons">
        <button id="btn-cancel-password">취소</button>
        <button id="btn-submit-password" class="primary">확인</button>
      </div>
    </div>
  </div>

  <!-- GPT PRO 패스워드 모달 -->
  <div id="modal-gpt-pro-password" class="modal">
    <div class="modal-content">
      <div class="modal-title">🔒 GPT PRO 실행 (테스트 중)</div>
      <p style="color: #666; font-size: .9rem; margin-bottom: 1rem;">이 기능은 현재 테스트 중입니다. 패스워드를 입력하세요.</p>
      <input type="password" id="gpt-pro-password-input" placeholder="패스워드 입력" style="margin-bottom: .5rem;">
      <div class="modal-buttons">
        <button id="btn-cancel-gpt-pro-password">취소</button>
        <button id="btn-submit-gpt-pro-password" class="primary">확인</button>
      </div>
    </div>
  </div>

  <!-- 작업 지침 관리 모달 -->
  <div id="modal-guide-management" class="modal">
    <div class="modal-content" style="max-width: 800px; width: 90%; max-height: 90vh; display: flex; flex-direction: column;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <div class="modal-title" style="margin: 0;">📝 작업 지침 관리</div>
        <div style="display: flex; gap: .5rem;">
          <button id="btn-modal-save-guides" style="padding: .4rem 1rem; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: .9rem;">💾 저장</button>
          <button id="btn-close-guide-modal" style="padding: .4rem 1rem; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: .9rem;">닫기</button>
        </div>
      </div>
      <div style="font-size: .85rem; color: #666; margin-bottom: 1rem; padding: .75rem; background: #f8f9fa; border-radius: 6px;">
        모든 Step(1~7)의 작업 지침과 JSON 스타일 가이드를 한 곳에서 관리합니다. 수정 후 <strong>💾 저장</strong> 버튼을 눌러주세요.
      </div>
      <div id="modal-guide-container" style="flex: 1; overflow-y: auto; padding-right: .5rem;">
        <p style="color: #999; text-align: center; padding: 2rem;">작업 박스를 추가하면 여기에 표시됩니다.</p>
      </div>
    </div>
  </div>

  <!-- 영상 시간 관리 모달 -->
  <div id="modal-categories" class="modal">
    <div class="modal-content">
      <div class="modal-title">영상 시간 관리</div>
      <input type="text" id="new-cat-label" placeholder="표시 이름 (예: 90분, 120분)" style="margin-bottom: .5rem;">
      <button id="btn-add-category" class="primary" style="width: 100%; margin-bottom: 1rem;">추가</button>
      <div id="categories-list" style="max-height: 300px; overflow-y: auto;"></div>
      <div class="modal-buttons">
        <button id="btn-close-categories">닫기</button>
      </div>
    </div>
  </div>

  <!-- 처리 단계 관리 모달 -->
  <div id="modal-steps" class="modal">
    <div class="modal-content">
      <div class="modal-title">처리 단계 관리</div>
      <p style="font-size: .85rem; color: #666; margin-bottom: .5rem;">
        스타일: <strong id="modal-steps-style"></strong>
      </p>
      <input type="text" id="new-step-name" placeholder="단계 이름 (예: 캐릭터 설정, 스토리라인, 대사 작성)" style="margin-bottom: .5rem;">
      <button id="btn-add-step" class="primary" style="width: 100%; margin-bottom: 1rem;">추가</button>
      <div id="steps-list" style="max-height: 300px; overflow-y: auto;"></div>
      <div class="modal-buttons">
        <button id="btn-close-steps">닫기</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <!-- Drama Lab JavaScript (분리된 모듈) -->
  <script src="/static/js/drama-utils.js"></script>
  <script src="/static/js/drama-session.js"></script>
  <script src="/static/js/drama-main.js"></script>
  <script src="/static/js/drama-step1.js"></script>
  <script src="/static/js/drama-step2.js"></script>
  <script src="/static/js/drama-step3.js"></script>
  <script src="/static/js/drama-step4.js"></script>
  <script src="/static/js/drama-step5.js"></script>

</body>
</html>