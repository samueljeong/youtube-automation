<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Drama Lab</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%23667eea' width='32' height='32' rx='6'/><text x='16' y='22' font-size='18' fill='white' text-anchor='middle' font-weight='bold'>D</text></svg>">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/drama.css') }}">
</head>
<body>
  <!-- Auth Header -->
  <div class="auth-header">
    <h1>Drama Lab</h1>
    <div class="auth-links">
      <span id="session-info" class="session-info"></span>
      <button id="btn-new-session" class="btn-header" onclick="DramaMain.newSession()">새 프로젝트</button>
      <a href="/" class="btn-home">홈</a>
    </div>
  </div>

  <div id="drama-app">
    <!-- Step Progress Bar -->
    <div class="step-progress">
      <div class="step-item active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">대본 생성</div>
      </div>
      <div class="step-connector"></div>
      <div class="step-item" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">이미지 생성</div>
      </div>
      <div class="step-connector"></div>
      <div class="step-item" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">TTS 음성</div>
      </div>
      <div class="step-connector"></div>
      <div class="step-item" data-step="4">
        <div class="step-number">4</div>
        <div class="step-label">영상 제작</div>
      </div>
      <div class="step-connector"></div>
      <div class="step-item" data-step="5">
        <div class="step-number">5</div>
        <div class="step-label">업로드</div>
      </div>
    </div>

    <!-- Step Containers -->
    <div class="step-containers">
      <!-- Step 1: 대본 입력 -->
      <div id="step1-container" class="step-container active">
        <div class="step-header">
          <h2>Step 1. 대본 입력</h2>
          <p class="step-desc">대본과 이미지 프롬프트를 입력해주세요. (4개 씬 구성)</p>
        </div>

        <div class="step-content">
          <!-- YouTube 연결 상태 (상단 배치) -->
          <div id="youtube-auth-panel" class="youtube-auth-panel">
            <div class="auth-status-row">
              <span id="yt-status-icon" class="auth-icon">🔗</span>
              <span id="yt-status-text">YouTube 연결 확인 중...</span>
              <button id="btn-yt-connect" class="btn-small btn-youtube hidden" onclick="DramaStep1.connectYouTube()">YouTube 연결</button>
            </div>
          </div>

          <!-- 기본 설정 패널 -->
          <div class="config-panel">
            <div class="config-row">
              <div class="config-item">
                <label>채널 타입</label>
                <select id="channel-type">
                  <option value="senior-nostalgia" selected>시니어 향수 채널 (A채널)</option>
                  <option value="testimony">신앙 간증 채널</option>
                  <option value="default">일반 드라마 채널</option>
                </select>
              </div>
              <div class="config-item">
                <label>주인공 성별</label>
                <select id="protagonist-gender">
                  <option value="female" selected>여성 (할머니)</option>
                  <option value="male">남성 (할아버지)</option>
                </select>
              </div>
              <div class="config-item">
                <label>TTS 음성 품질</label>
                <select id="tts-voice-quality">
                  <option value="standard">Standard (저렴)</option>
                  <option value="wavenet" selected>Wavenet (고품질)</option>
                  <option value="neural2">Neural2 (최고품질)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 주인공/캐릭터 정보 -->
          <div class="script-input-section">
            <div class="section-header">
              <h3>👤 주인공 정보</h3>
              <span class="section-hint">주인공의 이름, 나이, 외모 특징 등</span>
            </div>
            <textarea id="character-info" class="script-textarea" rows="4" placeholder="예: 박봉수, 70세, 작은 한식당 주인, 앞치마 차림, 경계하는 표정, 한국인 할아버지"></textarea>
          </div>

          <!-- 씬 1 -->
          <div class="scene-input-group">
            <div class="scene-header">
              <h3>🎬 씬 1</h3>
            </div>
            <div class="scene-inputs">
              <div class="input-row">
                <label>이미지 프롬프트 (영문)</label>
                <textarea id="scene1-image-prompt" class="script-textarea" rows="4" placeholder="Night, small Korean restaurant interior. Three men at wooden table. Cooling soybean stew in center..."></textarea>
              </div>
              <div class="input-row">
                <label>나레이션 (한글 TTS)</label>
                <textarea id="scene1-narration" class="script-textarea" rows="4" placeholder="그날 밤이었습니다. 저는 46년 만에 처음으로 그 이름을 들었습니다..."></textarea>
              </div>
            </div>
          </div>

          <!-- 씬 2 -->
          <div class="scene-input-group">
            <div class="scene-header">
              <h3>🎬 씬 2</h3>
            </div>
            <div class="scene-inputs">
              <div class="input-row">
                <label>이미지 프롬프트 (영문)</label>
                <textarea id="scene2-image-prompt" class="script-textarea" rows="4" placeholder="Same restaurant. Old black-and-white photograph on table showing young security guard..."></textarea>
              </div>
              <div class="input-row">
                <label>나레이션 (한글 TTS)</label>
                <textarea id="scene2-narration" class="script-textarea" rows="4" placeholder="젊은 남자가 드디어 입을 열었습니다..."></textarea>
              </div>
            </div>
          </div>

          <!-- 씬 3 -->
          <div class="scene-input-group">
            <div class="scene-header">
              <h3>🎬 씬 3</h3>
            </div>
            <div class="scene-inputs">
              <div class="input-row">
                <label>이미지 프롬프트 (영문)</label>
                <textarea id="scene3-image-prompt" class="script-textarea" rows="4" placeholder="Emotional confrontation. Lee Chang-su crying at table..."></textarea>
              </div>
              <div class="input-row">
                <label>나레이션 (한글 TTS)</label>
                <textarea id="scene3-narration" class="script-textarea" rows="4" placeholder="이창수 씨가 사진을 집어 들었습니다..."></textarea>
              </div>
            </div>
          </div>

          <!-- 씬 4 -->
          <div class="scene-input-group">
            <div class="scene-header">
              <h3>🎬 씬 4</h3>
            </div>
            <div class="scene-inputs">
              <div class="input-row">
                <label>이미지 프롬프트 (영문)</label>
                <textarea id="scene4-image-prompt" class="script-textarea" rows="4" placeholder="Late night restaurant. Park Bong-su holding young man's hand..."></textarea>
              </div>
              <div class="input-row">
                <label>나레이션 (한글 TTS)</label>
                <textarea id="scene4-narration" class="script-textarea" rows="4" placeholder="밤이 깊어진 식당에서..."></textarea>
              </div>
            </div>
          </div>

          <!-- 액션 버튼 -->
          <div class="action-buttons">
            <button id="btn-save-script" class="btn-primary btn-large" onclick="DramaStep1.saveManualScript()">
              <span class="btn-icon">💾</span> 대본 저장 및 다음 단계
            </button>
          </div>

          <!-- 저장 완료 메시지 -->
          <div id="step1-saved-notice" class="saved-notice hidden">
            <span class="notice-icon">✅</span>
            <span>대본이 저장되었습니다. 다음 단계로 진행하세요.</span>
          </div>
        </div>
      </div>

      <!-- Step 2: 이미지 생성 -->
      <div id="step2-container" class="step-container">
        <div class="step-header">
          <h2>Step 2. 이미지 생성</h2>
          <p class="step-desc">대본의 각 씬에 맞는 이미지를 AI가 생성합니다.</p>
        </div>

        <div class="step-content">
          <!-- 이미지 생성 설정 -->
          <div class="config-panel">
            <div class="config-row">
              <div class="config-item">
                <label>이미지 생성 모델</label>
                <select id="image-model">
                  <option value="gemini" selected>Google Gemini (무료)</option>
                  <option value="flux">FLUX.1 Pro (고품질)</option>
                  <option value="dalle">DALL-E 3 (OpenAI)</option>
                </select>
              </div>
              <div class="config-item">
                <label>이미지 스타일</label>
                <select id="image-style">
                  <option value="realistic" selected>사실적 (Realistic)</option>
                  <option value="cinematic">시네마틱 (Cinematic)</option>
                  <option value="warm">따뜻한 톤 (Warm)</option>
                  <option value="dramatic">드라마틱 (Dramatic)</option>
                </select>
              </div>
              <div class="config-item">
                <label>이미지 비율</label>
                <select id="image-ratio">
                  <option value="16:9" selected>16:9 (유튜브)</option>
                  <option value="9:16">9:16 (쇼츠)</option>
                  <option value="1:1">1:1 (정사각형)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 캐릭터 분석 결과 -->
          <div id="character-analysis" class="analysis-panel hidden">
            <h3>등장인물 분석</h3>
            <div id="character-list" class="character-list"></div>
          </div>

          <!-- 씬별 이미지 생성 -->
          <div id="scene-images-area" class="scene-images-area hidden">
            <div class="scene-images-header">
              <h3>씬별 이미지</h3>
              <div class="batch-actions">
                <button class="btn-small" onclick="DramaStep2.generateAllImages()">모든 이미지 생성</button>
                <button class="btn-small" onclick="DramaStep2.regenerateSelected()">선택 재생성</button>
              </div>
            </div>
            <div id="scene-image-list" class="scene-image-list"></div>
          </div>

          <!-- 액션 버튼 -->
          <div class="action-buttons">
            <button id="btn-analyze-script" class="btn-primary btn-large" onclick="DramaStep2.analyzeAndPrepare()">
              <span class="btn-icon">🎨</span> 대본 분석 및 이미지 준비
            </button>
          </div>

          <!-- 다음 단계 버튼 -->
          <div id="step2-next" class="next-step-buttons hidden">
            <button class="btn-secondary" onclick="DramaMain.goToStep(1)">← Step 1: 대본</button>
            <button class="btn-primary" onclick="DramaMain.goToStep(3)">Step 3: TTS 음성 →</button>
          </div>
        </div>
      </div>

      <!-- Step 3: TTS 음성합성 -->
      <div id="step3-container" class="step-container">
        <div class="step-header">
          <h2>Step 3. TTS 음성합성</h2>
          <p class="step-desc">대본을 자연스러운 음성으로 변환합니다.</p>
        </div>

        <div class="step-content">
          <!-- TTS 설정 -->
          <div class="config-panel">
            <div class="config-row">
              <div class="config-item">
                <label>TTS 엔진</label>
                <select id="tts-engine">
                  <option value="google" selected>Google Cloud TTS</option>
                  <option value="naver">네이버 클로바</option>
                </select>
              </div>
              <div class="config-item">
                <label>음성 스타일</label>
                <select id="voice-style">
                  <option value="warm" selected>따뜻한 (시니어 친화)</option>
                  <option value="neutral">중립적</option>
                  <option value="dramatic">드라마틱</option>
                </select>
              </div>
              <div class="config-item">
                <label>말하기 속도</label>
                <select id="speech-rate">
                  <option value="0.85">느리게 (0.85x)</option>
                  <option value="0.95" selected>약간 느리게 (0.95x)</option>
                  <option value="1.0">보통 (1.0x)</option>
                  <option value="1.1">약간 빠르게 (1.1x)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 음성 할당 -->
          <div id="voice-assignment" class="voice-assignment-panel hidden">
            <h3>캐릭터별 음성 할당</h3>
            <div id="voice-assignment-list" class="voice-assignment-list"></div>
          </div>

          <!-- TTS 생성 진행 상황 -->
          <div id="tts-progress" class="progress-panel hidden">
            <h3>음성 생성 진행</h3>
            <div class="progress-bar-container">
              <div id="tts-progress-bar" class="progress-bar"></div>
            </div>
            <div id="tts-progress-text" class="progress-text">준비 중...</div>
          </div>

          <!-- 생성된 음성 목록 -->
          <div id="tts-result-area" class="tts-result-area hidden">
            <h3>생성된 음성</h3>
            <div id="tts-audio-list" class="tts-audio-list"></div>
            <div class="tts-summary">
              <span id="tts-total-duration">총 재생 시간: -</span>
              <button class="btn-small" onclick="DramaStep3.playAll()">전체 재생</button>
              <button class="btn-small" onclick="DramaStep3.downloadAll()">전체 다운로드</button>
            </div>
          </div>

          <!-- 액션 버튼 -->
          <div class="action-buttons">
            <button id="btn-generate-tts" class="btn-primary btn-large" onclick="DramaStep3.generateTTS()">
              <span class="btn-icon">🎙️</span> 음성 생성하기
            </button>
          </div>

          <!-- 다음 단계 버튼 -->
          <div id="step3-next" class="next-step-buttons hidden">
            <button class="btn-secondary" onclick="DramaMain.goToStep(2)">← Step 2: 이미지</button>
            <button class="btn-primary" onclick="DramaMain.goToStep(4)">Step 4: 영상 제작 →</button>
          </div>
        </div>
      </div>

      <!-- Step 4: 영상 제작 -->
      <div id="step4-container" class="step-container">
        <div class="step-header">
          <h2>Step 4. 영상 제작</h2>
          <p class="step-desc">이미지와 음성을 합쳐 영상을 만듭니다.</p>
        </div>

        <div class="step-content">
          <!-- 영상 설정 -->
          <div class="config-panel">
            <div class="config-row">
              <div class="config-item">
                <label>영상 해상도</label>
                <select id="video-resolution">
                  <option value="1080p" selected>1080p (Full HD)</option>
                  <option value="720p">720p (HD)</option>
                  <option value="4k">4K (Ultra HD)</option>
                </select>
              </div>
              <div class="config-item">
                <label>자막 스타일</label>
                <select id="subtitle-style">
                  <option value="bottom" selected>하단 자막</option>
                  <option value="center">중앙 자막</option>
                  <option value="dynamic">다이나믹 자막</option>
                </select>
              </div>
              <div class="config-item">
                <label>배경음악</label>
                <select id="bgm-style">
                  <option value="none">없음</option>
                  <option value="calm" selected>잔잔한</option>
                  <option value="emotional">감동적인</option>
                  <option value="hopeful">희망적인</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 타임라인 미리보기 -->
          <div id="timeline-preview" class="timeline-preview hidden">
            <h3>타임라인</h3>
            <div id="timeline-track" class="timeline-track"></div>
          </div>

          <!-- 영상 제작 진행 상황 -->
          <div id="video-progress" class="progress-panel hidden">
            <h3>영상 제작 진행</h3>
            <div class="progress-bar-container">
              <div id="video-progress-bar" class="progress-bar"></div>
            </div>
            <div id="video-progress-text" class="progress-text">준비 중...</div>
          </div>

          <!-- 영상 미리보기 -->
          <div id="video-preview-area" class="video-preview-area hidden">
            <h3>완성된 영상</h3>
            <video id="video-player" controls class="video-player"></video>
            <div class="video-info">
              <span id="video-duration">영상 길이: -</span>
              <span id="video-size">파일 크기: -</span>
            </div>
            <div class="video-actions">
              <button class="btn-primary" onclick="DramaStep4.downloadVideo()">영상 다운로드</button>
            </div>
          </div>

          <!-- 액션 버튼 -->
          <div class="action-buttons">
            <button id="btn-create-video" class="btn-primary btn-large" onclick="DramaStep4.createVideo()">
              <span class="btn-icon">🎬</span> 영상 제작하기
            </button>
          </div>

          <!-- 다음 단계 버튼 -->
          <div id="step4-next" class="next-step-buttons hidden">
            <button class="btn-secondary" onclick="DramaMain.goToStep(3)">← Step 3: TTS</button>
            <button class="btn-primary" onclick="DramaMain.goToStep(5)">Step 5: 업로드 →</button>
          </div>
        </div>
      </div>

      <!-- Step 5: YouTube 업로드 -->
      <div id="step5-container" class="step-container">
        <div class="step-header">
          <h2>Step 5. YouTube 업로드</h2>
          <p class="step-desc">완성된 영상을 YouTube에 업로드합니다.</p>
        </div>

        <div class="step-content">
          <!-- YouTube 연결 상태 -->
          <div id="youtube-auth-status" class="auth-status-panel">
            <div class="auth-status-icon">🔗</div>
            <div class="auth-status-text">YouTube 계정 연결 확인 중...</div>
            <button id="btn-youtube-connect" class="btn-secondary hidden" onclick="DramaStep5.connectYouTube()">YouTube 연결</button>
          </div>

          <!-- 썸네일 선택 -->
          <div id="thumbnail-section" class="thumbnail-section hidden">
            <h3>썸네일 선택</h3>
            <div id="thumbnail-options" class="thumbnail-options"></div>
            <button class="btn-small" onclick="DramaStep5.generateThumbnails()">새 썸네일 생성</button>
          </div>

          <!-- 메타데이터 입력 -->
          <div id="upload-metadata" class="upload-metadata-panel hidden">
            <h3>영상 정보</h3>
            <div class="metadata-form">
              <div class="form-group">
                <label>제목</label>
                <input type="text" id="video-title" placeholder="영상 제목">
              </div>
              <div class="form-group">
                <label>설명</label>
                <textarea id="video-description" rows="5" placeholder="영상 설명"></textarea>
              </div>
              <div class="form-group">
                <label>태그</label>
                <input type="text" id="video-tags" placeholder="태그1, 태그2, 태그3">
              </div>
              <div class="form-row">
                <div class="form-group half">
                  <label>카테고리</label>
                  <select id="video-category">
                    <option value="22">사람 및 블로그</option>
                    <option value="27" selected>교육</option>
                    <option value="24">엔터테인먼트</option>
                    <option value="29">비영리/사회운동</option>
                  </select>
                </div>
                <div class="form-group half">
                  <label>공개 설정</label>
                  <select id="video-privacy">
                    <option value="private" selected>비공개</option>
                    <option value="unlisted">일부 공개</option>
                    <option value="public">공개</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- 업로드 진행 상황 -->
          <div id="upload-progress" class="progress-panel hidden">
            <h3>업로드 진행</h3>
            <div class="progress-bar-container">
              <div id="upload-progress-bar" class="progress-bar"></div>
            </div>
            <div id="upload-progress-text" class="progress-text">준비 중...</div>
          </div>

          <!-- 업로드 완료 -->
          <div id="upload-complete" class="upload-complete-panel hidden">
            <div class="complete-icon">✅</div>
            <h3>업로드 완료!</h3>
            <a id="youtube-link" href="#" target="_blank" class="youtube-link">YouTube에서 보기</a>
            <div class="share-buttons">
              <button class="btn-small" onclick="DramaStep5.copyLink()">링크 복사</button>
              <button class="btn-small" onclick="DramaStep5.shareKakao()">카카오톡 공유</button>
            </div>
          </div>

          <!-- 액션 버튼 -->
          <div class="action-buttons">
            <button id="btn-upload" class="btn-primary btn-large" onclick="DramaStep5.uploadToYouTube()">
              <span class="btn-icon">📤</span> YouTube에 업로드
            </button>
          </div>

          <!-- 이전 단계 버튼 -->
          <div class="next-step-buttons">
            <button class="btn-secondary" onclick="DramaMain.goToStep(4)">← Step 4: 영상 제작</button>
            <button class="btn-primary" onclick="DramaMain.newSession()">새 프로젝트 시작</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 로딩 오버레이 -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">로딩 중...</div>
    <div class="loading-subtext"></div>
  </div>

  <!-- 상태바 -->
  <div id="status-bar" class="status-bar"></div>

  <!-- JavaScript (v=20241201-manual) -->
  <script src="{{ url_for('static', filename='js/drama-utils.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-session.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-main.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-step1.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-step2.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-step3.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-step4.js') }}?v=20241201m"></script>
  <script src="{{ url_for('static', filename='js/drama-step5.js') }}?v=20241201m"></script>
</body>
</html>
