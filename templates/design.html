<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë””ìì¸ ìë™í™” - ìƒì„¸í˜ì´ì§€ ìƒì„±</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      min-height: 100vh;
    }

    /* í—¤ë” */
    .header {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { font-size: 1.3rem; display: flex; align-items: center; gap: 0.5rem; }
    .header-actions { display: flex; gap: 1rem; align-items: center; }
    .status-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .status-connected { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .status-disconnected { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 0.5rem;
    }
    .tab-btn {
      padding: 0.6rem 1.2rem;
      border: none;
      background: transparent;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-weight: 500;
      color: #64748b;
      transition: all 0.2s;
    }
    .tab-btn:hover { background: #f1f5f9; color: #334155; }
    .tab-btn.active {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* ì¹´ë“œ */
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1e293b;
    }

    /* ê·¸ë¦¬ë“œ */
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }

    @media (max-width: 1024px) {
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    }

    /* í¼ */
    .form-group { margin-bottom: 1rem; }
    .form-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: #475569;
      margin-bottom: 0.4rem;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none;
      border-color: #8b5cf6;
    }

    /* ë²„íŠ¼ */
    .btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }
    .btn-primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); }
    .btn-secondary { background: #f1f5f9; color: #475569; }
    .btn-secondary:hover { background: #e2e8f0; }
    .btn-outline { background: white; border: 1px solid #e2e8f0; color: #475569; }
    .btn-outline:hover { border-color: #8b5cf6; color: #8b5cf6; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-small { padding: 0.4rem 0.8rem; font-size: 0.8rem; }

    /* í°íŠ¸ ì¹´ë“œ */
    .font-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 1rem;
      transition: all 0.2s;
    }
    .font-card:hover { border-color: #8b5cf6; }
    .font-card .font-preview {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #1e293b;
    }
    .font-card .font-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: #475569;
    }
    .font-card .font-weights {
      font-size: 0.75rem;
      color: #94a3b8;
      margin-top: 0.3rem;
    }

    /* í…œí”Œë¦¿ ì¹´ë“œ */
    .template-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s;
      cursor: pointer;
    }
    .template-card:hover { border-color: #8b5cf6; transform: translateY(-2px); }
    .template-card.selected { border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2); }
    .template-preview {
      height: 150px;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }
    .template-info { padding: 1rem; }
    .template-name { font-weight: 600; color: #1e293b; margin-bottom: 0.3rem; }
    .template-category { font-size: 0.8rem; color: #64748b; }

    /* Figma íŒŒì¼ ëª©ë¡ */
    .figma-file-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .figma-file-item:hover { background: #f1f5f9; }
    .figma-icon { font-size: 1.5rem; }
    .figma-file-info { flex: 1; }
    .figma-file-name { font-weight: 600; color: #1e293b; }
    .figma-file-date { font-size: 0.8rem; color: #64748b; }

    /* ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ */
    .variable-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem;
      background: #faf5ff;
      border: 1px solid #e9d5ff;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .variable-name {
      font-family: monospace;
      background: #8b5cf6;
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    .variable-input { flex: 1; }

    /* ìƒì„± ë¯¸ë¦¬ë³´ê¸° */
    .preview-container {
      background: #1e293b;
      border-radius: 12px;
      padding: 2rem;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .preview-image {
      max-width: 100%;
      max-height: 500px;
      border-radius: 8px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    .preview-placeholder {
      text-align: center;
      color: #64748b;
    }
    .preview-placeholder .icon { font-size: 4rem; margin-bottom: 1rem; }

    /* í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: #1e293b;
      color: white;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      z-index: 1000;
      display: none;
    }
    .toast.success { background: #10b981; }
    .toast.error { background: #ef4444; }
    .toast.show { display: block; animation: slideIn 0.3s ease; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ë¡œë”© */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .loading-overlay.show { display: flex; }
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #e2e8f0;
      border-top-color: #8b5cf6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h2 { font-size: 1.2rem; color: #1e293b; }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #64748b;
    }
    .modal-body { padding: 1.5rem; }
    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    /* ì—°ê²° ìƒíƒœ ì¹´ë“œ */
    .connection-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem;
      background: #f8fafc;
      border-radius: 12px;
      border: 2px dashed #e2e8f0;
    }
    .connection-card.connected {
      background: #ecfdf5;
      border: 2px solid #10b981;
      border-style: solid;
    }
    .connection-icon { font-size: 2.5rem; }
    .connection-info { flex: 1; }
    .connection-title { font-weight: 600; color: #1e293b; margin-bottom: 0.3rem; }
    .connection-status { font-size: 0.85rem; color: #64748b; }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <header class="header">
    <h1>ğŸ¨ ë””ìì¸ ìë™í™”</h1>
    <div class="header-actions">
      <span class="status-badge" id="figmaStatus">Figma ì—°ê²° í™•ì¸ ì¤‘...</span>
      <a href="/market" class="btn btn-outline" style="color:white;border-color:rgba(255,255,255,0.3);">â† ë§ˆì¼“ìœ¼ë¡œ</a>
    </div>
  </header>

  <div class="container">
    <!-- íƒ­ -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
      <button class="tab-btn" data-tab="templates">ğŸ“„ í…œí”Œë¦¿</button>
      <button class="tab-btn" data-tab="fonts">ğŸ”¤ í°íŠ¸</button>
      <button class="tab-btn" data-tab="generate">âœ¨ ìƒì„±</button>
      <button class="tab-btn" data-tab="benchmark">ğŸ” ë²¤ì¹˜ë§ˆí‚¹</button>
      <button class="tab-btn" data-tab="ai-generate">ğŸ¨ AI ì´ë¯¸ì§€</button>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
    <div class="tab-content active" id="tab-dashboard">
      <div class="grid-2">
        <!-- Figma ì—°ê²° -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Figma ì—°ë™</h3>
          </div>
          <div class="connection-card" id="figmaConnectionCard">
            <div class="connection-icon">ğŸ¨</div>
            <div class="connection-info">
              <div class="connection-title">Figma</div>
              <div class="connection-status" id="figmaConnectionStatus">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</div>
            </div>
            <button class="btn btn-primary btn-small" onclick="openFigmaSettings()">ì„¤ì •</button>
          </div>
          <div style="margin-top:1rem;">
            <div class="form-group">
              <label>Figma íŒŒì¼ í‚¤</label>
              <div style="display:flex;gap:0.5rem;">
                <input type="text" id="figmaFileKey" placeholder="Figma URLì—ì„œ /file/ ë’¤ì˜ ê°’">
                <button class="btn btn-primary" onclick="loadFigmaFile()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ë¹ ë¥¸ í†µê³„ -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">í˜„í™©</h3>
          </div>
          <div class="grid-3" style="text-align:center;">
            <div>
              <div style="font-size:2rem;font-weight:700;color:#8b5cf6;" id="templateCount">0</div>
              <div style="font-size:0.85rem;color:#64748b;">í…œí”Œë¦¿</div>
            </div>
            <div>
              <div style="font-size:2rem;font-weight:700;color:#10b981;" id="fontCount">0</div>
              <div style="font-size:0.85rem;color:#64748b;">í°íŠ¸</div>
            </div>
            <div>
              <div style="font-size:2rem;font-weight:700;color:#f59e0b;" id="generatedCount">0</div>
              <div style="font-size:0.85rem;color:#64748b;">ìƒì„±ë¨</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Figma íŒŒì¼ ë‚´ìš© -->
      <div class="card" id="figmaFileCard" style="display:none;">
        <div class="card-header">
          <h3 class="card-title" id="figmaFileName">Figma íŒŒì¼</h3>
          <button class="btn btn-secondary btn-small" onclick="closeFigmaFile()">ë‹«ê¸°</button>
        </div>
        <div id="figmaFileContent"></div>
      </div>
    </div>

    <!-- í…œí”Œë¦¿ íƒ­ -->
    <div class="tab-content" id="tab-templates">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬</h3>
          <button class="btn btn-primary" onclick="openCreateTemplateModal()">+ ìƒˆ í…œí”Œë¦¿</button>
        </div>
        <div class="grid-4" id="templateGrid">
          <div class="template-card" onclick="openCreateTemplateModal()">
            <div class="template-preview" style="background:#f1f5f9;">â•</div>
            <div class="template-info">
              <div class="template-name">ìƒˆ í…œí”Œë¦¿ ì¶”ê°€</div>
              <div class="template-category">Figmaì—ì„œ ê°€ì ¸ì˜¤ê¸°</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- í°íŠ¸ íƒ­ -->
    <div class="tab-content" id="tab-fonts">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">í°íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬</h3>
          <button class="btn btn-primary" onclick="openAddFontModal()">+ í°íŠ¸ ì¶”ê°€</button>
        </div>
        <div class="grid-4" id="fontGrid"></div>
      </div>
    </div>

    <!-- ìƒì„± íƒ­ -->
    <div class="tab-content" id="tab-generate">
      <div class="grid-2">
        <!-- ì…ë ¥ -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ìƒí’ˆ ì •ë³´ ì…ë ¥</h3>
          </div>

          <div class="form-group">
            <label>í…œí”Œë¦¿ ì„ íƒ</label>
            <select id="generateTemplate">
              <option value="">í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>

          <div id="variableInputs">
            <!-- ë™ì ìœ¼ë¡œ ë³€ìˆ˜ ì…ë ¥ í•„ë“œ ìƒì„± -->
          </div>

          <div class="form-group">
            <label>ìƒí’ˆëª… *</label>
            <input type="text" id="genProductName" placeholder="í”„ë¦¬ë¯¸ì—„ ë¸”ë£¨íˆ¬ìŠ¤ ì´ì–´í°">
          </div>
          <div class="form-group">
            <label>ê°€ê²© *</label>
            <input type="text" id="genPrice" placeholder="29,000ì›">
          </div>
          <div class="form-group">
            <label>í• ì¸ìœ¨</label>
            <input type="text" id="genDiscount" placeholder="50%">
          </div>
          <div class="form-group">
            <label>íŠ¹ì§• (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
            <textarea id="genFeatures" rows="3" placeholder="ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§&#10;20ì‹œê°„ ë°°í„°ë¦¬&#10;IPX5 ë°©ìˆ˜"></textarea>
          </div>
          <div class="form-group">
            <label>ìƒí’ˆ ì´ë¯¸ì§€ URL</label>
            <input type="text" id="genImageUrl" placeholder="https://...">
          </div>

          <button class="btn btn-primary" onclick="generateImage()" style="width:100%;margin-top:1rem;">
            âœ¨ ìƒì„¸í˜ì´ì§€ ìƒì„±
          </button>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ë¯¸ë¦¬ë³´ê¸°</h3>
            <button class="btn btn-secondary btn-small" onclick="downloadImage()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
          </div>
          <div class="preview-container">
            <div class="preview-placeholder" id="previewPlaceholder">
              <div class="icon">ğŸ–¼ï¸</div>
              <div>ìƒí’ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ <br>ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
            </div>
            <img src="" alt="" class="preview-image" id="previewImage" style="display:none;">
          </div>
        </div>
      </div>
    </div>

    <!-- ë²¤ì¹˜ë§ˆí‚¹ íƒ­ -->
    <div class="tab-content" id="tab-benchmark">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ìƒì„¸í˜ì´ì§€ ë²¤ì¹˜ë§ˆí‚¹</h3>
        </div>
        <p style="color:#64748b;margin-bottom:1rem;">
          ì¢‹ì€ ìƒì„¸í˜ì´ì§€ URLì„ ì…ë ¥í•˜ë©´ AIê°€ ë¶„ì„í•˜ì—¬ í…œí”Œë¦¿ì„ ìƒì„±í•©ë‹ˆë‹¤.
        </p>
        <div class="form-group">
          <label>ìƒì„¸í˜ì´ì§€ URL</label>
          <div style="display:flex;gap:0.5rem;">
            <input type="text" id="benchmarkUrl" placeholder="https://smartstore.naver.com/...">
            <button class="btn btn-primary" onclick="analyzeBenchmark()">ë¶„ì„í•˜ê¸°</button>
          </div>
        </div>

        <div id="benchmarkResult" style="display:none;margin-top:1.5rem;">
          <h4 style="margin-bottom:1rem;">ë¶„ì„ ê²°ê³¼</h4>

          <!-- ìŠ¤í¬ë¦°ìƒ· ë¯¸ë¦¬ë³´ê¸° -->
          <div style="margin-bottom:1.5rem;">
            <img id="benchmarkScreenshot" src="" alt="ìŠ¤í¬ë¦°ìƒ·" style="max-width:100%;border-radius:8px;border:1px solid #e2e8f0;display:none;">
          </div>

          <div class="grid-2" style="gap:1.5rem;">
            <div>
              <h5 style="margin-bottom:0.5rem;color:#64748b;">ìƒ‰ìƒ íŒ”ë ˆíŠ¸</h5>
              <div id="colorPalette" style="display:flex;gap:0.5rem;flex-wrap:wrap;"></div>
            </div>
            <div>
              <h5 style="margin-bottom:0.5rem;color:#64748b;">í°íŠ¸ ìŠ¤íƒ€ì¼</h5>
              <div id="detectedFonts" style="font-size:0.9rem;color:#334155;"></div>
            </div>
          </div>

          <div style="margin-top:1.5rem;">
            <h5 style="margin-bottom:0.5rem;color:#64748b;">ë””ìì¸ ìŠ¤íƒ€ì¼</h5>
            <div id="designStyle" style="font-size:0.9rem;color:#334155;"></div>
          </div>

          <div style="margin-top:1.5rem;">
            <h5 style="margin-bottom:0.5rem;color:#64748b;">ë ˆì´ì•„ì›ƒ êµ¬ì¡°</h5>
            <div id="layoutStructure" style="font-size:0.9rem;color:#334155;"></div>
          </div>

          <div style="margin-top:1.5rem;">
            <h5 style="margin-bottom:0.5rem;color:#64748b;">ì£¼ìš” íŠ¹ì§•</h5>
            <div id="highlights" style="font-size:0.9rem;color:#334155;"></div>
          </div>

          <div style="margin-top:1.5rem;padding:1rem;background:#f0fdf4;border-radius:8px;border:1px solid #86efac;">
            <h5 style="margin-bottom:0.5rem;color:#16a34a;">ğŸ’¡ ì¶”ì²œ ì‚¬í•­</h5>
            <div id="suggestions" style="font-size:0.9rem;color:#166534;"></div>
          </div>

          <!-- ì €ì¥ ë²„íŠ¼ -->
          <div style="margin-top:1.5rem;display:flex;gap:0.5rem;">
            <select id="benchmarkCategory" style="flex:1;padding:0.5rem;border-radius:6px;border:1px solid #e2e8f0;">
              <option value="ê¸°íƒ€">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
              <option value="ì „ìì œí’ˆ">ì „ìì œí’ˆ</option>
              <option value="íŒ¨ì…˜">íŒ¨ì…˜</option>
              <option value="ì‹í’ˆ">ì‹í’ˆ</option>
              <option value="ë·°í‹°">ë·°í‹°</option>
              <option value="ìƒí™œìš©í’ˆ">ìƒí™œìš©í’ˆ</option>
            </select>
            <button class="btn btn-primary" onclick="saveBenchmark()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          </div>
        </div>
      </div>
    </div>

    <!-- AI ì´ë¯¸ì§€ ìƒì„± íƒ­ -->
    <div class="tab-content" id="tab-ai-generate">
      <div class="grid-2">
        <!-- ì´ë¯¸ì§€ ìƒì„± ì…ë ¥ -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">AI ì´ë¯¸ì§€ ìƒì„±</h3>
          </div>

          <div class="form-group">
            <label>ëª¨ë¸ ì„ íƒ</label>
            <select id="aiModel">
              <option value="flux-schnell">Flux Schnell (ë¹ ë¦„, ~$0.003)</option>
              <option value="flux-dev">Flux Dev (ê³ í’ˆì§ˆ, ~$0.025)</option>
            </select>
          </div>

          <div class="form-group">
            <label>ì´ë¯¸ì§€ íƒ€ì…</label>
            <select id="imageType">
              <option value="thumbnail">ìƒí’ˆ ì¸ë„¤ì¼ (1024x1024)</option>
              <option value="banner">ë°°ë„ˆ (1920x640)</option>
              <option value="detail">ìƒì„¸í˜ì´ì§€ íˆì–´ë¡œ (1200x800)</option>
              <option value="custom">ì»¤ìŠ¤í…€</option>
            </select>
          </div>

          <div id="customSizeGroup" style="display:none;" class="form-group">
            <label>ì»¤ìŠ¤í…€ ì‚¬ì´ì¦ˆ</label>
            <div style="display:flex;gap:0.5rem;">
              <input type="number" id="customWidth" placeholder="ë„ˆë¹„" value="1024" style="flex:1;">
              <span style="line-height:2.5;">x</span>
              <input type="number" id="customHeight" placeholder="ë†’ì´" value="1024" style="flex:1;">
            </div>
          </div>

          <div class="form-group">
            <label>ìƒí’ˆëª…</label>
            <input type="text" id="aiProductName" placeholder="ì˜ˆ: í”„ë¦¬ë¯¸ì—„ ë¸”ë£¨íˆ¬ìŠ¤ ì´ì–´í°">
          </div>

          <div class="form-group">
            <label>ìƒí’ˆ ì„¤ëª…</label>
            <textarea id="aiProductDesc" rows="2" placeholder="ì˜ˆ: ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§, 20ì‹œê°„ ë°°í„°ë¦¬, ê³ ê¸‰ ê°€ì£½ ì¼€ì´ìŠ¤"></textarea>
          </div>

          <div class="form-group">
            <label>ì¶”ê°€ ìŠ¤íƒ€ì¼ (ì„ íƒ)</label>
            <input type="text" id="aiStyle" placeholder="ì˜ˆ: ë¯¸ë‹ˆë©€, ê³ ê¸‰ìŠ¤ëŸ¬ìš´, í™”ì´íŠ¸ ë°°ê²½">
          </div>

          <div class="form-group">
            <label>ì €ì¥ëœ ë²¤ì¹˜ë§ˆí‚¹ ìŠ¤íƒ€ì¼ ì°¸ê³  (ì„ íƒ)</label>
            <select id="benchmarkRef">
              <option value="">ì„ íƒ ì•ˆí•¨</option>
            </select>
          </div>

          <button class="btn btn-primary" onclick="generateAIImage()" style="width:100%;margin-top:1rem;">
            ğŸ¨ ì´ë¯¸ì§€ ìƒì„±
          </button>
        </div>

        <!-- ìƒì„± ê²°ê³¼ -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ìƒì„± ê²°ê³¼</h3>
            <button class="btn btn-secondary btn-small" onclick="downloadAIImage()" id="downloadAIBtn" style="display:none;">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
          </div>

          <div id="aiResultPlaceholder" style="padding:3rem;text-align:center;color:#94a3b8;background:#f8fafc;border-radius:8px;">
            <div style="font-size:3rem;margin-bottom:1rem;">ğŸ¨</div>
            <div>ìƒí’ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ <br>ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
          </div>

          <div id="aiResultContainer" style="display:none;">
            <img id="aiResultImage" src="" alt="ìƒì„±ëœ ì´ë¯¸ì§€" style="width:100%;border-radius:8px;">
            <div style="margin-top:1rem;padding:0.75rem;background:#f1f5f9;border-radius:6px;font-size:0.8rem;">
              <strong>ì‚¬ìš© ëª¨ë¸:</strong> <span id="aiUsedModel"></span><br>
              <strong>í”„ë¡¬í”„íŠ¸:</strong> <span id="aiUsedPrompt" style="color:#64748b;"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- ì €ì¥ëœ ë²¤ì¹˜ë§ˆí‚¹ ëª©ë¡ -->
      <div class="card" style="margin-top:1.5rem;">
        <div class="card-header">
          <h3 class="card-title">ì €ì¥ëœ ë²¤ì¹˜ë§ˆí‚¹</h3>
          <button class="btn btn-secondary btn-small" onclick="loadBenchmarks()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div id="savedBenchmarks" class="grid-4" style="gap:1rem;">
          <div style="padding:2rem;text-align:center;color:#94a3b8;">ì €ì¥ëœ ë²¤ì¹˜ë§ˆí‚¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- í…œí”Œë¦¿ ìƒì„± ëª¨ë‹¬ -->
  <div class="modal-overlay" id="templateModal">
    <div class="modal">
      <div class="modal-header">
        <h2>ìƒˆ í…œí”Œë¦¿ ë§Œë“¤ê¸°</h2>
        <button class="modal-close" onclick="closeTemplateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>í…œí”Œë¦¿ ì´ë¦„ *</label>
          <input type="text" id="templateName" placeholder="ì˜ˆ: ì „ìì œí’ˆ í”„ë¦¬ë¯¸ì—„">
        </div>
        <div class="form-group">
          <label>ì¹´í…Œê³ ë¦¬</label>
          <select id="templateCategory">
            <option value="general">ì¼ë°˜</option>
            <option value="electronics">ì „ìì œí’ˆ</option>
            <option value="fashion">íŒ¨ì…˜</option>
            <option value="food">ì‹í’ˆ</option>
            <option value="living">ìƒí™œìš©í’ˆ</option>
          </select>
        </div>
        <div class="form-group">
          <label>Figma íŒŒì¼ í‚¤</label>
          <input type="text" id="templateFigmaKey" placeholder="Figma íŒŒì¼ í‚¤ (ì„ íƒ)">
        </div>
        <div class="form-group">
          <label>Figma ë…¸ë“œ ID</label>
          <input type="text" id="templateFigmaNode" placeholder="í”„ë ˆì„ ë…¸ë“œ ID (ì„ íƒ)">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeTemplateModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="createTemplate()">ìƒì„±</button>
      </div>
    </div>
  </div>

  <!-- í°íŠ¸ ì¶”ê°€ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="fontModal">
    <div class="modal">
      <div class="modal-header">
        <h2>í°íŠ¸ ì¶”ê°€</h2>
        <button class="modal-close" onclick="closeFontModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>í°íŠ¸ ì´ë¦„ *</label>
          <input type="text" id="fontName" placeholder="ì˜ˆ: ë§ˆë£¨ë¶€ë¦¬">
        </div>
        <div class="form-group">
          <label>Font Family *</label>
          <input type="text" id="fontFamily" placeholder="ì˜ˆ: MaruBuri">
        </div>
        <div class="form-group">
          <label>CSS URL ë˜ëŠ” íŒŒì¼</label>
          <input type="text" id="fontSource" placeholder="https://fonts.googleapis.com/...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeFontModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="addFont()">ì¶”ê°€</button>
      </div>
    </div>
  </div>

  <!-- Figma ì„¤ì • ëª¨ë‹¬ -->
  <div class="modal-overlay" id="figmaSettingsModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Figma ì„¤ì •</h2>
        <button class="modal-close" onclick="closeFigmaSettings()">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:1rem;color:#64748b;">
          Figma Personal Access Tokenì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
          Figma â†’ Settings â†’ Personal Access Tokensì—ì„œ ìƒì„±í•˜ì„¸ìš”.
        </p>
        <div class="form-group">
          <label>Access Token</label>
          <input type="password" id="figmaToken" placeholder="figd_xxxxx...">
        </div>
        <p style="font-size:0.8rem;color:#94a3b8;">
          * í† í°ì€ ì„œë²„ í™˜ê²½ë³€ìˆ˜ FIGMA_ACCESS_TOKENì— ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeFigmaSettings()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div class="toast" id="toast"></div>

  <!-- ë¡œë”© -->
  <div class="loading-overlay" id="loading">
    <div class="spinner"></div>
  </div>

  <script>
    // ===== ìƒíƒœ =====
    let fonts = [];
    let templates = [];
    let figmaConnected = false;
    let currentFigmaFile = null;

    // ===== ì´ˆê¸°í™” =====
    document.addEventListener('DOMContentLoaded', () => {
      initTabs();
      loadStatus();
      loadFonts();
      loadTemplates();
    });

    function initTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        });
      });
    }

    // ===== API í˜¸ì¶œ =====
    async function loadStatus() {
      try {
        const res = await fetch('/api/design/status');
        const data = await res.json();
        if (data.ok) {
          figmaConnected = data.status.figma.connected;
          updateFigmaStatus(data.status.figma);
          document.getElementById('templateCount').textContent = data.status.templates;
          document.getElementById('fontCount').textContent = data.status.fonts.default + data.status.fonts.custom;
        }
      } catch (e) {
        console.error('Status error:', e);
      }
    }

    function updateFigmaStatus(figma) {
      const statusEl = document.getElementById('figmaStatus');
      const cardEl = document.getElementById('figmaConnectionCard');
      const statusTextEl = document.getElementById('figmaConnectionStatus');

      if (figma.connected) {
        statusEl.className = 'status-badge status-connected';
        statusEl.textContent = `Figma: ${figma.user}`;
        cardEl.classList.add('connected');
        statusTextEl.textContent = `ì—°ê²°ë¨ (${figma.user})`;
      } else {
        statusEl.className = 'status-badge status-disconnected';
        statusEl.textContent = 'Figma ë¯¸ì—°ê²°';
        cardEl.classList.remove('connected');
        statusTextEl.textContent = 'í† í°ì„ ì„¤ì •í•´ì£¼ì„¸ìš”';
      }
    }

    async function loadFonts() {
      try {
        const res = await fetch('/api/design/fonts');
        const data = await res.json();
        if (data.ok) {
          fonts = data.fonts;
          renderFonts();
        }
      } catch (e) {
        console.error('Fonts error:', e);
      }
    }

    async function loadTemplates() {
      try {
        const res = await fetch('/api/design/templates');
        const data = await res.json();
        if (data.ok) {
          templates = data.templates;
          renderTemplates();
          updateTemplateSelect();
        }
      } catch (e) {
        console.error('Templates error:', e);
      }
    }

    // ===== ë Œë”ë§ =====
    function renderFonts() {
      const grid = document.getElementById('fontGrid');
      grid.innerHTML = fonts.map(font => `
        <div class="font-card">
          <div class="font-preview" style="font-family:'${font.family}',sans-serif;">
            ê°€ë‚˜ë‹¤ ABC 123
          </div>
          <div class="font-name">${font.name}</div>
          <div class="font-weights">${font.weights.join(', ')}</div>
          ${font.type === 'custom' ? `<button class="btn btn-danger btn-small" style="margin-top:0.5rem;" onclick="deleteFont('${font.id}')">ì‚­ì œ</button>` : ''}
        </div>
      `).join('');

      // ì›¹ í°íŠ¸ ë¡œë“œ
      fonts.forEach(font => {
        if (font.source && (font.type === 'google' || font.type === 'web')) {
          const link = document.createElement('link');
          link.href = font.source;
          link.rel = 'stylesheet';
          document.head.appendChild(link);
        }
      });
    }

    function renderTemplates() {
      const grid = document.getElementById('templateGrid');
      const templatesHtml = templates.map(t => `
        <div class="template-card" onclick="selectTemplate('${t.id}')">
          <div class="template-preview">ğŸ“„</div>
          <div class="template-info">
            <div class="template-name">${t.name}</div>
            <div class="template-category">${t.category}</div>
          </div>
        </div>
      `).join('');

      grid.innerHTML = `
        <div class="template-card" onclick="openCreateTemplateModal()">
          <div class="template-preview" style="background:#f1f5f9;">â•</div>
          <div class="template-info">
            <div class="template-name">ìƒˆ í…œí”Œë¦¿ ì¶”ê°€</div>
            <div class="template-category">Figmaì—ì„œ ê°€ì ¸ì˜¤ê¸°</div>
          </div>
        </div>
        ${templatesHtml}
      `;
    }

    function updateTemplateSelect() {
      const select = document.getElementById('generateTemplate');
      select.innerHTML = '<option value="">í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</option>' +
        templates.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
    }

    // ===== Figma =====
    async function loadFigmaFile() {
      const fileKey = document.getElementById('figmaFileKey').value.trim();
      if (!fileKey) {
        showToast('Figma íŒŒì¼ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      showLoading();
      try {
        const res = await fetch(`/api/design/figma/file/${fileKey}`);
        const data = await res.json();

        if (data.ok) {
          currentFigmaFile = data.file;
          displayFigmaFile(data.file);
          showToast('íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
        } else {
          showToast(data.error || 'íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        }
      } catch (e) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
      hideLoading();
    }

    function displayFigmaFile(file) {
      document.getElementById('figmaFileCard').style.display = 'block';
      document.getElementById('figmaFileName').textContent = file.name;

      let html = '';
      file.pages.forEach(page => {
        html += `<div style="margin-bottom:1rem;">
          <h4 style="margin-bottom:0.5rem;color:#64748b;">${page.name}</h4>`;

        page.frames.forEach(frame => {
          html += `
            <div class="figma-file-item" onclick="selectFigmaFrame('${file.key}', '${frame.id}', '${frame.name}')">
              <div class="figma-icon">ğŸ–¼ï¸</div>
              <div class="figma-file-info">
                <div class="figma-file-name">${frame.name}</div>
                <div class="figma-file-date">${frame.width} x ${frame.height}</div>
              </div>
              <button class="btn btn-primary btn-small">í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥</button>
            </div>
          `;
        });
        html += '</div>';
      });

      document.getElementById('figmaFileContent').innerHTML = html;
    }

    function closeFigmaFile() {
      document.getElementById('figmaFileCard').style.display = 'none';
      currentFigmaFile = null;
    }

    function selectFigmaFrame(fileKey, nodeId, name) {
      document.getElementById('templateFigmaKey').value = fileKey;
      document.getElementById('templateFigmaNode').value = nodeId;
      document.getElementById('templateName').value = name;
      openCreateTemplateModal();
    }

    // ===== ëª¨ë‹¬ =====
    function openCreateTemplateModal() {
      document.getElementById('templateModal').classList.add('active');
    }
    function closeTemplateModal() {
      document.getElementById('templateModal').classList.remove('active');
    }

    function openAddFontModal() {
      document.getElementById('fontModal').classList.add('active');
    }
    function closeFontModal() {
      document.getElementById('fontModal').classList.remove('active');
    }

    function openFigmaSettings() {
      document.getElementById('figmaSettingsModal').classList.add('active');
    }
    function closeFigmaSettings() {
      document.getElementById('figmaSettingsModal').classList.remove('active');
    }

    // ===== ì•¡ì…˜ =====
    async function createTemplate() {
      const name = document.getElementById('templateName').value.trim();
      const category = document.getElementById('templateCategory').value;
      const figmaKey = document.getElementById('templateFigmaKey').value.trim();
      const figmaNode = document.getElementById('templateFigmaNode').value.trim();

      if (!name) {
        showToast('í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      showLoading();
      try {
        const res = await fetch('/api/design/templates', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            category,
            figmaFileKey: figmaKey || null,
            figmaNodeId: figmaNode || null
          })
        });
        const data = await res.json();

        if (data.ok) {
          showToast('í…œí”Œë¦¿ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          closeTemplateModal();
          loadTemplates();
          loadStatus();
        } else {
          showToast(data.error, 'error');
        }
      } catch (e) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
      hideLoading();
    }

    async function addFont() {
      const name = document.getElementById('fontName').value.trim();
      const family = document.getElementById('fontFamily').value.trim();
      const source = document.getElementById('fontSource').value.trim();

      if (!name || !family) {
        showToast('í°íŠ¸ ì´ë¦„ê³¼ Familyë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      showLoading();
      try {
        const res = await fetch('/api/design/fonts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, family, source })
        });
        const data = await res.json();

        if (data.ok) {
          showToast('í°íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          closeFontModal();
          loadFonts();
          loadStatus();
        } else {
          showToast(data.error, 'error');
        }
      } catch (e) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
      hideLoading();
    }

    async function deleteFont(fontId) {
      if (!confirm('í°íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        const res = await fetch(`/api/design/fonts/${fontId}`, { method: 'DELETE' });
        const data = await res.json();
        if (data.ok) {
          showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
          loadFonts();
        }
      } catch (e) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    function selectTemplate(templateId) {
      document.getElementById('generateTemplate').value = templateId;
      document.querySelectorAll('.tab-btn')[3].click(); // ìƒì„± íƒ­ìœ¼ë¡œ ì´ë™
    }

    async function generateImage() {
      const templateId = document.getElementById('generateTemplate').value;
      const productName = document.getElementById('genProductName').value;
      const price = document.getElementById('genPrice').value;

      if (!productName || !price) {
        showToast('ìƒí’ˆëª…ê³¼ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      showLoading();
      try {
        const res = await fetch('/api/design/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            templateId,
            variables: {
              product_name: productName,
              price: price,
              discount: document.getElementById('genDiscount').value,
              features: document.getElementById('genFeatures').value,
              image_url: document.getElementById('genImageUrl').value
            }
          })
        });
        const data = await res.json();

        if (data.ok && data.image && data.image.url) {
          document.getElementById('previewPlaceholder').style.display = 'none';
          document.getElementById('previewImage').src = data.image.url;
          document.getElementById('previewImage').style.display = 'block';
          showToast('ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        } else {
          showToast(data.error || 'ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨', 'error');
        }
      } catch (e) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
      hideLoading();
    }

    function downloadImage() {
      const img = document.getElementById('previewImage');
      if (!img.src || img.style.display === 'none') {
        showToast('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
        return;
      }
      const link = document.createElement('a');
      link.href = img.src;
      link.download = 'detail-page.png';
      link.click();
    }

    async function analyzeBenchmark() {
      const url = document.getElementById('benchmarkUrl').value.trim();
      if (!url) {
        showToast('URLì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      showLoading();
      try {
        const res = await fetch('/api/design/benchmark', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        const data = await res.json();

        if (data.ok) {
          currentBenchmarkData = data;  // ì €ì¥ìš© ë°ì´í„° ë³´ê´€
          displayBenchmarkResult(data);
          showToast('ë¶„ì„ ì™„ë£Œ!');
        } else {
          showToast(data.error || 'ë¶„ì„ ì‹¤íŒ¨', 'error');
        }
      } catch (e) {
        console.error('Benchmark error:', e);
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
      hideLoading();
    }

    function displayBenchmarkResult(data) {
      const resultEl = document.getElementById('benchmarkResult');
      resultEl.style.display = 'block';

      // ìŠ¤í¬ë¦°ìƒ· í‘œì‹œ
      if (data.imageUrl) {
        const screenshot = document.getElementById('benchmarkScreenshot');
        screenshot.src = data.imageUrl;
        screenshot.style.display = 'block';
      }

      const analysis = data.analysis || {};

      // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
      const colorPalette = document.getElementById('colorPalette');
      if (analysis.colors && Array.isArray(analysis.colors)) {
        colorPalette.innerHTML = analysis.colors.map(color => `
          <div style="display:flex;flex-direction:column;align-items:center;">
            <div style="width:50px;height:50px;background:${color};border-radius:8px;border:1px solid #e2e8f0;"></div>
            <span style="font-size:0.7rem;color:#64748b;margin-top:4px;">${color}</span>
          </div>
        `).join('');
      } else {
        colorPalette.innerHTML = '<span style="color:#94a3b8;">ë¶„ì„ ê²°ê³¼ ì—†ìŒ</span>';
      }

      // í°íŠ¸ ìŠ¤íƒ€ì¼
      const detectedFonts = document.getElementById('detectedFonts');
      if (analysis.fonts) {
        if (typeof analysis.fonts === 'object' && !Array.isArray(analysis.fonts)) {
          detectedFonts.innerHTML = Object.entries(analysis.fonts).map(([key, value]) =>
            `<div><strong>${key}:</strong> ${value}</div>`
          ).join('');
        } else if (Array.isArray(analysis.fonts)) {
          detectedFonts.innerHTML = analysis.fonts.map(f => `<div>â€¢ ${f}</div>`).join('');
        } else {
          detectedFonts.textContent = analysis.fonts;
        }
      }

      // ë””ìì¸ ìŠ¤íƒ€ì¼
      document.getElementById('designStyle').textContent = analysis.style || '-';

      // ë ˆì´ì•„ì›ƒ êµ¬ì¡°
      document.getElementById('layoutStructure').textContent = analysis.layout || '-';

      // ì£¼ìš” íŠ¹ì§•
      const highlights = document.getElementById('highlights');
      if (analysis.highlights) {
        if (Array.isArray(analysis.highlights)) {
          highlights.innerHTML = analysis.highlights.map(h => `<div>â€¢ ${h}</div>`).join('');
        } else {
          highlights.textContent = analysis.highlights;
        }
      }

      // ì¶”ì²œ ì‚¬í•­
      const suggestions = document.getElementById('suggestions');
      if (analysis.suggestions) {
        if (Array.isArray(analysis.suggestions)) {
          suggestions.innerHTML = analysis.suggestions.map(s => `<div>â€¢ ${s}</div>`).join('');
        } else {
          suggestions.textContent = analysis.suggestions;
        }
      }
    }

    // ===== ë²¤ì¹˜ë§ˆí‚¹ ì €ì¥/ì¡°íšŒ =====
    let currentBenchmarkData = null;

    function displayBenchmarkResultWithSave(data) {
      currentBenchmarkData = data;
      displayBenchmarkResult(data);
    }

    async function saveBenchmark() {
      if (!currentBenchmarkData) {
        showToast('ë¨¼ì € ë²¤ì¹˜ë§ˆí‚¹ ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”', 'error');
        return;
      }

      const category = document.getElementById('benchmarkCategory').value;

      try {
        const res = await fetch('/api/design/benchmark/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            url: currentBenchmarkData.url,
            imageUrl: currentBenchmarkData.imageUrl,
            analysis: currentBenchmarkData.analysis,
            category: category
          })
        });
        const data = await res.json();

        if (data.ok) {
          showToast('ë²¤ì¹˜ë§ˆí‚¹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          loadBenchmarks();
        } else {
          showToast(data.error || 'ì €ì¥ ì‹¤íŒ¨', 'error');
        }
      } catch (e) {
        showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    async function loadBenchmarks() {
      try {
        const res = await fetch('/api/design/benchmarks');
        const data = await res.json();

        if (data.ok) {
          renderBenchmarks(data.benchmarks);
          updateBenchmarkSelect(data.benchmarks);
        }
      } catch (e) {
        console.error('Benchmarks load error:', e);
      }
    }

    function renderBenchmarks(benchmarks) {
      const container = document.getElementById('savedBenchmarks');

      if (benchmarks.length === 0) {
        container.innerHTML = '<div style="padding:2rem;text-align:center;color:#94a3b8;grid-column:1/-1;">ì €ì¥ëœ ë²¤ì¹˜ë§ˆí‚¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      container.innerHTML = benchmarks.map(b => `
        <div style="background:#f8fafc;border-radius:8px;overflow:hidden;border:1px solid #e2e8f0;">
          <img src="${b.imageUrl}" alt="" style="width:100%;height:120px;object-fit:cover;">
          <div style="padding:0.75rem;">
            <div style="font-size:0.8rem;font-weight:600;color:#334155;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${b.category}</div>
            <div style="font-size:0.7rem;color:#94a3b8;">${new Date(b.createdAt).toLocaleDateString()}</div>
          </div>
        </div>
      `).join('');
    }

    function updateBenchmarkSelect(benchmarks) {
      const select = document.getElementById('benchmarkRef');
      select.innerHTML = '<option value="">ì„ íƒ ì•ˆí•¨</option>' +
        benchmarks.map(b => `<option value="${b.id}">${b.category} - ${new Date(b.createdAt).toLocaleDateString()}</option>`).join('');
    }

    // ===== AI ì´ë¯¸ì§€ ìƒì„± =====
    let lastGeneratedImage = null;

    // ì»¤ìŠ¤í…€ ì‚¬ì´ì¦ˆ í† ê¸€
    document.getElementById('imageType')?.addEventListener('change', function() {
      document.getElementById('customSizeGroup').style.display = this.value === 'custom' ? 'block' : 'none';
    });

    async function generateAIImage() {
      const model = document.getElementById('aiModel').value;
      const imageType = document.getElementById('imageType').value;
      const productName = document.getElementById('aiProductName').value.trim();
      const productDesc = document.getElementById('aiProductDesc').value.trim();
      const style = document.getElementById('aiStyle').value.trim();
      const benchmarkId = document.getElementById('benchmarkRef').value;

      if (!productName) {
        showToast('ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }

      // ì‚¬ì´ì¦ˆ ê²°ì •
      let size;
      if (imageType === 'custom') {
        const w = document.getElementById('customWidth').value;
        const h = document.getElementById('customHeight').value;
        size = `${w}x${h}`;
      } else {
        const sizes = { thumbnail: '1024x1024', banner: '1920x640', detail: '1200x800' };
        size = sizes[imageType];
      }

      // í”„ë¡¬í”„íŠ¸ ìƒì„±
      let prompt = `Product image for e-commerce. ${productName}. ${productDesc}. `;
      if (style) prompt += `Style: ${style}. `;
      prompt += 'Professional product photography, high quality, clean composition.';

      showLoading();
      try {
        const res = await fetch('/api/design/generate/image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, model, size })
        });
        const data = await res.json();

        if (data.ok) {
          displayAIResult(data);
          showToast('ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ!');
        } else {
          showToast(data.error || 'ìƒì„± ì‹¤íŒ¨', 'error');
        }
      } catch (e) {
        console.error('AI generate error:', e);
        showToast('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
      }
      hideLoading();
    }

    function displayAIResult(data) {
      document.getElementById('aiResultPlaceholder').style.display = 'none';
      document.getElementById('aiResultContainer').style.display = 'block';
      document.getElementById('downloadAIBtn').style.display = 'inline-block';

      const imageUrl = data.image.url || data.image;
      document.getElementById('aiResultImage').src = imageUrl;
      document.getElementById('aiUsedModel').textContent = data.model;
      document.getElementById('aiUsedPrompt').textContent = data.prompt.substring(0, 100) + '...';

      lastGeneratedImage = imageUrl;
    }

    function downloadAIImage() {
      if (!lastGeneratedImage) return;

      const link = document.createElement('a');
      link.href = lastGeneratedImage;
      link.download = 'ai-generated-image.png';
      link.target = '_blank';
      link.click();
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë²¤ì¹˜ë§ˆí‚¹ ëª©ë¡ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
      loadBenchmarks();
    });

    // ===== ìœ í‹¸ =====
    function showToast(message, type = '') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function showLoading() {
      document.getElementById('loading').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loading').classList.remove('show');
    }
  </script>
</body>
</html>
