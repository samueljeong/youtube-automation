<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: #333;
      font-size: 24px;
    }

    .header-links {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .header-links a, .header-links button {
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
      border: none;
      cursor: pointer;
    }

    .btn-home {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-home:hover {
      background: #667eea;
      color: white;
    }

    .btn-logout {
      background: #dc3545;
      color: white;
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
    }

    .content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 32px;
      margin-bottom: 5px;
    }

    .stat-card p {
      font-size: 14px;
      opacity: 0.9;
    }

    .flash-messages {
      margin-bottom: 20px;
    }

    .flash {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .flash.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .flash.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    h2 {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    tbody tr:hover {
      background: #f5f5f5;
    }

    .badge {
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-admin {
      background: #28a745;
      color: white;
    }

    .badge-user {
      background: #6c757d;
      color: white;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn-toggle-admin {
      background: #ffc107;
      color: #333;
    }

    .btn-delete {
      background: #dc3545;
      color: white;
    }

    .no-users {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
      <div class="header-links">
        <span style="color: #666;">{{ session.user_name }}ë‹˜ (ê´€ë¦¬ì)</span>
        <a href="/" class="btn-home">í™ˆìœ¼ë¡œ</a>
        <form action="/logout" method="get" style="display: inline;">
          <button type="submit" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
        </form>
      </div>
    </div>

    <div class="content">
      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Statistics -->
      <div class="stats">
        <div class="stat-card">
          <h3>{{ users|length }}</h3>
          <p>ì „ì²´ ê°€ì…ì</p>
        </div>
        <div class="stat-card">
          <h3>{{ users|selectattr('is_admin')|list|length }}</h3>
          <p>ê´€ë¦¬ì</p>
        </div>
        <div class="stat-card">
          <h3>{{ (users|length) - (users|selectattr('is_admin')|list|length) }}</h3>
          <p>ì¼ë°˜ íšŒì›</p>
        </div>
      </div>

      <!-- User List -->
      <h2>ê°€ì…ì ëª©ë¡</h2>

      {% if users %}
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>ì´ë©”ì¼</th>
              <th>ì´ë¦„</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ìƒë…„ì›”ì¼</th>
              <th>ê¶Œí•œ</th>
              <th>ê°€ì…ì¼</th>
              <th>ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.phone or '-' }}</td>
                <td>{{ user.birth_date or '-' }}</td>
                <td>
                  {% if user.is_admin %}
                    <span class="badge badge-admin">ê´€ë¦¬ì</span>
                  {% else %}
                    <span class="badge badge-user">ì¼ë°˜ íšŒì›</span>
                  {% endif %}
                </td>
                <td>{{ user.created_at }}</td>
                <td>
                  <div class="action-buttons">
                    {% if user.id != session.user_id %}
                      <form action="/admin/toggle-admin/{{ user.id }}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-toggle-admin">
                          {% if user.is_admin %}
                            ê¶Œí•œ ì œê±°
                          {% else %}
                            ê´€ë¦¬ì ìŠ¹ê²©
                          {% endif %}
                        </button>
                      </form>
                      <form action="/admin/delete-user/{{ user.id }}" method="post" style="display: inline;" onsubmit="return confirm('ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <button type="submit" class="btn btn-delete">ì‚­ì œ</button>
                      </form>
                    {% else %}
                      <span style="color: #666; font-size: 13px;">ë³¸ì¸</span>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="no-users">
          <p>ê°€ì…ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
