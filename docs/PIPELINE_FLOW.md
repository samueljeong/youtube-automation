# 자동화 파이프라인 흐름

## 개요

Google Sheets 기반 YouTube 영상 자동 생성 파이프라인의 전체 흐름입니다.

## 메인 파이프라인 흐름

```
┌─────────────────────────────────────────────────────────┐
│  1. GPT-4o 대본 분석 (한 번의 API 호출로 모두 생성)       │
│     ├── 유튜브 메타데이터 (제목, 설명)                   │
│     ├── 썸네일 프롬프트 (ai_prompts)                    │
│     ├── 씬별 이미지 프롬프트                            │
│     └── 씬 구조 (나레이션은 코드에서 강제 분할)          │
│                                                         │
│  ★ 대본 강제 분할 (2025-12-17)                          │
│     - GPT 응답 후 코드에서 원본 대본을 씬별로 균등 분할   │
│     - 문장 단위로 자연스럽게 끊어서 배분                  │
│     - GPT가 요약/재작성하는 문제 완전 해결               │
│     - 대본 100%가 TTS로 변환됨 (유실 없음)               │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  2a. TTS 생성 (먼저 실행 - 저비용)                       │
│      └── Google TTS → 음성 + 자막 생성                  │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼ (TTS 성공 시)
┌─────────────────────────────────────────────────────────┐
│  2b. 병렬 처리 (TTS 성공 후)                             │
│     ├── Gemini 3 Pro → 썸네일 이미지 생성               │
│     └── Gemini 2.5 Flash → 씬 배경 이미지 생성          │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼ (모두 완료 후)
┌─────────────────────────────────────────────────────────┐
│  3. FFmpeg 영상 생성                                     │
│     - 이미지 + 오디오 + 자막 합성                        │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  4. YouTube 업로드                                       │
│     - 썸네일 설정                                        │
│     - 플레이리스트 추가 (R열에 ID 있는 경우)             │
│     - 예약 공개 (있는 경우)                              │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  5. 쇼츠 자동 생성 (옵션)                                │
│     - 하이라이트 씬 추출 (60초 이하)                     │
│     - 세로 영상(9:16) 변환                               │
│     - 원본 영상 링크 포함하여 업로드                     │
└─────────────────────────────────────────────────────────┘
```

**주의:** "Step1-6" 같은 UI 용어 사용 금지. 위 흐름이 자동화 파이프라인의 정확한 구조임.

## 이미지 개수 계산

```python
# 한국어 TTS 기준: 910자 ≈ 1분
# 히스토리 채널: 12,000~15,000자 (약 13~16분 영상)
# ~8분: 5컷, 8~10분: 8컷, 10~15분: 11컷, 15분+: 12컷
estimated_minutes = len(script) / 910
```

- 최소 5개, 최대 12개
- 대본 길이에 따라 동적 결정

## 참고 파일

- `drama_server.py` - 메인 서버 (모든 API)
- `run_automation_pipeline()` - 자동화 파이프라인 메인 함수
