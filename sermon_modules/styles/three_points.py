"""
three_points.py
3ëŒ€ì§€ ì„¤êµ ìŠ¤íƒ€ì¼ - ì „í†µì ì¸ 3í¬ì¸íŠ¸ ì„¤êµ êµ¬ì¡°

êµ¬ì¡°:
- ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ (ë„ì…ë¶€)
- 1ëŒ€ì§€ (ì²« ë²ˆì§¸ í¬ì¸íŠ¸)
  - 1-1 ì†Œì œëª©
    - ë³´ì¶© ì„±ê²½êµ¬ì ˆ 1-2ê°œ
  - 1-2 ì†Œì œëª©
    - ë³´ì¶© ì„±ê²½êµ¬ì ˆ 1-2ê°œ
- 2ëŒ€ì§€ (ë‘ ë²ˆì§¸ í¬ì¸íŠ¸)
  - ë™ì¼ êµ¬ì¡°
- 3ëŒ€ì§€ (ì„¸ ë²ˆì§¸ í¬ì¸íŠ¸)
  - ë™ì¼ êµ¬ì¡°
- ê²°ë¡  (ì ìš© ë° ë§ˆë¬´ë¦¬)
"""

from typing import Dict, List, Any


class ThreePointsStyle:
    """3ëŒ€ì§€ ì„¤êµ ìŠ¤íƒ€ì¼"""

    id = "three_points"
    name = "3ëŒ€ì§€"
    description = "ì „í†µì ì¸ 3í¬ì¸íŠ¸ ì„¤êµ - ì„œë¡ , 3ê°œì˜ ëŒ€ì§€, ê²°ë¡ ìœ¼ë¡œ êµ¬ì„±"
    structure_type = "three_points"

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Step2 êµ¬ì¡° ì„¤ê³„ ì§€ì¹¨
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_step2_structure_guide() -> str:
        """Step2 êµ¬ì¡° ì„¤ê³„ë¥¼ ìœ„í•œ ê°€ì´ë“œ ë°˜í™˜ (Step1 ID í•„ìˆ˜ ì°¸ì¡°)"""
        return """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ â˜…â˜…â˜… STEP2 í•µì‹¬ ì›ì¹™ â˜…â˜…â˜… ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. STEP2ëŠ” 'êµ¬ì¡°/ê·¼ê±°'ë§Œ ì„¤ê³„í•©ë‹ˆë‹¤.
   - ì™„ì„± ë¬¸ë‹¨, ê¸¸ê²Œ ì“°ëŠ” ì˜ˆí™”, ì ìš© ì„¤êµë¬¸ì€ ì‘ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

2. STEP2ëŠ” ë°˜ë“œì‹œ STEP1ì˜ IDë¥¼ í•„ìˆ˜ ì°¸ì¡°í•©ë‹ˆë‹¤.
   - ê° ì†ŒëŒ€ì§€ì˜ anchor_ids í•„ë“œì— STEP1ì˜ A1, A2... IDë¥¼ 2ê°œ ì´ìƒ ëª…ì‹œ
   - ê° ëŒ€ì§€ì˜ background_ids í•„ë“œì— STEP1ì˜ H1, G1... IDë¥¼ ëª…ì‹œ
   - STEP1ì— ì—†ëŠ” ì—­ì‚¬ì  ì£¼ì¥/ì‹œì‚¬ ìˆ˜ì¹˜/ë‰´ìŠ¤ ì‚¬ì‹¤ì„ ìƒˆë¡œ ë§Œë“¤ì§€ ë§ˆì‹­ì‹œì˜¤.

3. does_not_claim(D*) ìœ„ë°˜ ê¸ˆì§€
   - STEP1ì˜ guardrails.does_not_claimì— ìˆëŠ” D1, D2... í•­ëª©ì„ ìœ„ë°˜í•˜ë©´ FAIL

4. ì˜ˆí™”/ì ìš©/ì‹œì‚¬ì´ìŠˆëŠ” STEP3ì—ì„œ ì‘ì„±í•©ë‹ˆë‹¤.
   - STEP2ì—ì„œëŠ” intro_question(ë„ì… ì§ˆë¬¸) í•œ ë¬¸ì¥ë§Œ ì œì‹œí•©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ ID ì°¸ì¡° ê·œì¹™ (í•„ìˆ˜) ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â˜… ê° ì†ŒëŒ€ì§€ëŠ” STEP1ì˜ anchorsì—ì„œ 2ê°œ ì´ìƒì˜ IDë¥¼ ì°¸ì¡°í•´ì•¼ í•©ë‹ˆë‹¤.
â˜… ê° ëŒ€ì§€ëŠ” STEP1ì˜ historical_background ë˜ëŠ” geographyì—ì„œ 1ê°œ ì´ìƒì˜ IDë¥¼ ì°¸ì¡°í•´ì•¼ í•©ë‹ˆë‹¤.
â˜… guardrails.clearly_affirms(C*)ì— ê·¼ê±°í•´ì•¼ í•˜ë©°, does_not_claim(D*)ë¥¼ ìœ„ë°˜í•˜ë©´ FAILì…ë‹ˆë‹¤.

ì˜ˆì‹œ:
- anchor_ids: ["A1", "A3"] â† STEP1ì—ì„œ A1, A3 ì•µì»¤ë¥¼ ê·¼ê±°ë¡œ ì‚¬ìš©
- background_ids: ["H1", "G2"] â† STEP1ì—ì„œ H1 ë°°ê²½, G2 ì§€ë¦¬ë¥¼ ê·¼ê±°ë¡œ ì‚¬ìš©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ 3ëŒ€ì§€ ì„¤êµ êµ¬ì¡° ì§€ì¹¨ ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¶ í•„ìˆ˜ ì¶œë ¥ êµ¬ì¡° (ë°˜ë“œì‹œ ì´ í˜•ì‹ì„ ë”°ë¥´ì„¸ìš”)

ğŸ“Œ ë„ì…ë¶€
   - intro_question: ì˜¤ëŠ˜ ë§ì”€ê³¼ ì—°ê²°ë˜ëŠ” ì§ˆë¬¸ 1ê°œ (ì‹œì‚¬ì´ìŠˆ ê¸ˆì§€)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ 1ëŒ€ì§€: [ì²« ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€]
   â”œâ”€â”€ background_ids: ["H1", "G1"] â† ë°°ê²½ ID 1ê°œ ì´ìƒ í•„ìˆ˜
   â”œâ”€â”€ 1-1. [ì†Œì œëª©]
   â”‚     â”œâ”€â”€ anchor_ids: ["A1", "A2"] â† ì•µì»¤ ID 2ê°œ í•„ìˆ˜
   â”‚     â”œâ”€â”€ anchor_phrases: ì•µì»¤ êµ¬ì ˆ/í‘œí˜„ 2ê°œ (í•„ìˆ˜)
   â”‚     â”œâ”€â”€ supporting_verses: ë³´ì¶© ì„±ê²½êµ¬ì ˆ 2ê°œ (í•„ìˆ˜)
   â”‚     â””â”€â”€ one_sentence_explanation: í•œ ë¬¸ì¥ ì„¤ëª…
   â”œâ”€â”€ 1-2. [ì†Œì œëª©]
   â”‚     â”œâ”€â”€ anchor_ids: ["A3", "A4"]
   â”‚     â”œâ”€â”€ anchor_phrases: ì•µì»¤ êµ¬ì ˆ/í‘œí˜„ 2ê°œ
   â”‚     â”œâ”€â”€ supporting_verses: ë³´ì¶© ì„±ê²½êµ¬ì ˆ 2ê°œ
   â”‚     â””â”€â”€ one_sentence_explanation: í•œ ë¬¸ì¥ ì„¤ëª…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ 2ëŒ€ì§€: [ë‘ ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€]
   â”œâ”€â”€ background_ids: ["H2"]
   â””â”€â”€ (ë™ì¼ êµ¬ì¡°)

ğŸ“Œ 3ëŒ€ì§€: [ì„¸ ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€ / í´ë¼ì´ë§¥ìŠ¤]
   â”œâ”€â”€ background_ids: ["H3", "G2"]
   â””â”€â”€ (ë™ì¼ êµ¬ì¡°)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ ê²°ë¡ 
   - summary_points: ì„¸ ëŒ€ì§€ì˜ í•µì‹¬ ìš”ì•½ ê° 1ë¬¸ì¥
   - affirms_used: ì‚¬ìš©í•œ C* ID ëª©ë¡
   - decision_questions: ê²°ë‹¨ ì§ˆë¬¸ 2ê°œ
   - prayer_points: ê¸°ë„ í¬ì¸íŠ¸ 2ê°œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¶ ëŒ€ì§€ ì—°ê²° ì›ì¹™
1. 1ëŒ€ì§€ â†’ 2ëŒ€ì§€ â†’ 3ëŒ€ì§€ê°€ ë³¸ë¬¸ íë¦„(structure_outline U1â†’U2â†’U3)ì„ ë”°ë¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°
2. ì ì§„ì  ì‹¬í™” ë˜ëŠ” ìˆœì°¨ì  ì „ê°œ ê¶Œì¥
3. 3ëŒ€ì§€ëŠ” í´ë¼ì´ë§¥ìŠ¤ë¡œ ê°€ì¥ ê°•ë ¥í•œ ë©”ì‹œì§€

â–¶ ì‹œê°„ ë°°ë¶„ (time_map_percent)
- intro: 10%
- ëŒ€ì§€_1: 27%
- ëŒ€ì§€_2: 27%
- ëŒ€ì§€_3: 27%
- ending: 9%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ âš ï¸ STEP2ì—ì„œ ì ˆëŒ€ ê¸ˆì§€ ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ì‹œì‚¬ ë‰´ìŠ¤/ìˆ˜ì¹˜/ë¶€ë™ì‚°/ì •ì¹˜ ê°™ì€ ë…¼ìŸì Â·ë³€ë™ ì •ë³´ ì‚¬ìš© ê¸ˆì§€
2. ì˜ˆí™” íŒíŠ¸ (illustration_hint) ì‘ì„± ê¸ˆì§€ â†’ STEP3ì—ì„œ ì‘ì„±
3. ì ìš© ë¬¸ì¥ (application) ì‘ì„± ê¸ˆì§€ â†’ STEP3ì—ì„œ ì‘ì„±
4. ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ìƒí™œ ì´ì•¼ê¸° ì‘ì„± ê¸ˆì§€ â†’ STEP3ì—ì„œ ì‘ì„±
5. does_not_claim(D*)ì— ìˆëŠ” ì£¼ì¥ì„ í¬í•¨í•˜ê¸° ê¸ˆì§€ â†’ ìœ„ë°˜ ì‹œ FAIL

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ self_check í•„ìˆ˜ ì¶œë ¥ ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì¶œë ¥ ë§ˆì§€ë§‰ì— ë°˜ë“œì‹œ self_check ë°°ì—´ì„ í¬í•¨í•˜ì„¸ìš”:
- ê° ì†ŒëŒ€ì§€ anchor_ids 2ê°œ ì´ìƒ í¬í•¨ ì—¬ë¶€
- ê° ì†ŒëŒ€ì§€ supporting_verses 2ê°œ í¬í•¨ ì—¬ë¶€
- ê° ëŒ€ì§€ background_ids 1ê°œ ì´ìƒ í¬í•¨ ì—¬ë¶€
- ëŒ€ì§€ íë¦„ì´ ë³¸ë¬¸ ì „ê°œë¥¼ ë”°ë¥´ëŠ”ì§€ ì—¬ë¶€
- does_not_claim(D*) ìœ„ë°˜ ì—†ìŒ ì—¬ë¶€
- ì‹œì‚¬ ë‰´ìŠ¤/ìˆ˜ì¹˜/ë…¼ìŸì  ì •ë³´ ë¯¸ì‚¬ìš© ì—¬ë¶€
"""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Step3/Step4 ì„¤êµë¬¸ ì‘ì„± ì§€ì¹¨
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_step3_writing_guide() -> str:
        """Step3 ì„¤êµë¬¸ ì‘ì„±ì„ ìœ„í•œ ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ 3ëŒ€ì§€ ì„¤êµë¬¸ ì‘ì„± ì§€ì¹¨ ã€‘

â–¶ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
â–¡ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ì´ ì²­ì¤‘ì˜ ê´€ì‹¬ì„ í™•ì‹¤íˆ ëŒì—ˆëŠ”ê°€?
â–¡ 3ê°œì˜ ëŒ€ì§€ê°€ ëª¨ë‘ í¬í•¨ë˜ì—ˆëŠ”ê°€?
â–¡ ê° ëŒ€ì§€ì— 1-1, 1-2 ì†Œì œëª© êµ¬ì¡°ê°€ ìˆëŠ”ê°€?
â–¡ ê° ì†Œì œëª©ì— ë³´ì¶© ì„±ê²½êµ¬ì ˆì´ 1-2ê°œ ìˆëŠ”ê°€?
â–¡ ê²°ë¡ ì—ì„œ ì„¸ ëŒ€ì§€ê°€ ìš”ì•½ë˜ì—ˆëŠ”ê°€?
â–¡ ê²°ë¡ ì— ì‹¤ì²œ ê°€ëŠ¥í•œ ì ìš©ì´ ìˆëŠ”ê°€?

â–¶ ì‘ì„± ìˆœì„œ
1. ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ì‘ì„± (ì‹œì‚¬ ì´ìŠˆ ë˜ëŠ” ìƒí™œ ì´ì•¼ê¸°)
2. 1ëŒ€ì§€ â†’ 1-1, 1-2 ìˆœì„œë¡œ ì‘ì„±
3. 2ëŒ€ì§€ â†’ 2-1, 2-2 ìˆœì„œë¡œ ì‘ì„±
4. 3ëŒ€ì§€ â†’ 3-1, 3-2 ìˆœì„œë¡œ ì‘ì„± (ê°€ì¥ ê°•ë ¥í•˜ê²Œ)
5. ê²°ë¡  ì‘ì„± (ìš”ì•½ + ì ìš© + ì¶•ë³µ)

â–¶ ë¬¸ì²´ ì›ì¹™
- ê° ëŒ€ì§€ ì œëª©ì€ ëª…í™•í•˜ê³  ê¸°ì–µí•˜ê¸° ì‰½ê²Œ
- ì†Œì œëª©ì€ ëŒ€ì§€ë¥¼ êµ¬ì²´í™”í•˜ëŠ” ë‚´ìš©ìœ¼ë¡œ
- ë³´ì¶© ì„±ê²½êµ¬ì ˆì€ ë³¸ë¬¸ê³¼ ì—°ê´€ëœ ê²ƒìœ¼ë¡œ
"""

    @staticmethod
    def get_step3_checklist() -> List[str]:
        """Step3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°˜í™˜"""
        return [
            "ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹(ë„ì…ë¶€)ì´ ì²­ì¤‘ì˜ ê´€ì‹¬ì„ ëŒì—ˆëŠ”ê°€?",
            "1ëŒ€ì§€ê°€ 1-1, 1-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "2ëŒ€ì§€ê°€ 2-1, 2-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "3ëŒ€ì§€ê°€ 3-1, 3-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "ê° ì†Œì œëª©ì— ë³´ì¶© ì„±ê²½êµ¬ì ˆì´ 1-2ê°œ í¬í•¨ë˜ì—ˆëŠ”ê°€?",
            "ê²°ë¡ ì—ì„œ ì„¸ ëŒ€ì§€ì˜ í•µì‹¬ì´ ìš”ì•½ë˜ì—ˆëŠ”ê°€?",
            "ê²°ë¡ ì— êµ¬ì²´ì ì¸ ì ìš©ì´ í¬í•¨ë˜ì—ˆëŠ”ê°€?",
        ]

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ì˜ˆí™” ê°€ì´ë“œ
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_illustration_guide() -> str:
        """ì˜ˆí™” ë°°ì¹˜ ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ 3ëŒ€ì§€ ì„¤êµ ì˜ˆí™”/ì ìš© ê°€ì´ë“œ ã€‘

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ â˜…â˜…â˜… í•µì‹¬ ì›ì¹™: í•„ìš”í•œ ê³³ì—ë§Œ â˜…â˜…â˜…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ ëª¨ë“  ëŒ€ì§€ì— ì˜ˆí™”ì™€ ì ìš©ì„ ê¸°ê³„ì ìœ¼ë¡œ ë„£ì§€ ë§ˆì„¸ìš”!

ì˜ˆí™”ê°€ í•„ìš”í•œ ê²½ìš°:
âœ“ ê°œë…ì´ ì¶”ìƒì ì´ì–´ì„œ êµ¬ì²´ì  ì´ë¯¸ì§€ê°€ í•„ìš”í•  ë•Œ
âœ“ ì²­ì¤‘ì´ ê³µê°í•˜ê¸° ì–´ë ¤ìš´ ì—­ì‚¬ì /ë¬¸í™”ì  ë°°ê²½ì„ ì„¤ëª…í•  ë•Œ
âœ“ ê°ë™ì„ ì „ë‹¬í•´ì•¼ í•˜ëŠ” í´ë¼ì´ë§¥ìŠ¤ ìˆœê°„

ì˜ˆí™”ê°€ ë¶ˆí•„ìš”í•œ ê²½ìš°:
âœ— ë³¸ë¬¸ ìì²´ê°€ ì´ë¯¸ êµ¬ì²´ì ì¸ ì´ì•¼ê¸°/ì‚¬ê±´ì¼ ë•Œ
âœ— ì„±ê²½ ë³¸ë¬¸ì˜ ì´ë¯¸ì§€ê°€ ì¶©ë¶„íˆ ì„ ëª…í•  ë•Œ
âœ— ì˜ˆí™”ê°€ ë³¸ë¬¸ì˜ íë¦„ì„ ë°©í•´í•  ë•Œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ì˜ˆí™”/ì ìš© ë°°ì¹˜ ê¶Œì¥ íŒ¨í„´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

íŒ¨í„´ A (ê¶Œì¥): ì˜ˆí™” 1-2ê°œ + ê²°ë¡  í†µí•© ì ìš©
  - 1ëŒ€ì§€: ë³¸ë¬¸ ì„¤ëª… (ì˜ˆí™” ì—†ìŒ)
  - 2ëŒ€ì§€: ì¶”ìƒì  ê°œë…ì´ë©´ ì˜ˆí™” 1ê°œ
  - 3ëŒ€ì§€: í´ë¼ì´ë§¥ìŠ¤ì— ê°ë™ ì˜ˆí™” 1ê°œ
  - ê²°ë¡ : 3ëŒ€ì§€ ë‚´ìš©ì„ ë¬¶ì–´ í†µí•© ì ìš©

íŒ¨í„´ B: ì¤‘ê°„ ì˜ˆí™” + ëŒ€ì§€ë³„ ì§§ì€ ì ìš©
  - ê°€ì¥ í•µì‹¬ì ì¸ ëŒ€ì§€ 1ê°œì—ë§Œ ì˜ˆí™”
  - ê° ëŒ€ì§€ ëì— í•œ ë¬¸ì¥ ì ìš© (ì„ íƒ)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ì¢‹ì€ ì˜ˆí™”ì˜ 4ìš”ì†Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. êµ¬ì²´ì  ì¸ë¬¼/ìƒí™©
   âœ— "ì–´ë–¤ ì‚¬ëŒì´ ì–´ë ¤ì›€ì„ ê²ªì—ˆìŠµë‹ˆë‹¤"
   âœ“ "30ëŒ€ ì§ì¥ì¸ ê¹€ ê³¼ì¥ì€ 10ë…„ ë‹¤ë‹Œ íšŒì‚¬ì—ì„œ ê°‘ìê¸° í•´ê³  í†µë³´ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤"

2. ê°ì •ê³¼ ê°ˆë“±
   - ë‘ë ¤ì›€, ê¸°ëŒ€, ì ˆë§, í¬ë§ ë“± ê°ì • ë¬˜ì‚¬

3. ë³€í™”ì˜ ìˆœê°„
   - ë§ì”€/ê¸°ë„ë¥¼ í†µí•œ ì „í™˜ì 

4. ë³¸ë¬¸ ì—°ê²°
   - ì˜ˆí™” ëì— ìì—°ìŠ¤ëŸ½ê²Œ ë³¸ë¬¸ìœ¼ë¡œ ëŒì•„ì˜¤ê¸°

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ì ìš© ë°°ì¹˜ ì›ì¹™
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â˜… ì ìš©ì€ ê²°ë¡ ì—ì„œ í†µí•©í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.

âœ— í”¼í•˜ì„¸ìš”:
- ê° ëŒ€ì§€ë§ˆë‹¤ "~í•©ì‹œë‹¤" ë°˜ë³µ
- ì¶”ìƒì  ê¶Œë©´ ("ë¯¿ìŒì„ ê°€ì§‘ì‹œë‹¤")

âœ“ ê¶Œì¥:
- ê²°ë¡ ì—ì„œ 3ëŒ€ì§€ ë‚´ìš©ì„ í•˜ë‚˜ë¡œ ë¬¶ëŠ” í†µí•© ì ìš©
- êµ¬ì²´ì ì´ê³  ì‹¤ì²œ ê°€ëŠ¥í•œ ì ìš© 1-2ê°œ
- "ì´ë²ˆ ì£¼ í•˜ë£¨ 10ë¶„, ì¶œê·¼ ì „ ì˜¤ëŠ˜ ë§ì”€ì„ ë¬µìƒí•´ ë³´ì„¸ìš”"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ì£¼ì˜ì‚¬í•­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ë…¼ë€ì˜ ì—¬ì§€ê°€ ìˆëŠ” ì •ì¹˜/ì‚¬íšŒ ì´ìŠˆ í”¼í•˜ê¸°
- ì˜ˆí™”ê°€ ë³¸ë¬¸ ë©”ì‹œì§€ë³´ë‹¤ íŠ€ì§€ ì•Šë„ë¡
- ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ (ì˜ˆí™”ë‹¹ 3-5ë¬¸ì¥)
"""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # êµ¬ì¡° í…œí”Œë¦¿ (JSON)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_structure_template() -> Dict[str, Any]:
        """Step2 ì¶œë ¥ìš© êµ¬ì¡° í…œí”Œë¦¿ (Step1 ID í•„ìˆ˜ ì°¸ì¡°)"""
        return {
            "style": "three_points",
            "style_name": "3ëŒ€ì§€",
            "title": "",
            "big_idea": "",
            "intro_question": "",
            "time_map_percent": {
                "intro": 10,
                "p1": 27,
                "p2": 27,
                "p3": 27,
                "ending": 9
            },
            "ëŒ€ì§€_1": {
                "title": "",
                "background_ids": [],  # H*, G* ID ì°¸ì¡°
                "sub_1": {
                    "title": "",
                    "anchor_ids": [],  # A* ID 2ê°œ í•„ìˆ˜
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "anchor_ids": [],
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                }
            },
            "ëŒ€ì§€_2": {
                "title": "",
                "background_ids": [],
                "sub_1": {
                    "title": "",
                    "anchor_ids": [],
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "anchor_ids": [],
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                }
            },
            "ëŒ€ì§€_3": {
                "title": "",
                "background_ids": [],
                "sub_1": {
                    "title": "",
                    "anchor_ids": [],
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "anchor_ids": [],
                    "anchor_phrases": ["", ""],
                    "supporting_verses": ["", ""],
                    "one_sentence_explanation": ""
                }
            },
            "ending": {
                "summary_points": ["", "", ""],
                "affirms_used": [],  # C* ID ì°¸ì¡°
                "decision_questions": ["", ""],
                "prayer_points": ["", ""]
            },
            "self_check": [
                {"check": "ê° ì†ŒëŒ€ì§€ anchor_ids 2ê°œ ì´ìƒ", "pass": False},
                {"check": "ê° ì†ŒëŒ€ì§€ supporting_verses 2ê°œ", "pass": False},
                {"check": "ê° ëŒ€ì§€ background_ids 1ê°œ ì´ìƒ", "pass": False},
                {"check": "ëŒ€ì§€ íë¦„ì´ ë³¸ë¬¸ ì „ê°œë¥¼ ë”°ë¦„", "pass": False},
                {"check": "does_not_claim(D*) ìœ„ë°˜ ì—†ìŒ", "pass": False},
                {"check": "ì‹œì‚¬/ë…¼ìŸì  ì •ë³´ ë¯¸ì‚¬ìš©", "pass": False}
            ]
        }

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # í”„ë¡¬í”„íŠ¸ ë¹Œë”
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def build_step2_prompt(self, step1_result: Dict = None, context_data: Dict = None) -> str:
        """Step2 í”„ë¡¬í”„íŠ¸ ìƒì„±"""
        prompt = self.get_step2_structure_guide()

        if context_data:
            prompt += "\n\nã€ ì‹œëŒ€ ì»¨í…ìŠ¤íŠ¸ ã€‘\n"
            if context_data.get("concerns"):
                prompt += "ì²­ì¤‘ ê´€ì‹¬ì‚¬:\n"
                for concern in context_data.get("concerns", [])[:3]:
                    prompt += f"  - {concern}\n"

        prompt += "\n\nìœ„ êµ¬ì¡°ì— ë§ê²Œ ì„¤êµ êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì„¸ìš”."
        return prompt

    @staticmethod
    def get_application_guide() -> str:
        """ì ìš© ì‘ì„± ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ ì„¤êµ ì ìš© ê°€ì´ë“œ ã€‘

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ë§‰ì—°í•œ ì ìš© vs êµ¬ì²´ì  ì ìš©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ— ë§‰ì—°í•œ ì ìš© (í”¼í•˜ì„¸ìš”):
- "ë¯¿ìŒì„ ê°€ì§‘ì‹œë‹¤"
- "ê¸°ë„í•©ì‹œë‹¤"
- "ë§ì”€ëŒ€ë¡œ ì‚´ì•„ê°‘ì‹œë‹¤"

âœ“ êµ¬ì²´ì  ì ìš© (ì´ë ‡ê²Œ):
- "ì´ë²ˆ ì£¼ í•˜ë£¨ 10ë¶„, ì¶œê·¼ ì „ ì˜¤ëŠ˜ ë§ì”€ì„ ë¬µìƒí•´ ë³´ì„¸ìš”"
- "ì˜¤ëŠ˜ í•œ ì‚¬ëŒì—ê²Œ ê²©ë ¤ì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”"
- "ë‚´ì¼ ì•„ì¹¨ ì¼ì–´ë‚˜ë©´ ê°€ì¥ ë¨¼ì € ê°ì‚¬í•œ ê²ƒ 3ê°€ì§€ë¥¼ ì ì–´ë³´ì„¸ìš”"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ë‹¨ê³„ë³„ ì ìš© ì œì‹œ (ê¶Œì¥)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ì˜¤ëŠ˜ (ì¦‰ì‹œ ì‹¤ì²œ)
   "ì˜¤ëŠ˜ ì €ë… ì‹ì‚¬ ê¸°ë„ ë•Œ, ê°€ì¡± í•œ ëª…ì”© ê°ì‚¬í•œ ì ì„ ë‚˜ëˆ ë³´ì„¸ìš”"

2. ì´ë²ˆ ì£¼ (ìŠµê´€ í˜•ì„±)
   "ì´ë²ˆ ì£¼ ë§¤ì¼ ì•„ì¹¨ 5ë¶„ì”© ì˜¤ëŠ˜ ë³¸ë¬¸ì„ ë‹¤ì‹œ ì½ì–´ë³´ì„¸ìš”"

3. í•œ ë‹¬ (ì‚¶ì˜ ë³€í™”)
   "í•œ ë‹¬ ë™ì•ˆ ë§¤ì£¼ í•œ ì‚¬ëŒì—ê²Œ ì§„ì‹¬ ì–´ë¦° ê²©ë ¤ë¥¼ ì „í•´ë³´ì„¸ìš”"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ ì²­ì¤‘ë³„ ë§ì¶¤ ì ìš©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- ì§ì¥ì¸: "ì›”ìš”ì¼ ì¶œê·¼ê¸¸ì— ì´ ë§ì”€ì„ ë– ì˜¬ë ¤ ë³´ì„¸ìš”"
- ë¶€ëª¨: "ì˜¤ëŠ˜ ìë…€ì—ê²Œ ì´ ë§ì”€ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì „í•´ë³´ì„¸ìš”"
- ì²­ë…„: "ì§„ë¡œ ê³ ë¯¼ ì¤‘ì´ë¼ë©´, ì´ë²ˆ ì£¼ ì´ ë§ì”€ ì•ì—ì„œ ê¸°ë„í•´ ë³´ì„¸ìš”"
- ì–´ë¥´ì‹ : "ì˜¤ëŠ˜ í•˜ë£¨ ì´ ë§ì”€ì„ ë¬µìƒí•˜ë©° ê°ì‚¬ ì¼ê¸°ë¥¼ ì¨ë³´ì„¸ìš”"
"""

    def build_step3_prompt(self, step2_result: Dict = None, duration: str = "20ë¶„") -> str:
        """Step3/Step4 í”„ë¡¬í”„íŠ¸ ìƒì„± - ì˜ˆí™”/ì ìš© ê°€ì´ë“œ í¬í•¨"""
        from . import READABILITY_GUIDE

        prompt = self.get_step3_writing_guide()

        # ì˜ˆí™” ê°€ì´ë“œ ì¶”ê°€
        prompt += "\n\n" + self.get_illustration_guide()

        # ì ìš© ê°€ì´ë“œ ì¶”ê°€
        prompt += "\n\n" + self.get_application_guide()

        # ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
        prompt += "\n\nã€ ì‘ì„± ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸ ã€‘\n"
        for item in self.get_step3_checklist():
            prompt += f"â–¡ {item}\n"

        prompt += f"\n\nã€ ë¶„ëŸ‰ ã€‘\n{duration}\n"
        prompt += READABILITY_GUIDE
        prompt += "\n\nìœ„ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì²­ì¤‘ì´ ì€í˜œë°›ì„ ìˆ˜ ìˆëŠ” ì„¤êµë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”."
        return prompt
