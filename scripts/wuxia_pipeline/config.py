"""
무협 파이프라인 설정
- 시리즈: 혈영 (Blood Shadow)
- 주인공: 무영
- 다중 음성 TTS 지원
"""

import os
from typing import Dict, List

# =====================================================
# 시리즈 설정
# =====================================================

SERIES_INFO = {
    "title": "혈영",
    "title_en": "Blood Shadow",
    "protagonist": "무영",
    "heroine": "설하",  # 절세미녀 여주인공
    "genre": "무협",
    "description": "노비 출신의 청년이 의문의 노인에게 절세무공을 전수받아 강호를 휩쓰는 이야기. 그의 곁에는 모두가 부러워하는 절세미녀 설하가 함께한다.",
    "youtube_channel_id": os.getenv("WUXIA_CHANNEL_ID", ""),
    "playlist_id": os.getenv("WUXIA_PLAYLIST_ID", ""),
}

# =====================================================
# 음성 매핑 (TTS Voice Map)
# =====================================================
# 형식: {태그명: TTS 음성 ID}
# 음성 종류:
#   - chirp3:* : Chirp3 모델 (기본)
#   - gemini:* : Gemini Flash 모델 (저렴)
#   - gemini:pro:* : Gemini Pro 모델 (고품질)

VOICE_MAP: Dict[str, str] = {
    # 나레이션 (남성, 깊고 차분한 톤)
    "나레이션": "chirp3:Charon",

    # 주인공들
    "무영": "gemini:Puck",           # 젊은 남성, 활기차고 친근한 톤
    "설하": "gemini:pro:Kore",       # ★ 절세미녀 여주인공, 부드럽고 우아한 톤 (Pro 고품질)
    "노인": "gemini:pro:Charon",     # 노인, 깊고 지혜로운 톤 (Pro 모델로 차별화)
    "각주": "chirp3:Fenrir",         # 남성 조연, 힘있고 웅장한 톤

    # 엑스트라 (성별 구분)
    "남자": "gemini:Charon",         # 남자 엑스트라
    "여자": "gemini:Kore",           # 여자 엑스트라

    # 특수 캐릭터 (확장용)
    "악역": "chirp3:Fenrir",         # 악역, 웅장하고 위협적
}

# 기본 음성 (태그가 없거나 매칭 안될 때)
DEFAULT_VOICE = "chirp3:Charon"

# =====================================================
# 스크립트 태그 형식
# =====================================================
# [태그] 대사 또는 나레이션
# 예: [나레이션] 무영이 고개를 들었다.
#     [무영] "이제 그만 가시죠."
#     [노인] "아직 멀었다, 젊은이."

SCRIPT_TAG_PATTERN = r'\[([^\]]+)\]\s*(.+?)(?=\[[^\]]+\]|$)'

# 주인공 태그 목록 (나레이터가 소개하는 캐릭터)
MAIN_CHARACTER_TAGS = ["무영", "설하", "노인", "각주", "악역"]

# 엑스트라 태그 목록 (나레이터 소개 없이 바로 대사)
EXTRA_TAGS = ["남자", "여자", "남자1", "남자2", "여자1", "여자2"]

# =====================================================
# 대본 설정
# =====================================================

SCRIPT_CONFIG = {
    # 에피소드당 목표 글자수 (약 13~15분 영상)
    "target_chars": 13000,
    "min_chars": 11000,
    "max_chars": 15000,

    # 씬 설정
    "scenes_per_episode": 8,  # 에피소드당 씬 수
    "chars_per_scene": 1500,  # 씬당 평균 글자수

    # TTS 설정
    "speaking_rate": 0.9,  # 음성 속도
    "language": "ko-KR",
}

# =====================================================
# 에피소드 템플릿 (혈영 시리즈)
# =====================================================

EPISODE_TEMPLATES = {
    1: {
        "title": "운명의 시작",
        "summary": "노비 출신 청년 무영이 의문의 노인을 만나 절세무공의 비밀을 전수받게 되는 첫 번째 이야기",
        "key_events": [
            "무영의 비천한 신분과 고된 일상",
            "의문의 노인과의 만남",
            "노인의 시험과 무영의 선택",
            "무공 전수의 시작"
        ],
        "characters": ["무영", "노인", "각주"],
    },
    2: {
        "title": "첫 번째 도약",
        "summary": "노인의 가르침 아래 무영이 첫 무공을 익히고 새로운 세계를 보게 되는 이야기",
        "key_events": [
            "기초 내공 수련",
            "첫 무공 습득의 어려움",
            "돌파의 순간",
            "새로운 능력의 자각"
        ],
        "characters": ["무영", "노인"],
    },
    3: {
        "title": "강호에 발을 딛다",
        "summary": "수련을 마친 무영이 처음으로 강호의 현실을 마주하게 되는 이야기",
        "key_events": [
            "노인과의 이별",
            "첫 강호 출두",
            "불의와의 조우",
            "첫 번째 결전"
        ],
        "characters": ["무영", "노인", "악역"],
    },
    4: {
        "title": "눈 속의 절세미인",
        "summary": "강호를 떠돌던 무영이 눈보라 속에서 쓰러진 절세미녀 설하를 구하게 되는 이야기",
        "key_events": [
            "눈보라 속 쓰러진 여인 발견",
            "설하와의 첫 만남",
            "설하를 노리는 자들의 습격",
            "무영의 실력 각성"
        ],
        "characters": ["무영", "설하", "악역"],
    },
    5: {
        "title": "빚진 은혜",
        "summary": "설하가 무영에게 목숨을 빚졌다며 따라다니기 시작하는 이야기. 무영은 무관심하지만 설하는 물러서지 않는다.",
        "key_events": [
            "설하의 신분 - 명문 세가의 영애",
            "설하의 결심 - 은혜를 갚을 때까지",
            "무영의 무관심과 냉담",
            "설하를 시기하는 강호인들"
        ],
        "characters": ["무영", "설하"],
    },
}

# =====================================================
# Google Sheets 설정
# =====================================================

SHEET_NAME = "WUXIA"  # 시트 탭 이름

# 시트 헤더 (HISTORY와 유사한 구조)
SHEET_HEADERS = [
    "episode",           # EP001, EP002, ...
    "title",             # 에피소드 제목
    "summary",           # 에피소드 요약
    "opus_prompt",       # 대본 생성용 프롬프트
    "thumbnail_copy",    # 썸네일 문구
    # === 영상 자동화 헤더 (VIDEO_AUTOMATION_HEADERS) ===
    "상태",              # 대기/처리중/완료/실패
    "대본",              # 생성된 대본
    "제목(GPT생성)",     # 자동 생성 제목
    "제목(입력)",        # 수동 입력 제목
    "썸네일문구(입력)",  # 수동 입력 썸네일
    "공개설정",          # public/private/unlisted
    "예약시간",          # YouTube 예약 공개 시간
    "플레이리스트ID",    # YouTube 플레이리스트
    "음성",              # TTS 음성 설정 (다중 음성은 기본 VOICE_MAP 사용)
    "영상URL",           # 업로드된 URL
    "쇼츠URL",           # 쇼츠 URL
    "제목2",             # 대안 제목
    "제목3",             # 대안 제목
    "비용",              # 생성 비용
    "에러메시지",        # 에러 메시지
    "작업시간",          # 실행 시간
]

# =====================================================
# 환경변수
# =====================================================

OPENROUTER_API_KEY = os.getenv("OPENROUTER_API_KEY", "")
OPENROUTER_BASE_URL = "https://openrouter.ai/api/v1"
CLAUDE_OPUS_MODEL = "anthropic/claude-opus-4-5-20251101"

GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY", "")  # Gemini TTS용
GOOGLE_CLOUD_API_KEY = os.getenv("GOOGLE_CLOUD_API_KEY", "")  # Google Cloud TTS용
