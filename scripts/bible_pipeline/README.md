# 성경통독 파이프라인

개역개정 성경 기반 성경통독 영상 자동 생성 파이프라인

## 개요

```
┌─────────────────────────────────────────────────────────┐
│  1. 에피소드 생성 (자동 분량 계산)                       │
│     └── 20분 기준: 창세기 1-15장 (약 18,000자)           │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  2. TTS 생성                                            │
│     ├── 입력: 말씀만 (절 번호 제외)                      │
│     ├── "창세기 1장. 태초에 하나님이 천지를..."          │
│     └── 음성: chirp3:Charon (차분한 남성)                │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  3. 자막 생성                                            │
│     ├── 형식: (1) 태초에 하나님이 천지를 창조하시니라     │
│     └── 절 번호 포함, 화면에 표시                        │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  4. 영상 생성                                            │
│     ├── 배경: 차분한 이미지/그라데이션                   │
│     ├── 장 전환 시 "창세기 1장" 타이틀 표시              │
│     └── 자막 + 음성 합성                                 │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  5. YouTube 업로드                                       │
│     ├── 제목: [성경통독] 창세기 1-15장                   │
│     └── 플레이리스트: 성경통독                           │
└─────────────────────────────────────────────────────────┘
```

## 기존 파이프라인과의 차이점

| 항목 | 기존 파이프라인 | 성경통독 |
|------|----------------|----------|
| **TTS 입력** | 대본 전체 | 말씀만 (절 번호 제외) |
| **자막** | 나레이션 그대로 | 절 번호 포함 `(1) 태초에...` |
| **화면 구성** | 씬별 AI 이미지 전환 | 절별 텍스트 + 고정 배경 |
| **소스** | Google Sheets 대본 | 성경 JSON 파일 |
| **GPT 분석** | 대본 분석 필요 | 불필요 (정형화된 구조) |

## 파일 구조

```
scripts/bible_pipeline/
├── __init__.py     # 모듈 export
├── config.py       # 설정 (TTS, 영상, Sheets)
├── run.py          # 메인 파이프라인 로직
└── README.md       # 이 문서
```

## 사용법

### 기본 사용

```python
from scripts.bible_pipeline.run import BiblePipeline

# 파이프라인 초기화
pipeline = BiblePipeline()

# 특정 범위 에피소드 생성
episode = pipeline.create_episode("창세기", 1, 15)

# TTS용 텍스트 (절 번호 제외)
print(episode.tts_text)
# 출력: "창세기 1장. 태초에 하나님이 천지를 창조하시니라 땅이 혼돈하고..."

# 자막 목록 (절 번호 포함)
for sub in episode.subtitles[:3]:
    print(sub["text"])
# 출력:
# (1) 태초에 하나님이 천지를 창조하시니라
# (2) 땅이 혼돈하고 공허하며...
# (3) 하나님이 이르시되 빛이 있으라...
```

### 자동 분량 계산

```python
# 20분 분량으로 자동 계산
episode = pipeline.create_episode_auto("창세기", start_chapter=1)

print(f"범위: {episode.title}")           # 창세기 1-15장
print(f"글자 수: {episode.total_chars}")  # 약 18,000자
print(f"예상 시간: {episode.estimated_minutes}분")  # 약 19.8분
```

### 책 전체 에피소드 분할

```python
# 창세기 전체를 20분 단위로 분할
episodes = pipeline.generate_all_episodes("창세기")

for ep in episodes:
    print(f"{ep.episode_id}: {ep.title} ({ep.estimated_minutes:.1f}분)")
# 출력:
# EP001: 창세기 1-15장 (19.8분)
# EP002: 창세기 16-28장 (19.5분)
# EP003: 창세기 29-41장 (20.1분)
# EP004: 창세기 42-50장 (18.2분)
```

## TTS 씬 구조

기존 파이프라인의 `scenes` 구조와 호환됩니다:

```python
scenes = episode.tts_scenes
# [
#     {
#         "scene": 1,
#         "chapter": 1,
#         "chapter_title": "창세기 1장",
#         "narration": "태초에 하나님이 천지를...",
#         "char_count": 1615,
#         "verse_count": 31
#     },
#     {
#         "scene": 2,
#         "chapter": 2,
#         "chapter_title": "창세기 2장",
#         "narration": "천지와 만물이 다 이루어지니라...",
#         "char_count": 1233,
#         "verse_count": 25
#     },
#     ...
# ]
```

## Google Sheets 연동

### 시트 구조

| 열 | 설명 | 예시 |
|----|------|------|
| 에피소드 | 에피소드 ID | EP001 |
| 책 | 성경 책 이름 | 창세기 |
| 시작장 | 시작 장 번호 | 1 |
| 끝장 | 끝 장 번호 | 15 |
| 예상시간(분) | TTS 예상 시간 | 19.8 |
| 글자수 | 총 글자 수 | 18041 |
| 상태 | 처리 상태 | 대기/처리중/완료/실패 |
| 제목 | 영상 제목 | [성경통독] 창세기 1-15장 |
| 음성 | TTS 음성 | chirp3:Charon |
| 공개설정 | YouTube 공개 | public/private/unlisted |
| 예약시간 | 예약 공개 시간 | 2025-01-01T09:00:00 |
| 플레이리스트ID | YouTube 플레이리스트 | PLxxxxxxxx |
| 영상URL | 업로드된 URL | https://youtu.be/xxx |
| 에러메시지 | 실패 시 에러 | - |
| 작업시간 | 처리 소요 시간 | 25분 |
| 생성일 | 행 생성 날짜 | 2025-01-01 |

## 설정

### TTS 설정 (`config.py`)

```python
# 음성 (차분한 남성)
BIBLE_TTS_VOICE = "chirp3:Charon"

# 말하기 속도 (성경은 천천히)
BIBLE_TTS_SPEAKING_RATE = 0.9
```

### 영상 설정

```python
# 영상 길이 (분)
BIBLE_VIDEO_LENGTH_MINUTES = 20

# 한국어 TTS: 910자/분
BIBLE_CHARS_PER_MINUTE = 910

# 목표 글자 수
BIBLE_TARGET_CHARS = 18200  # 20분 기준
```

### 자막 스타일

```python
SUBTITLE_STYLE = {
    "font_size": 48,
    "font_color": "#FFFFFF",
    "verse_number_color": "#FFD700",  # 절 번호 (골드)
    "background_opacity": 0.7,
    "position": "bottom",
}
```

## CLI 테스트

```bash
cd /home/user/my_page_v2
python -m scripts.bible_pipeline.run
```

## 향후 계획

1. [ ] 기존 영상 생성 파이프라인과 통합
2. [ ] Google Sheets API 연동
3. [ ] 배경 이미지/영상 지원
4. [ ] 장 전환 효과 추가
5. [ ] 쇼츠 버전 생성 (하루 1장)
