# 자동화 파이프라인 가이드

> 마지막 업데이트: 2026-01-07

---

## 파이프라인 구조

```
scripts/
├── common/               # 공통 모듈 (에이전트 기본 클래스, SRT 유틸리티)
├── history_pipeline/     # 한국사 자동화
├── isekai_pipeline/      # 이세계 자동화 (혈영 이세계편)
├── bible_pipeline/       # 성경통독 자동화
├── migrations/           # DB 마이그레이션 스크립트
└── PIPELINE_README.md    # 이 파일
```

---

## 상태 코드 정의

| 상태 | 설명 | 다음 단계 |
|------|------|----------|
| `준비` | 자료 수집 완료, 대본 작성 대기 | 사용자가 `대기`로 변경 시 영상 생성 시작 |
| `대기` | 영상 생성 파이프라인 대기 중 | 자동으로 처리 |
| `처리중` | 영상 생성 중 | 자동 완료 대기 |
| `완료` | 영상 업로드 완료 | - |
| `실패` | 오류 발생 | 에러메시지 확인 후 재시도 |

---

## 1. 한국사 파이프라인 (HISTORY)

### 워크플로우
```
주제 선정 → 자료 수집 (한국민족문화대백과, e뮤지엄) → Opus 프롬프트 생성 → 시트 저장
```

### API
```bash
GET /api/history/run-pipeline
GET /api/history/run-pipeline?force=1
```

### 자동 보충
- 목표: '준비' 상태 **10개** 유지
- 부족 시 자동으로 다음 에피소드 추가

### 시대 구성
| 시대 | 에피소드 수 | 상태 |
|------|------------|------|
| 선사시대 | 3 | 활성 |
| 고조선~삼국통일 | 5 | 활성 |
| 통일신라~고려 | 5 | 활성 |
| 조선 전기 | 5 | 활성 |
| 조선 후기 | 5 | 활성 |
| 근대 | 5 | 활성 |
| 현대 | 4 | 활성 |
| **총계** | **32** | |

---

## 2. 이세계 파이프라인 (ISEKAI)

### 워크플로우
```
에피소드 기획 → 대본 생성 → 이미지 생성 → 영상 렌더링 → 업로드
```

### 시리즈 정보
- 시리즈명: 혈영 이세계편
- 60화 완결 예정
- 파트별 구성 (6파트)

---

## 3. 성경통독 파이프라인 (BIBLE)

### 워크플로우
```
성경 본문 선정 → 대본 생성 → TTS → 영상 생성 → 업로드
```

---

## 통합 시트 구조

### 시트 레이아웃

```
Google Sheets
├── HISTORY     # 한국사 통합
├── ISEKAI      # 이세계 통합
└── BIBLE       # 성경통독 통합
```

### 시트 헤더 (공통)

**행 1**: 채널 설정
| A1 | B1 |
|----|-----|
| 채널ID | UCxxxxxxxxxxxx |

**행 2**: 헤더
- 수집 영역 (자동 채워짐)
- 영상 자동화 영역 (상태, 대본, 제목 등)

**행 3~**: 데이터

---

## 로그 확인

### 서버 로그 태그
```
[HISTORY]    - 한국사 파이프라인
[ISEKAI]     - 이세계 파이프라인
[BIBLE]      - 성경통독 파이프라인
```

---

## 관련 파일

| 파일 | 설명 |
|------|------|
| `drama_server.py` | 메인 서버 (API 엔드포인트) |
| `scripts/common/` | 공통 모듈 (에이전트 기본 클래스, SRT 유틸리티) |
| `scripts/history_pipeline/` | 한국사 파이프라인 |
| `scripts/isekai_pipeline/` | 이세계 파이프라인 |
| `scripts/bible_pipeline/` | 성경통독 파이프라인 |
